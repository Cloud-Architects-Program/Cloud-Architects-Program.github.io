<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Module 10 Monitoring with GMP - Cloud Architecture</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Cloud Architecture</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT020 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Lab_Terraform_Fundamentals" class="dropdown-item">Module 2 Terraform Fundamentals</a>
</li>
            
<li>
    <a href="../020_Lab_4_Traffic_control/" class="dropdown-item">Module 8 Traffic Management</a>
</li>
            
<li>
    <a href="../020_Lab_5_EFK/" class="dropdown-item">Module 9 EFK Stack</a>
</li>
            
<li>
    <a href="../020_Lab_6_Prometheus/" class="dropdown-item">Module 10 Monitoring with Prometheus</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Module 10 Monitoring with GMP</a>
</li>
            
<li>
    <a href="../020_Lab_9_GitOps/" class="dropdown-item">Module 11 GitOps with Flux</a>
</li>
            
<li>
    <a href="../020_Lab_10_cloudrun/" class="dropdown-item">MOdule 12 Serverless Cloud Run</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Assignment_Terraform_Foundation/" class="dropdown-item">Module 2</a>
</li>
            
<li>
    <a href="../020_Module_3_Assignment_Production_GKE/" class="dropdown-item">Module 3</a>
</li>
            
<li>
    <a href="../020_Module_4_Assignment_Production_GKE.md" class="dropdown-item">Module 4</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT019 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_Module_5_Lab_Docker_basics/" class="dropdown-item">Module 5 Lab - Docker Basics</a>
</li>
            
<li>
    <a href="../ycit019_Module_6_Lab_Advanced_Docker/" class="dropdown-item">Module 6 Lab - Advanced Docker</a>
</li>
            
<li>
    <a href="../ycit019_Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="dropdown-item">Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm</a>
</li>
            
<li>
    <a href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="dropdown-item">Module 8 Lab - Kuberenetes Concepts</a>
</li>
            
<li>
    <a href="../ycit019_Module_9_Kubernetes_Features/" class="dropdown-item">Module 9 Lab - Kubernetes Features</a>
</li>
            
<li>
    <a href="../ycit019_Module_10_Kubernetes_Scaling/" class="dropdown-item">Module 9 Part 2 Lab Kubernetes Autoscaling</a>
</li>
            
<li>
    <a href="../ycit019_Lab_10_Networking/" class="dropdown-item">Module 10 Lab - Kubernetes Networking</a>
</li>
            
<li>
    <a href="../ycit019_Lab_11_Storage/" class="dropdown-item">Module 11 Lab - Kubernetes Storage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_ass1/" class="dropdown-item">Module 5 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass1_sol/" class="dropdown-item">Module 5 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass2/" class="dropdown-item">Module 6 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass2_solution/" class="dropdown-item">Module 6 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass3/" class="dropdown-item">Module 8 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass3_solution/" class="dropdown-item">Module 8 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass4_2022/" class="dropdown-item">Module 9 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass4_sol/" class="dropdown-item">Module 9 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass7/" class="dropdown-item">Module 10 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass6_solution/" class="dropdown-item">Module 10 Assignment Solution</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../020_Lab_6_Prometheus/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../020_Lab_9_GitOps/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#scraping-metrics-app-metrics-with-gmp-and-managed-collections" class="nav-link">Scraping Metrics App metrics with GMP and Managed Collections</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-configure-gmp-and-managed-collections" class="nav-link">1 Configure GMP and Managed Collections</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2-configure-prometheus-ui-and-grafana-dashboards" class="nav-link">2 Configure Prometheus UI and Grafana Dashboards</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3-verify-gmp-cost" class="nav-link">3 Verify GMP Cost</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#4-cleanup" class="nav-link">4 Cleanup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="scraping-metrics-app-metrics-with-gmp-and-managed-collections">Scraping Metrics App metrics with GMP and Managed Collections<a class="headerlink" href="#scraping-metrics-app-metrics-with-gmp-and-managed-collections" title="Permanent link">&para;</a></h1>
<h2 id="1-configure-gmp-and-managed-collections">1 Configure GMP and Managed Collections<a class="headerlink" href="#1-configure-gmp-and-managed-collections" title="Permanent link">&para;</a></h2>
<h3 id="11-create-regional-gke-cluster-on-gcp-with-gmp">1.1 Create Regional GKE Cluster on GCP with GMP<a class="headerlink" href="#11-create-regional-gke-cluster-on-gcp-with-gmp" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Enable the Google Kubernetes Engine API.</p>
<pre class="codehilite"><code>gcloud services enable container.googleapis.com
</code></pre>

<p><strong>Step 2</strong> From the cloud shell, run the following command to create a cluster with 1 node:</p>
<pre class="codehilite"><code>gcloud beta container clusters create k8s-gmp-labs \
--region us-central1 \
--enable-ip-alias \
--enable-network-policy \
--num-nodes 1 \
--machine-type &quot;e2-standard-4&quot; \
--release-channel regular \
--enable-managed-prometheus
</code></pre>

<pre class="codehilite"><code>gcloud container clusters get-credentials k8s-gmp-labs --region us-central1
</code></pre>

<p><strong>Step 3</strong> List the Google Managed Prometheus (GMPs) Custom Resources Definitions (CRD's)</p>
<pre class="codehilite"><code>kubectl get crd | grep monitoring
</code></pre>

<pre class="codehilite"><code>clusterpodmonitorings.monitoring.googleapis.com       2022-07-12T20:26:52Z
clusterrules.monitoring.googleapis.com                2022-07-12T20:26:52Z
globalrules.monitoring.googleapis.com                 2022-07-12T20:26:53Z
operatorconfigs.monitoring.googleapis.com             2022-07-12T20:26:53Z
podmonitorings.monitoring.googleapis.com              2022-07-12T20:26:53Z
rules.monitoring.googleapis.com                       2022-07-12T20:26:54Z
</code></pre>

<h3 id="12-deploy-prom-example-application-and-scrape-custom-metrics-with-podmonitoring">1.2 Deploy <code>prom-example</code> application and scrape custom metrics with <code>PodMonitoring</code><a class="headerlink" href="#12-deploy-prom-example-application-and-scrape-custom-metrics-with-podmonitoring" title="Permanent link">&para;</a></h3>
<p>GMP out of the box doesn't scrape any metrics. In order to see any scraped Metrics in Prometheus UI or Grafana, 
we need to have deployed application and configure it as target for scraping using <code>PodMonitoring</code> CR.</p>
<p>We going to start by deploying application <code>example-app</code> in <code>default</code> namespace and adding it as scraping target:</p>
<p><strong>Step 1</strong> Deploy application <code>example-app</code> in <code>default</code> namespace:</p>
<pre class="codehilite"><code>cat &lt;&lt; EOF&gt;&gt; example-app.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: example-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: example-app
  template:
    metadata:
      labels:
        app: example-app
    spec:
      containers:
      - name: example-app
        image: fabxc/instrumented_app
        ports:
        - name: web
          containerPort: 8080
EOF
</code></pre>

<pre class="codehilite"><code>cat &lt;&lt; EOF&gt;&gt; example-svc.yaml
kind: Service
apiVersion: v1
metadata:
  name: example-app
  labels:
    app: example-app
spec:
  selector:
    app: example-app
  ports:
  - name: web
    port: 8080
EOF
</code></pre>

<pre class="codehilite"><code>kubens default
kubectl apply -f example-app.yaml
kubectl apply -f example-svc.yaml
</code></pre>

<p><strong>Step 2</strong> Deploy <code>PodMonitoring</code> in <code>default</code> namespace</p>
<pre class="codehilite"><code>cat &lt;&lt; EOF&gt;&gt; example-pod-mon.yaml
apiVersion: monitoring.googleapis.com/v1
kind: PodMonitoring
metadata:
  name: example-app
spec:
  selector:
    matchLabels:
      app: example-app
  endpoints:
  - port: web
    interval: 30s
EOF
</code></pre>

<pre class="codehilite"><code>kubectl apply -f example-pod-mon.yaml
</code></pre>

<p>Verify <code>monitoring</code> has been created in <code>default</code> namespace</p>
<pre class="codehilite"><code>kubectl get -A podmonitorings.monitoring.googleapis.com
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Creation of <code>monitoring</code> can be done in application namespace as well</p>
</div>
<p><strong>Step 6</strong> Verify that your Prometheus data is being exported to Managed Service for Prometheus:</p>
<p>In the Google Cloud console, go to <code>Monitoring</code></p>
<p>In the Monitoring navigation pane, click <code>Managed Prometheus</code></p>
<p>Run following queries:</p>
<pre class="codehilite"><code>up
</code></pre>

<pre class="codehilite"><code>http_requests_total{code=&quot;200&quot;,method=&quot;get&quot;}
</code></pre>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We can see Prometheus data is being exported to Managed Service for Prometheus</p>
</div>
<h2 id="2-configure-prometheus-ui-and-grafana-dashboards">2 Configure Prometheus UI and Grafana Dashboards<a class="headerlink" href="#2-configure-prometheus-ui-and-grafana-dashboards" title="Permanent link">&para;</a></h2>
<h3 id="21-verify-sa-account-has-correct-permissions">2.1 Verify SA account has correct permissions.<a class="headerlink" href="#21-verify-sa-account-has-correct-permissions" title="Permanent link">&para;</a></h3>
<p><strong>Option 1:</strong> Using GKE with <code>default</code> Compute Service Account, should have all required permissions as it is using Editor role (roles/editor) on the project. (without WI enabled)</p>
<p><strong>Option 2:</strong> Using GKE with custom Service Account for Nodes (without WI enabled)</p>
<p>Make sure default compute <code>SA</code> has <code>monitoring.metricWriter</code> and <code>monitoring.viewer</code> roles:</p>
<pre class="codehilite"><code>gcloud projects get-iam-policy $PROJECT_ID
</code></pre>

<p>If you have <code>Editor</code> role or <code>roles/monitoring.metricWriter</code> and <code>role: roles/monitoring.viewer</code> skip the step.
Otherwise add following roles tp SA.</p>
<pre class="codehilite"><code>gcloud projects add-iam-policy-binding $PROJECT_ID \
 --member='serviceAccount:$PROJECT_NUMBER-compute@developer.gserviceaccount.com' \
 --role=roles/monitoring.metricWriter

gcloud projects add-iam-policy-binding $PROJECT_ID \
 --member='serviceAccount:$PROJECT_NUMBER-compute@developer.gserviceaccount.com' \
 --role=roles/monitoring.viewer
</code></pre>

<p><strong>Option 3:</strong> If using GKE with WI, follow the <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-unmanaged#gmp-wli-svcacct">Configure a service account for Workload Identity</a> instructions</p>
<pre class="codehilite"><code>kubectl create ns grafana
</code></pre>

<pre class="codehilite"><code>gcloud iam service-accounts create gmp-test-sa \
&amp;&amp;
gcloud iam service-accounts add-iam-policy-binding \
  --role roles/iam.workloadIdentityUser \
  --member &quot;serviceAccount:gcp-demos-331123.svc.id.goog[grafana/default]&quot; \
  gmp-test-sa@gcp-demos-331123.iam.gserviceaccount.com \
&amp;&amp;
kubectl annotate serviceaccount \
  --namespace grafana \
  default \
  iam.gke.io/gcp-service-account=gmp-test-sa@gcp-demos-331123.iam.gserviceaccount.com
</code></pre>

<pre class="codehilite"><code>gcloud projects add-iam-policy-binding gcp-demos-331123 \
  --member=serviceAccount:gmp-test-sa@gcp-demos-331123.iam.gserviceaccount.com \
  --role=roles/monitoring.viewer
</code></pre>

<p><strong>Option 4:</strong> If using Non-GKE Kubernetes clusters, follow the <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-unmanaged#explicit-credentials">Provide credentials explicitly</a> instructions</p>
<h3 id="22-setup-prometheus-ui-for-gmp">2.2 Setup Prometheus UI for GMP<a class="headerlink" href="#22-setup-prometheus-ui-for-gmp" title="Permanent link">&para;</a></h3>
<p>In order to see if GMP is working and scraping metric, GCP provides Prometheus UI <code>frontend</code> image.</p>
<p>To deploy the Prometheus UI for Managed Service for Prometheus, run the following commands.</p>
<p><strong>Step 1</strong>  Deploy the <code>Prometheus UI</code> frontend service inside of namespace where Grafana going to be installed (or already installed))</p>
<pre class="codehilite"><code>export GRAFANA_NAMESPACE=grafana
</code></pre>

<pre class="codehilite"><code>curl https://raw.githubusercontent.com/GoogleCloudPlatform/prometheus-engine/v0.4.3-gke.0/examples/frontend.yaml |
sed 's/\$PROJECT_ID/gcp-demos-331123/' |
kubectl apply -n $GRAFANA_NAMESPACE -f -
</code></pre>

<p><strong>Step 2</strong>  Port-forward the <code>frontend</code> service to your local machine. The following example forwards the service to port 9090:</p>
<pre class="codehilite"><code>kubectl -n $GRAFANA_NAMESPACE port-forward svc/frontend 8080:9090
</code></pre>

<p>You can access the Prometheus UI in your by using the Web Preview button.</p>
<p>The following screenshot shows a table in the Prometheus UI that displays the <code>up{cluster="k8s-gmp-labs"}</code> metric:</p>
<p><img alt="alt text" src="images/gmp_ui.png" /></p>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see that all pods from <code>example-app</code> and <code>prom-example</code> are being scraped.</p>
</div>
<p><strong>Step 3</strong> Observe  and try to build a dashboards using on the exposed Prometheus metrics emitted by <code>example-app</code> app:</p>
<p>The following metrics are exposed:</p>
<ul>
<li><code>version</code> - of type <em>gauge</em> - containing the app version - as a constant metric value <code>1</code> and label <code>version</code>, representing this app version</li>
<li><code>http_requests_total</code> - of type <em>counter</em> - representing the total numbere of incoming HTTP requests</li>
</ul>
<p>The sample output of the <code>/metric</code> endpoint after 5 incoming HTTP requests shown below.</p>
<p>Note: with no initial incoming request, only <code>version</code> metric is reported.</p>
<pre class="codehilite"><code># HELP http_requests_total Count of all HTTP requests
# TYPE http_requests_total counter
http_requests_total{code=&quot;200&quot;,method=&quot;get&quot;}
# HELP version Version information about this binary
# TYPE version gauge
version{version=&quot;v0.3.0&quot;} 1
</code></pre>

<h3 id="23-use-grafana-with-gmp">2.3 Use Grafana with GMP<a class="headerlink" href="#23-use-grafana-with-gmp" title="Permanent link">&para;</a></h3>
<h4 id="231-install-grafana">2.3.1 Install Grafana<a class="headerlink" href="#231-install-grafana" title="Permanent link">&para;</a></h4>
<p>Google Cloud APIs all require authentication using OAuth2; however, Grafana doesn't support OAuth2 authentication for Prometheus data sources. To use Grafana with Managed Service for Prometheus, we've deployed Prometheus UI as an authentication proxy in a previous step.</p>
<p><strong>Option 1:</strong> Configure existing Grafana Dashboard to use GMP</p>
<p>If you would like to take advantage of you existing Dashboards and already deployed Grafana,
the only steps needed is to create a <code>Data Source</code> for Google Managed Prometheus described in this <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#ui-grafana">reference</a></p>
<p>Once configured you can redirect existing dashboards to the new <code>Data Source</code>, or create the new once.</p>
<p><strong>Option 2:</strong> Configure Grafana Dashboard that comes with GMP </p>
<p>Configure Grafana Dashboard that comes with GMP, following this <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#grafana-deploy">steps</a></p>
<p>If you don't have a running Grafana deployment in your cluster, then you can create an ephemeral test deployment to experiment with.</p>
<p>To create an ephemeral Grafana deployment, apply the Managed Service for Prometheus grafana.yaml manifest to your cluster, and port-forward the grafana service to your local machine. The following example forwards the service to port 3000.</p>
<pre class="codehilite"><code>kubectl -n gmp-test apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/prometheus-engine/v0.4.1/examples/grafana.yaml
</code></pre>

<pre class="codehilite"><code>kubectl -n $GRAFANA_NAMESPACE port-forward svc/grafana 8080:3000
</code></pre>

<p><strong>Option 3:</strong> Use Grafana Helm Charts or Grafana Operator</p>
<p>For production deployment it is preferred to use  <a href="https://artifacthub.io/packages/helm/grafana/grafana">Grafana Helm Chart</a> or <a href="https://artifacthub.io/packages/olm/community-operators/grafana-operator">Grafana Operator</a> as you can define and recreate you dashboards via json or CRDs in consistent manner.</p>
<h4 id="232-configure-grafana-to-work-with-gmp">2.3.2 Configure Grafana to work with GMP<a class="headerlink" href="#232-configure-grafana-to-work-with-gmp" title="Permanent link">&para;</a></h4>
<p>To query Managed Service for Prometheus in Grafana by using the Prometheus UI as the authentication proxy, you must add new data source to Grafana. </p>
<p>To add a data source for the managed service use following <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#grafana-deploy">reference documenation</a></p>
<h2 id="3-verify-gmp-cost">3 Verify GMP Cost<a class="headerlink" href="#3-verify-gmp-cost" title="Permanent link">&para;</a></h2>
<p><strong>Option 1</strong> Estimate Cost based on ingested metrics.</p>
<p><em>Step 1</em> Create a new Grafana Dashboard:</p>
<pre class="codehilite"><code>Data Source: Managed Service for Prometheus

Metric Browser: `rate(gcm_export_samples_exported_total{job=~&quot;.+&quot;,instance=~&quot;.+&quot;}[5m])`

Step: 10
</code></pre>

<p><img alt="alt text" src="images/gmp_cost_calculation.png" /></p>
<p>Example calculation:</p>
<p>N1. 770 Samples per second based on Dashboard value</p>
<p>N2. 770 samples per second * 2628000 seconds/mo = 2023 B samples/mo</p>
<p>N3. Since $0.15/million samples: first 0-50 billion samples#  <a href="https://cloud.google.com/stackdriver/pricing#monitoring-costs">Reference N1</a>  </p>
<p>N4. We can calculate final cost: 2023 B samples/mo * 0.15 = ~303$ per month </p>
<p><strong>Option 2</strong> View your Google Cloud bill</p>
<ol>
<li>
<p>In the Google Cloud console, go to the Billing page.</p>
</li>
<li>
<p>If you have more than one billing account, select Go to linked billing account to view the current project's billing account. To locate a different billing account, select Manage billing accounts and choose the account for which you'd like to get usage reports.</p>
</li>
<li>
<p>Select Reports.</p>
</li>
<li>
<p>From the Services menu, select the Stackdriver Monitoring option.</p>
</li>
<li>
<p>From the SKUs menu, select the following options:</p>
</li>
<li>
<p>Prometheus Samples Ingested</p>
</li>
<li>Monitoring API Requests</li>
</ol>
<h2 id="4-cleanup">4 Cleanup<a class="headerlink" href="#4-cleanup" title="Permanent link">&para;</a></h2>
<p>Delete Kubernetes cluster as it will enquire cost both for GKE and GMP.</p>
<p>Delete GKE cluster:</p>
<pre class="codehilite"><code>gcloud container clusters delete k8s-gmp-labs --region us-central1
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
