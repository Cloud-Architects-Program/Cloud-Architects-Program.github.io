<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm - Cloud Architecture</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Cloud Architecture</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT020 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Lab_Terraform_Fundamentals" class="dropdown-item">Module 2 Terraform Fundamentals</a>
</li>
            
<li>
    <a href="../020_Lab_4_Traffic_control/" class="dropdown-item">Module 8 Traffic Management</a>
</li>
            
<li>
    <a href="../020_Lab_5_EFK/" class="dropdown-item">Module 9 EFK Stack</a>
</li>
            
<li>
    <a href="../020_Lab_6_Prometheus/" class="dropdown-item">Module 10 Monitoring with Prometheus</a>
</li>
            
<li>
    <a href="../020_Lab_6_GMP/" class="dropdown-item">Module 10 Monitoring with GMP</a>
</li>
            
<li>
    <a href="../020_Lab_9_GitOps/" class="dropdown-item">Module 11 GitOps with Flux</a>
</li>
            
<li>
    <a href="../020_Lab_10_cloudrun/" class="dropdown-item">MOdule 12 Serverless Cloud Run</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Assignment_Terraform_Foundation/" class="dropdown-item">Module 2</a>
</li>
            
<li>
    <a href="../020_Module_3_Assignment_Production_GKE/" class="dropdown-item">Module 3</a>
</li>
            
<li>
    <a href="../020_Module_4_Assignment_Production_GKE.md" class="dropdown-item">Module 4</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT019 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_Module_5_Lab_Docker_basics/" class="dropdown-item">Module 5 Lab - Docker Basics</a>
</li>
            
<li>
    <a href="../ycit019_Module_6_Lab_Advanced_Docker/" class="dropdown-item">Module 6 Lab - Advanced Docker</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm</a>
</li>
            
<li>
    <a href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="dropdown-item">Module 8 Lab - Kuberenetes Concepts</a>
</li>
            
<li>
    <a href="../ycit019_Module_9_Kubernetes_Features/" class="dropdown-item">Module 9 Lab - Kubernetes Features</a>
</li>
            
<li>
    <a href="../ycit019_Module_10_Kubernetes_Scaling/" class="dropdown-item">Module 9 Part 2 Lab Kubernetes Autoscaling</a>
</li>
            
<li>
    <a href="../ycit019_Lab_10_Networking/" class="dropdown-item">Module 10 Lab - Kubernetes Networking</a>
</li>
            
<li>
    <a href="../ycit019_Lab_11_Storage/" class="dropdown-item">Module 11 Lab - Kubernetes Storage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_ass1/" class="dropdown-item">Module 5 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass1_sol/" class="dropdown-item">Module 5 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass2/" class="dropdown-item">Module 6 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass2_solution/" class="dropdown-item">Module 6 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass3/" class="dropdown-item">Module 8 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass3_solution/" class="dropdown-item">Module 8 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass4_2022/" class="dropdown-item">Module 9 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass4_sol/" class="dropdown-item">Module 9 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass7/" class="dropdown-item">Module 10 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass6_solution/" class="dropdown-item">Module 10 Assignment Solution</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ycit019_Module_6_Lab_Advanced_Docker/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#deploy-kubernetes" class="nav-link">Deploy Kubernetes</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-deploy-kubernetes-and-calico-with-kubeadm" class="nav-link">1. Deploy Kubernetes and Calico with Kubeadm</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="deploy-kubernetes">Deploy Kubernetes<a class="headerlink" href="#deploy-kubernetes" title="Permanent link">&para;</a></h1>
<p>In this Lab, we are going to:</p>
<ul>
<li>Deploy Single Node Kubernetes cluster using <strong>kubeadm</strong> on a Google Compute Engine node</li>
<li>Deploy an application to  Kubernetes</li>
</ul>
<h2 id="1-deploy-kubernetes-and-calico-with-kubeadm">1. Deploy Kubernetes and Calico with Kubeadm<a class="headerlink" href="#1-deploy-kubernetes-and-calico-with-kubeadm" title="Permanent link">&para;</a></h2>
<p>In general to deploy Kubernetes with <code>kubeadm</code> it is required to use following official Kubernetes <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/">documentation</a>.</p>
<p><strong>Step 1</strong> Set the Project ID in  Environment Variable: </p>
<pre class="codehilite"><code>export PROJECT_ID=&lt;project_id&gt;
</code></pre>

<p>Here is how you can find you project_ID:</p>
<p><img alt="Project ID" src="/images/porject_id_png.png" title="Locate project_id" /></p>
<p>Set the project ID as default</p>
<pre class="codehilite"><code>gcloud config set project $PROJECT_ID
</code></pre>

<h3 id="11-create-a-vm-and-ssh-into-it">1.1 Create a VM, and ssh into it<a class="headerlink" href="#11-create-a-vm-and-ssh-into-it" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Create the Compute instance</p>
<p>The compute instances in this lab will be provisioned using Ubuntu Server 20.04, which has good support for the containerd container runtime. </p>
<pre class="codehilite"><code>gcloud compute instances create k8s-cluster \
--zone us-central1-c \
--machine-type=e2-standard-4 \
--can-ip-forward \
--image-family ubuntu-2004-lts \
--image-project ubuntu-os-cloud
</code></pre>

<p><strong>Step 2</strong> SSH in to VM where we going to install Kubernetes:</p>
<pre class="codehilite"><code>gcloud compute ssh --zone &quot;us-central1-c&quot; &quot;k8s-cluster&quot;
</code></pre>

<h3 id="12-install-containerd">1.2 Install Containerd<a class="headerlink" href="#12-install-containerd" title="Permanent link">&para;</a></h3>
<p>Docker has been deprecated from Kubernetes starting K8s 1.24, so we will need to intall containerd instaed</p>
<p><strong>Step 1</strong> Update the apt package index and install containerd:</p>
<pre class="codehilite"><code>sudo su
apt update
</code></pre>

<pre class="codehilite"><code>apt install containerd
</code></pre>

<p>Pres Y, to install packages.</p>
<p><strong>Step 2</strong> Enable systemd to start on reboot:</p>
<pre class="codehilite"><code>systemctl enable containerd
systemctl start containerd
systemctl status containerd
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>● containerd.service - containerd container runtime
     Loaded: loaded (/lib/systemd/system/containerd.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2022-05-18 21:33:39 UTC; 8s ago
       Docs: https://containerd.io
   Main PID: 2106 (containerd)
      Tasks: 15
     Memory: 23.3M
     CGroup: /system.slice/containerd.service
             └─2106 /usr/bin/containerd
</code></pre>

<p><strong>Step 3</strong> To interact with containerd Install nerdctl:</p>
<pre class="codehilite"><code>wget https://github.com/containerd/nerdctl/releases/download/v0.18.0/nerdctl-0.18.0-linux-amd64.tar.gz
tar zxvf nerdctl-0.18.0-linux-amd64.tar.gz nerdctl
mv nerdctl /usr/local/bin
</code></pre>

<p><strong>Step 4</strong> Install CNI Plugins to test containerd can start containers:</p>
<pre class="codehilite"><code>wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz
mkdir -p /opt/cni/bin/
tar zxvf cni-plugins-linux-amd64-v1.1.1.tgz -C /opt/cni/bin/
</code></pre>

<p><strong>Step 5</strong> Run a Docker like command with Nerdctl to start test <code>ubuntu</code> container:</p>
<p>See Nerdctl CLI reference <a href="https://github.com/containerd/nerdctl">here</a></p>
<pre class="codehilite"><code>nerdctl run -d ubuntu bash
</code></pre>

<pre class="codehilite"><code>nerdctl ps -a
</code></pre>

<div class="admonition sucess">
<p class="admonition-title">Sucess</p>
<p>We can see our docker container been started few seconds ago.</p>
</div>
<h3 id="13-let-iptables-see-bridged-traffic">1.3 Let iptables see bridged traffic<a class="headerlink" href="#13-let-iptables-see-bridged-traffic" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code>cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# sysctl params required by setup, params persist across reboots
cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

# Apply sysctl params without reboot
sudo sysctl --system
</code></pre>

<h3 id="14-install-kubeadm-and-prerequisite-packages-on-each-node">1.4 Install kubeadm and prerequisite packages on each node<a class="headerlink" href="#14-install-kubeadm-and-prerequisite-packages-on-each-node" title="Permanent link">&para;</a></h3>
<p>The next step is to install <code>kubeadm</code> and prerequisite packages as showed <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl">here.</a></p>
<p><strong>Step 1</strong> Deploy <code>kubeadm</code> and prerequisite packages</p>
<p>Update the apt package index and install packages needed to use the Kubernetes apt repository:</p>
<pre class="codehilite"><code>apt-get update &amp;&amp; apt-get install -y apt-transport-https ca-certificates curl
</code></pre>

<p>Download the Google Cloud public signing key:</p>
<pre class="codehilite"><code>sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
</code></pre>

<p>Add the Kubernetes apt repository:</p>
<pre class="codehilite"><code>echo &quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot; | sudo tee /etc/apt/sources.list.d/kubernetes.list
</code></pre>

<p>Update apt package index, install kubelet, kubeadm and kubectl, and pin their version:</p>
<pre class="codehilite"><code>sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
</code></pre>

<p><strong>Step 2</strong> Verify <code>kubeadm</code> version</p>
<pre class="codehilite"><code>kubeadm version
</code></pre>

<p>Output:</p>
<pre class="codehilite"><code>kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;24&quot;, GitVersion:&quot;v1.24.0&quot;, GitCommit:&quot;4ce5a8954017644c5420bae81d72b09b735c21f0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-05-03T13:44:24Z&quot;, GoVersion:&quot;go1.18.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;}
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result<p>Latest available version of Kubernetes/kubeadm has been installed from <a href="https://github.com/kubernetes/kubernetes/releases">GitHub Kubernetes repo release page.</a></p>
</p>
</div>
<h3 id="15-kubeadm-init-the-master">1.5 'Kubeadm init' the Master<a class="headerlink" href="#15-kubeadm-init-the-master" title="Permanent link">&para;</a></h3>
<p><strong>Run On the Master node only:</strong></p>
<p><strong>Step 1:</strong> Build kubeadm Custom Config</p>
<pre class="codehilite"><code>cat &lt;&lt;EOF &gt; kubeadm-config.yaml
kind: ClusterConfiguration
apiVersion: kubeadm.k8s.io/v1beta3
kubernetesVersion: v1.24.0
---
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
cgroupDriver: systemd
EOF
</code></pre>

<p>Make sure the IP address was updated:</p>
<pre class="codehilite"><code>cat  kubeadm-config.yaml
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To expose custom Config you can create a  kubeadm.conf and specify
    during <code>kubecadm init</code> execution. For instance:</p>
<pre class="codehilite"><code>    * ControllerManager configs
    * Custom Subnet
    * Custom version
    * Apiserver configs such as authentication, authorization and etc.
</code></pre>

</div>
<p><strong>Step 2:</strong> Create a cluster</p>
<pre class="codehilite"><code>kubeadm init --config=kubeadm-config.yaml
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result<p>Once the command completes, configure the KUBECONFIG env variable with the path to admin.conf (recommend adding it to your .bashrc):</p>
</p>
</div>
<pre class="codehilite"><code>  mkdir -p $HOME/.kube
  cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  chown $(id -u):$(id -g) $HOME/.kube/config
  export KUBECONFIG=$HOME/.kube/config
</code></pre>

<p>Let's validate that the installation was successful. You should now be able to run kubectl commands and see that all cluster Pods
are running (except DNS one):</p>
<pre class="codehilite"><code>watch kubectl get pods --all-namespaces -o wide
</code></pre>

<p>To exit back to the terminal, press ctrl+c</p>
<h3 id="16-deploy-cilium-cni">1.6 Deploy Cilium CNI<a class="headerlink" href="#16-deploy-cilium-cni" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Download Helm Package manager:</p>
<pre class="codehilite"><code>wget https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz
</code></pre>

<pre class="codehilite"><code>tar -zxvf helm-v3.8.2-linux-amd64.tar.gz
</code></pre>

<pre class="codehilite"><code>mv linux-amd64/helm /usr/local/bin/helm
</code></pre>

<p><strong>Step 1</strong>  Setup Helm Cilium repository:</p>
<pre class="codehilite"><code>helm repo add cilium https://helm.cilium.io/
</code></pre>

<p><strong>Step 3</strong>  Now lets deploy Cilium Networking</p>
<pre class="codehilite"><code>helm install cilium cilium/cilium --version 1.9.16 --namespace kube-system
</code></pre>

<p>Watch the Cilium/node pod for the master get created (hopefully successfully)</p>
<pre class="codehilite"><code>watch kubectl get pods --all-namespaces -o wide
</code></pre>

<h3 id="17-join-worker-node">1.7 Join worker node<a class="headerlink" href="#17-join-worker-node" title="Permanent link">&para;</a></h3>
<p>If you have other nodes around you can run the 'kubeadm join ...' command from
the output of kubeadm init on each worker node (incl token).
Watch the calico/node pods get created for each worker node automatically.</p>
<pre class="codehilite"><code>e.g. kubeadm join --token ****
</code></pre>

<p>For this lab, we are creating a one node kubernetes clusters, so in order to be able to deploy applications on the same node as the control plane, we need to remove the taint that prevent such deployment.</p>
<pre class="codehilite"><code>kubectl taint nodes --all node-role.kubernetes.io/master:NoSchedule-
</code></pre>

<h3 id="18-now-lets-create-a-test-deployment-with-2-replicas">1.8 Now lets create a test deployment with 2 replicas<a class="headerlink" href="#18-now-lets-create-a-test-deployment-with-2-replicas" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code>kubectl create deployment nginx --replicas=2 --image=nginx --port=8080
</code></pre>

<p>Lets get some more detail about the deployment:</p>
<pre class="codehilite"><code>kubectl describe deployment nginx
kubectl get deployment nginx
</code></pre>

<p>And pods that has been created by <code>nginx</code> deployment:</p>
<pre class="codehilite"><code>kubectl get pods
</code></pre>

<p><strong>Congrats. Now you have a working Kubernetes+Calico cluster.</strong></p>
<h3 id="21-verify-kubernetes-components-deployed-by-kubeadm">2.1 Verify Kubernetes components deployed by kubeadm<a class="headerlink" href="#21-verify-kubernetes-components-deployed-by-kubeadm" title="Permanent link">&para;</a></h3>
<h4 id="211-check-kubernetes-version">2.1.1 Check Kubernetes version<a class="headerlink" href="#211-check-kubernetes-version" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Verify that Kubernetes is deployed and working.</p>
<pre class="codehilite"><code class="language-shell">kubectl get nodes
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<ul>
<li>Kubernetes has single node for workload scheduling.</li>
<li>Kubernetes running version 1.24.0</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note<p>At Kubernetes community, we define 3 types of Kubernetes releases:</p>
<ul>
<li>Major (x.0.0)</li>
<li>Minor (x.x.0)</li>
<li>Patch (x.x.x)</li>
</ul>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note<p>At a single point of time, we develop the new "Major"/"Minor" version of Kubernetes (today - Kubernetes 1.21), and we support three existing releases as the "Patch" releases (today - 1.19.x, 1.20.x and 1.21.x).</p>
</p>
</div>
<h4 id="212-verify-cluster-default-namespaces">2.1.2 Verify Cluster default namespaces.<a class="headerlink" href="#212-verify-cluster-default-namespaces" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Verify namespaces created in K8s systems</p>
<pre class="codehilite"><code class="language-shell">$ kubectl get ns
NAME              STATUS   AGE
default           Active   5h50m
kube-node-lease   Active   5h50m
kube-public       Active   5h50m
kube-system       Active   5h50m
</code></pre>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Namespaces are intendent to isolate groups/teams and give them access to
a set of resources. They avoid name collisions between resources. Namespaces
provides with a soft Multitenancy, meaning they not provide full isolation.</p>
</div>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>By default Kubernetes deployed by <code>kubeadm</code> starts with 4 namespaces:</p>
<ul>
<li><code>default</code> The default namespace for objects with no other namespace. When
listing resources with the kubectl get command, we’ve never specified the
namespace explicitly, so kubectl always defaulted to the default namespace,
showing us just the objects inside that namespace.</li>
<li><code>kube-system</code> The namespace for objects created by the Kubernetes system</li>
<li><code>kube-public</code> Readable by all users, and mostly reserved for cluster usage.</li>
<li><code>kube-node-lease</code> This namespace for the lease objects associated with each node which improves the performance of the node heartbeats as the cluster scales.</li>
</ul>
</div>
<h4 id="213-verify-kubelet">2.1.3 Verify kubelet<a class="headerlink" href="#213-verify-kubelet" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Verify that <code>kubelet</code> installed in K8s Cluster:</p>
<pre class="codehilite"><code>systemctl -l | grep kubelet
systemctl status kubelet
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Service and its config file can be found in <code>/etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code></p>
</div>
<p><strong>Step 2</strong> Find manifests file for other master Node components:</p>
<p>Once <code>kubelet</code> is deployed, all the rest master node components are
deployed as a <code>static pods</code> on Kubernetes Master node. Setting <code>--pod-manifest-path=</code>
specifies from where to read Static Pod manifests used for spinning up the
control plane.</p>
<p><strong>Step 3</strong> List K8s components manifest files that is going to be used for cluster deployment
and run as <code>Static Pods</code> by <code>kubelet</code>:</p>
<pre class="codehilite"><code>sudo ls /etc/kubernetes/manifests
</code></pre>

<pre class="codehilite"><code>etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We see etcd, api-server, controller-manager and scheduler that has been
used to deploy on this cluster and managed by <code>kubelet</code>.</p>
</div>
<p><strong>Step 4</strong> Verify K8s Components deployed as containers on K8s:</p>
<pre class="codehilite"><code>kubectl get pods -n kube-system
</code></pre>

<pre class="codehilite"><code>NAME                                       READY   STATUS    RESTARTS   AGE
calico-kube-controllers-6d7b4db76c-h242g   1/1     Running   0          27m
calico-node-gwnng                          1/1     Running   0          27m
coredns-74ff55c5b-5s7rp                    1/1     Running   0          5h59m
coredns-74ff55c5b-l6hd4                    1/1     Running   0          5h59m
etcd-k8s-cluster                           1/1     Running   0          5h59m
kube-apiserver-k8s-cluster                 1/1     Running   0          5h59m
kube-controller-manager-k8s-cluster        1/1     Running   0          5h59m
kube-proxy-f8647                           1/1     Running   0          5h59m
kube-scheduler-k8s-cluster                 1/1     Running   0          5h59m
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<ul>
<li>We can see that Kubernetes components: etcd, api-server, controller-manager
 and scheduler deployed on K8s cluster via kubelet.</li>
<li>Calico Networking including calico-etcd, calico-node, calico-policy-controller
has been deployed as a last step of kubeadm installation</li>
<li>Or Cilium Networking containers</li>
</ul>
</div>
<h4 id="214-verify-etcd-database-deployment">2.1.4 Verify etcd database deployment.<a class="headerlink" href="#214-verify-etcd-database-deployment" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Verify <code>etcd</code> config file</p>
<pre class="codehilite"><code>sudo cat /etc/kubernetes/manifests/etcd.yaml
</code></pre>

<p><strong>Step 2</strong>  Overview <code>etcd</code> pod deployed on K8s cluster:</p>
<pre class="codehilite"><code>kubectl get pods -n kube-system | grep etcd
kubectl describe pods/etcd-k8s-cluste -n kube-system
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<ul>
<li><code>etcd</code> has been deployed as a static pod.</li>
<li>Annotation <code>Priority Class Name:  system-node-critical</code> tells to K8s that this
Pod is  critical and will have highest <code>QOS</code>.</li>
</ul>
</div>
<p><strong>Step 3</strong> Check the location of etcd db and snapshot dumps.</p>
<pre class="codehilite"><code>sudo ls /var/lib/etcd/member
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>The data directory has two sub-directories in it:</p>
<ul>
<li>wal: write ahead log files are stored here.</li>
<li>snap: log snapshots are stored here.</li>
</ul>
<p>When first started, etcd stores its configuration into a data directory specified by the data-dir configuration parameter. Configuration is stored in the write ahead log and includes: the local member ID, cluster ID, and initial cluster configuration. The write ahead log and snapshot files are used during member operation and to recover after a restart.</p>
</div>
<h4 id="215-verify-api-server-deployment-on-the-k8s-cluster">2.1.5 Verify <code>api-server</code> deployment on the K8s cluster.<a class="headerlink" href="#215-verify-api-server-deployment-on-the-k8s-cluster" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Review configuration file:</p>
<pre class="codehilite"><code>sudo cat /etc/kubernetes/manifests/kube-apiserver.yaml
</code></pre>

<p><strong>Step 2</strong> Overview <code>api-server</code> pod and its parameters.</p>
<pre class="codehilite"><code>kubectl describe pods/kube-apiserver-k8s-cluster -n kube-system
</code></pre>

<h4 id="216-verify-controller-manager-and-scheduler-deployment">2.1.6 Verify <code>Controller-manager</code> and <code>scheduler</code> deployment.<a class="headerlink" href="#216-verify-controller-manager-and-scheduler-deployment" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> <code>Controller-manager</code> and <code>scheduler</code> deployed on K8s cluster via kubelet
the same way <code>api-server</code>. Verify both configuration files and pods running on K8s Cluster.</p>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<ul>
<li>K8s is an orchestration system for containers. Since most of the k8s
components are the <code>go</code> binaries that can be containerized, K8s has been
designed to run itself. This makes system  itself HA, easily deployable,
scaleable and upgradable.</li>
</ul>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
