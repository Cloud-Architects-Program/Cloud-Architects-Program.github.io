
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cloud-architects-program.github.io/ycit019_Lab_10_Networking/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>K8s Networking - Cloud Architecture</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#k8s-networking" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cloud Architecture" class="md-header__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud Architecture
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              K8s Networking
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cloud Architecture" class="md-nav__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    Cloud Architecture
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cloud Native Administrator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Cloud Native Administrator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 5 - Docker Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Module 5 - Docker Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../presentation5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_5_Lab_Docker_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 6 - Advanced Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Module 6 - Advanced Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_6_Lab_Advanced_Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 7 - Introduction to Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Module 7 - Introduction to Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 8 - Kuberenetes Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Module 8 - Kuberenetes Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_8_Lab_Kubernetes_Concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-create-gke-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      0 Create GKE Cluster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-network-policy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Network Policy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Network Policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-basic-policy-demo" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Basic Policy Demo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-demo-stars-policy" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 (Demo) Stars Policy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 (Demo) Stars Policy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-deploy-3-tier-app" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 Deploy 3 tier-app
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-enable-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 Enable isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.3 Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      2. Ingress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Ingress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-deploy-an-application" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Deploy an Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-creating-single-service-ingress-rule" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Creating Single Service Ingress rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-simple-fanout" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Simple fanout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-cleaning-up" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 Cleaning Up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="k8s-networking">K8s Networking<a class="headerlink" href="#k8s-networking" title="Permanent link">&para;</a></h1>
<p><strong>Objective:</strong></p>
<ul>
<li>Kubernetes <code>Network Policy</code></li>
<li>Run applications and expose them via service via <code>Ingress</code> resource.</li>
</ul>
<h2 id="0-create-gke-cluster">0 Create GKE Cluster<a class="headerlink" href="#0-create-gke-cluster" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Enable the Google Kubernetes Engine API.</p>
<div class="codehilite"><pre><span></span><code>gcloud services enable container.googleapis.com
</code></pre></div>

<p><strong>Step 2</strong> From the cloud shell, run the following command to create a cluster with 1 node:</p>
<div class="codehilite"><pre><span></span><code>gcloud container clusters create k8s-networking \
--zone us-central1-c \
--enable-network-policy \
--num-nodes 2
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use GKE Ingress, you must have the HTTP(S) Load Balancing add-on enabled. GKE clusters have HTTP(S) Load Balancing enabled by default;</p>
</div>
<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME          LOCATION       MASTER_VERSION   MASTER_IP      MACHINE_TYPE  NODE_VERSION     NUM_NODES  STATUS
k8s-scaling  us-central1-c  1.19.9-gke.1400  34.121.222.83  e2-medium     1.19.9-gke.1400  2          RUNNING
</code></pre></div>

<p><strong>Step 3</strong> Authenticate to the cluster.</p>
<div class="codehilite"><pre><span></span><code>gcloud container clusters get-credentials k8s-networking --zone us-central1-c
</code></pre></div>

<h2 id="1-network-policy">1. Network Policy<a class="headerlink" href="#1-network-policy" title="Permanent link">&para;</a></h2>
<h3 id="11-basic-policy-demo">1.1 Basic Policy Demo<a class="headerlink" href="#11-basic-policy-demo" title="Permanent link">&para;</a></h3>
<p>This guide will deploy pods in a Kubernetes Namespaces. Let’s create the
Namespace object for this guide.</p>
<p><strong>Step 1</strong> Create <code>policy-demo</code> Namespace:</p>
<div class="codehilite"><pre><span></span><code>kubectl create ns policy-demo
</code></pre></div>

<p><strong>Step 2</strong> Than create a <code>policy-demo</code> nginx deployment in <code>policy-demo</code>
namespace:</p>
<div class="codehilite"><pre><span></span><code>kubectl create deployment --namespace=policy-demo nginx --replicas=2 --image=nginx
</code></pre></div>

<p>Then create a <code>policy-demo</code> service:</p>
<div class="codehilite"><pre><span></span><code>kubectl expose --namespace=policy-demo deployment nginx --port=80
</code></pre></div>

<p><strong>Step 3</strong> Ensure  nginx service is accessible. In order to do that
create <code>busybox</code> pod and try to access the <code>nginx</code> service.</p>
<div class="codehilite"><pre><span></span><code>kubectl run --namespace=policy-demo access --rm -ti --image busybox /bin/sh
</code></pre></div>

<p>Output: </p>
<div class="codehilite"><pre><span></span><code>Waiting for pod `policy-demo/access-472357175-y0m47` to be running, status is
Pending, pod ready: false
</code></pre></div>

<p>If you don't see a command prompt, try pressing enter.</p>
<div class="codehilite"><pre><span></span><code>/ # wget -q nginx -O -
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>You should see a response from <code>nginx</code>. Great! Our service is accessible.
You can exit the Pod now.</p>
</div>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Pods in a given namespace can be accessed by anyone.</p>
</div>
<p><strong>Step 4</strong> Now let’s turn <code>on</code> isolation in our policy-demo Namespace.
Calico will then prevent connections to pods in this Namespace.
In order for Calico to prevent connection to pods in a namespace, we first need
to enable network isolation in the namespace by creating following <code>NetworkPolicy</code>:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: default-deny
  namespace: policy-demo
spec:
  podSelector:
    matchLabels: {}
EOF
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Current Lab is using Calico v3.0. Older versions of Calico
(2.1 and prior) used namespace annotation to deny all traffic.</p>
</div>
<p><strong>Step 5</strong> Verify that all access to the nginx Service is blocked.
We can see the effect by trying to access the Service again.</p>
<p>In order to do that, run a <code>busybox</code> deployment and try to access the <code>nginx</code>
service.</p>
<div class="codehilite"><pre><span></span><code>kubectl run --namespace=policy-demo access --rm -ti --image busybox /bin/sh
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Waiting for pod policy-demo/access-472357175-y0m47 to be running, status is
Pending, pod ready: false
</code></pre></div>

<p>If you don't see a command prompt, try pressing enter.</p>
<div class="codehilite"><pre><span></span><code>/ # wget -q --timeout=5 nginx -O -
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p><code>download timed out</code></p>
</div>
<p>The request should time out after 5 seconds. By enabling isolation on the
Namespace, we’ve prevented access to the Service.</p>
<p><strong>Step 6</strong> Allow Access using a NetworkPolicy</p>
<p>Now, let’s enable access to the nginx Service using a NetworkPolicy.
This will allow incoming connections from our access Pod, but not from anywhere
else.</p>
<p>Create a network policy <code>access-nginx</code> with the following contents:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: access-nginx
  namespace: policy-demo
spec:
  podSelector:
    matchLabels:
      app: nginx
  ingress:
    - from:
      - podSelector:
          matchLabels:
            run: access
EOF
</code></pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>The NetworkPolicy allows traffic from Pods with the label <code>run: access</code> to Pods with the label <code>app: nginx</code>. The labels are automatically added by kubectl and are based on the name of the resource.</p>
</div>
<p><strong>Step 7:</strong> We should now be able to access the Service from the <code>access</code> Pod.</p>
<p>In order to check that create <code>busybox</code> deployment and try to access the <code>nginx</code>
Service.</p>
<div class="codehilite"><pre><span></span><code>kubectl run --namespace=policy-demo access --rm -ti --image busybox /bin/sh
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Waiting for pod policy-demo/access-472357175-y0m47 to be running, status is
Pending, pod ready: false
</code></pre></div>

<p>If you don't see a command prompt, try pressing enter.</p>
<div class="codehilite"><pre><span></span><code>/ # wget -q --timeout=5 nginx -O -
</code></pre></div>

<p><strong>Step 8</strong> Without closing a prompt to a container, open a new terminal and run</p>
<div class="codehilite"><pre><span></span><code>kubectl get pods --show-labels -n policy-demo 
</code></pre></div>

<p><strong>Output:</strong> </p>
<div class="codehilite"><pre><span></span><code>NAME                     READY   STATUS    RESTARTS   AGE   LABELS
access                   1/1     Running   0          5s    run=access
nginx-6799fc88d8-5r64l   1/1     Running   0          17m   app=nginx,pod-template-hash=6799fc88d8
nginx-6799fc88d8-dbtgk   1/1     Running   0          17m   app=nginx,pod-template-hash=6799fc88d8
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see the Labels <code>run=access</code> and <code>app=nginx</code>, that has been defined in Network Policy.</p>
</div>
<p><strong>Step 9</strong> However, we still cannot access the Service from a Pod without the
label <code>run: access:</code></p>
<p>Once again run <code>busybox</code> deployment and try to access the <code>nginx</code> service.</p>
<div class="codehilite"><pre><span></span><code>kubectl run --namespace=policy-demo cant-access --rm -ti --image busybox /bin/sh
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Waiting for pod policy-demo/cant-access-472357175-y0m47 to be running, status
is Pending, pod ready: false
</code></pre></div>

<p>If you don't see a command prompt, try pressing enter.</p>
<div class="codehilite"><pre><span></span><code>/ # wget -q --timeout=5 nginx -O -
wget: download timed out
/ #
</code></pre></div>

<p><strong>Step 9</strong> You can clean up the demo by deleting the demo Namespace:</p>
<div class="codehilite"><pre><span></span><code>kubectl delete ns policy-demo
</code></pre></div>

<h3 id="12-demo-stars-policy">1.2 (Demo) Stars Policy<a class="headerlink" href="#12-demo-stars-policy" title="Permanent link">&para;</a></h3>
<h4 id="121-deploy-3-tier-app">1.2.1 Deploy 3 tier-app<a class="headerlink" href="#121-deploy-3-tier-app" title="Permanent link">&para;</a></h4>
<p>Let's Deploy 3 tier-app: UI, frontend and backend service, as well as a client
service.  And configures network policy on each service.</p>
<p><strong>Step 1</strong> Deploy <code>Stars</code> Namespace and <code>management-ui</code> apps inside it:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
---
kind: Namespace
apiVersion: v1
metadata:
  name: stars
---
apiVersion: v1
kind: Namespace
metadata:
  name: management-ui
  labels:
    role: management-ui
---
apiVersion: v1
kind: Service
metadata:
  name: management-ui
  namespace: management-ui
spec:
  type: LoadBalancer
  ports:
  - port: 9001
    targetPort: 9001
  selector:
    role: management-ui
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: management-ui
  labels:
    role: management-ui
  namespace: management-ui
spec:
  selector:
    matchLabels:
      role: management-ui
  replicas: 1
  template:
    metadata:
      labels:
        role: management-ui
    spec:
      containers:
      - name: management-ui
        image: calico/star-collect:v0.1.0
        imagePullPolicy: Always
        ports:
        - containerPort: 9001
EOF
</code></pre></div>

<p><strong>Step 2</strong> Deploy <code>backend</code> application inside of the  <code>stars</code> Namespace:</p>
<p>Backend:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
apiVersion: v1
kind: Service
metadata:
  name: backend
  namespace: stars
spec:
  ports:
  - port: 6379
    targetPort: 6379
  selector:
    role: backend
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  labels:
    role: backend
  namespace: stars
spec:
  selector:
    matchLabels:
      role: backend
  replicas: 1
  template:
    metadata:
      labels:
        role: backend
    spec:
      containers:
      - name: backend
        image: calico/star-probe:v0.1.0
        imagePullPolicy: Always
        command:
        - probe
        - --http-port=6379
        - --urls=http://frontend.stars:80/status,http://backend.stars:6379/status,http://client.client:9000/status
        ports:
        - containerPort: 6379
EOF
</code></pre></div>

<p><strong>Step 3</strong> Deploy <code>frontend</code> application inside of the <code>stars</code> Namespace:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: stars
spec:
  ports:
  - port: 80
    targetPort: 80
  selector:
    role: frontend
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  labels:
    role: frontend
  namespace: stars
spec:
  selector:
    matchLabels:
      role: frontend
  replicas: 1
  template:
    metadata:
      labels:
        role: frontend
    spec:
      containers:
      - name: frontend
        image: calico/star-probe:v0.1.0
        imagePullPolicy: Always
        command:
        - probe
        - --http-port=80
        - --urls=http://frontend.stars:80/status,http://backend.stars:6379/status,http://client.client:9000/status
        ports:
        - containerPort: 80
EOF
</code></pre></div>

<p><strong>Step 4</strong> Finally deploy <code>client</code> application inside of the <code>client</code> Namespace:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: Namespace
apiVersion: v1
metadata:
  name: client
  labels:
    role: client
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: client
  labels:
    role: client
  namespace: client
spec:
  selector:
    matchLabels:
      role: client
  replicas: 1
  template:
    metadata:
      labels:
        role: client
    spec:
      containers:
      - name: client
        image: calico/star-probe:v0.1.0
        imagePullPolicy: Always
        command:
        - probe
        - --urls=http://frontend.stars:80/status,http://backend.stars:6379/status
        ports:
        - containerPort: 9000
---
apiVersion: v1
kind: Service
metadata:
  name: client
  namespace: client
spec:
  ports:
  - port: 9000
    targetPort: 9000
  selector:
    role: client
EOF
</code></pre></div>

<p><strong>Step 5</strong> Wait for all the pods to enter <code>Running</code> state.</p>
<div class="codehilite"><pre><span></span><code>kubectl get pods --all-namespaces --watch
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It may take several minutes to download the necessary Docker images for this
demo.</p>
</div>
<p><strong>Step 6</strong> Locate LoadBalancer IP:</p>
<div class="codehilite"><pre><span></span><code>kubectl get svc -n management-ui
</code></pre></div>

<p><strong>Step 9</strong> Open UI in you browser <code>http://EXTERNAL-IP:9001</code> in a browser.</p>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Once all the pods are started, they should have full connectivity. You can see
this by visiting the UI.  Each service is represented by a single node in the
graph.</p>
<ul>
<li><code>backend</code> -&gt; Node "B"</li>
<li><code>frontend</code> -&gt; Node "F"</li>
<li><code>client</code> -&gt; Node "C"</li>
</ul>
</div>
<h4 id="122-enable-isolation">1.2.2 Enable isolation<a class="headerlink" href="#122-enable-isolation" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> Enable isolation</p>
<p>Running the following commands will prevent all Ingress access to the frontend, backend,
and client Services located in namespaces <code>starts</code> and <code>client</code></p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: default-deny
  namespace: stars
spec:
  podSelector:
    matchLabels: {}
  ingress: []
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: default-deny
  namespace: client
spec:
  podSelector:
    matchLabels: {}
  policyTypes:
  - Ingress
EOF
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Now that we've enabled isolation, the UI can no longer access the pods, and
so they will no longer show up in the UI.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to Refresh web-browser to see result.</p>
</div>
<p><strong>Step 2</strong> Allow apps from <code>stars</code> and <code>client</code> namespace access <code>UI</code> service via <code>NetworkPolicy</code> rules:</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  namespace: stars
  name: allow-ui
spec:
  podSelector:
   matchLabels: {}
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              role: management-ui
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  namespace: client
  name: allow-ui
spec:
  podSelector:
   matchLabels: {}
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              role: management-ui
EOF
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>refresh the UI - it should now show the Services, but they
should not be able to access each other any more.</p>
</div>
<p><strong>Step 4</strong> Create the <code>NetworkPolicy</code> to allow traffic from the
frontend to the backend.</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  namespace: stars
  name: backend-policy
spec:
  podSelector:
    matchLabels:
      role: backend
  ingress:
    - from:
        - podSelector:
            matchLabels:
              role: frontend
      ports:
        - protocol: TCP
          port: 6379
EOF
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Refresh the UI.  You should see the following:</p>
<ul>
<li>The frontend can now access the backend (on TCP port 80 only).</li>
<li>The backend cannot access the frontend at all.</li>
<li>The client cannot access the frontend, nor can it access the backend.</li>
</ul>
</div>
<p><strong>Step 5</strong> Expose the frontend service to the <code>client</code> namespace.</p>
<div class="codehilite"><pre><span></span><code>kubectl create -f - &lt;&lt;EOF
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  namespace: stars
  name: frontend-policy
spec:
  podSelector:
    matchLabels:
      role: frontend
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              role: client
      ports:
        - protocol: TCP
          port: 80
EOF
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We isolated our app using <code>NetworkPolicy</code> ingress rules so that:</p>
<ul>
<li>The client can now access the frontend, but not the backend.</li>
<li>Neither the frontend nor the backend can initiate connections to the client.</li>
<li>The frontend can still access the backend.</li>
</ul>
</div>
<h4 id="123-cleanup">1.2.3 Cleanup<a class="headerlink" href="#123-cleanup" title="Permanent link">&para;</a></h4>
<p><strong>Step 1</strong> You can clean up the demo by deleting the demo Namespaces:</p>
<div class="codehilite"><pre><span></span><code>kubectl delete ns client stars management-ui
</code></pre></div>

<h2 id="2-ingress">2. Ingress<a class="headerlink" href="#2-ingress" title="Permanent link">&para;</a></h2>
<p>In GKE, Ingress is implemented using Cloud Load Balancing. In other words, when yiu create an Ingress resource in your cluster, GKE creates an <code>HTTP(S)</code> LB for you and configure it.
In this lab, we will create a fanout Ingress with two backends for two verisons of the <code>hello-app</code> application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to experiment with a different type of Ingress, you can install <code>Nginx Controller</code> using Helm. You can also follow these [instructions]
(https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md).</p>
</div>
<h3 id="21-deploy-an-application">2.1 Deploy an Application<a class="headerlink" href="#21-deploy-an-application" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Deploy the web application version 1, and its service</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt; web-service-v1.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-v1
  namespace: default
spec:
  selector:
    matchLabels:
      run: web
      version: v1
  template:
    metadata:
      labels:
        run: web
        version: v1
    spec:
      containers:
      - image: gcr.io/google-samples/hello-app:1.0
        imagePullPolicy: IfNotPresent
        name: web
        ports:
        - containerPort: 8080
          protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  name: web-v1
  namespace: default
spec:
  ports:
  - port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    run: web
    version: v1
  type: NodePort
EOF
</code></pre></div>

<p><strong>Step 2</strong> Apply the resources to the cluster</p>
<div class="codehilite"><pre><span></span><code>kubectl apply -f web-service-v1.yaml
</code></pre></div>

<p><strong>Step 3</strong> Deploy the web application version 2, and its service</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt; web-service-v2.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-v2
  namespace: default
spec:
  selector:
    matchLabels:
      run: web
      version: v2
  template:
    metadata:
      labels:
        run: web
        version: v2
    spec:
      containers:
      - image: gcr.io/google-samples/hello-app:2.0
        imagePullPolicy: IfNotPresent
        name: web
        ports:
        - containerPort: 8080
          protocol: TCP
---
apiVersion: v1
kind: Service
metadata:
  name: web-v2
  namespace: default
spec:
  ports:
  - port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    run: web
    version: v2
  type: NodePort
EOF
</code></pre></div>

<p><strong>Step 4</strong> Apply the resources to the cluster</p>
<div class="codehilite"><pre><span></span><code>kubectl apply -f web-service-v2.yaml
</code></pre></div>

<p><strong>Step 5</strong> Take a look at the pods created and view their IPs</p>
<div class="codehilite"><pre><span></span><code>kubectl get pod -o wide
</code></pre></div>

<p><strong>Step 6</strong> Take a look at the endpoints created and notice how they match the IP for the Pods in the matching service.</p>
<div class="codehilite"><pre><span></span><code>kubectl get ep
</code></pre></div>

<h3 id="22-creating-single-service-ingress-rule">2.2 Creating Single Service Ingress rule<a class="headerlink" href="#22-creating-single-service-ingress-rule" title="Permanent link">&para;</a></h3>
<p>Let's expose our web-v1 service using Ingress!</p>
<p><strong>Step 1</strong> To start, let's create an Ingress resource that directs traffic to v1 of the <code>web</code> Service</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt; single-svc-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
 name: single-svc-ingress
spec:
  defaultBackend:
    service:
      name: web-v1
      port:
        number: 8080
EOF
</code></pre></div>

<p>This manifest defines a <code>Single Service Ingress rule</code>, which makes sure all HTTP requests
that will hit the external IP for the Cloud LB created for the Ingress, will be proxied to the <code>web-v1</code> service on port <code>8080</code>.</p>
<p><strong>Step 2</strong> Create the Ingress resource</p>
<div class="codehilite"><pre><span></span><code>kubectl apply -f single-svc-ingress.yaml
</code></pre></div>

<p><strong>Step 3</strong>  Verify Ingress Resource</p>
<div class="codehilite"><pre><span></span><code>kubectl get ing
</code></pre></div>

<p><strong>Output</strong></p>
<div class="codehilite"><pre><span></span><code>NAME                 CLASS    HOSTS   ADDRESS          PORTS   AGE
single-svc-ingress   &lt;none&gt;   *       34.117.137.144   80      110s
</code></pre></div>

<p>Notice that the Ingress controllers and load balancers may take a minute or two to allocate an IP address.</p>
<p>Bingo!</p>
<p><strong>Step 4</strong> descirbe the Ingress object created and notice the Google Cloud LB resources created.</p>
<div class="codehilite"><pre><span></span><code>kubectl describe ing single-svc-ingress
</code></pre></div>

<p>Notice that you might need to give it some time to get a similar output to what I have below.
<strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Name:             single-svc-ingress
Namespace:        default
Address:          34.117.137.144
Default backend:  web-v1:8080 (10.32.0.10:8080)
Rules:
  Host        Path  Backends
  ----        ----  --------
  *           *     web-v1:8080 (10.32.0.10:8080)
Annotations:  ingress.kubernetes.io/backends: {&quot;k8s-be-30059--a2b52ac0331abe29&quot;:&quot;HEALTHY&quot;}
              ingress.kubernetes.io/forwarding-rule: k8s2-fr-8rwy2qu4-default-single-svc-ingress-74hvjigm
              ingress.kubernetes.io/target-proxy: k8s2-tp-8rwy2qu4-default-single-svc-ingress-74hvjigm
              ingress.kubernetes.io/url-map: k8s2-um-8rwy2qu4-default-single-svc-ingress-74hvjigm
Events:
  Type    Reason     Age                  From                     Message
  ----    ------     ----                 ----                     -------
  Normal  Sync       10m                  loadbalancer-controller  UrlMap &quot;k8s2-um-8rwy2qu4-default-single-svc-ingress-74hvjigm&quot; created
  Normal  Sync       10m                  loadbalancer-controller  TargetProxy &quot;k8s2-tp-8rwy2qu4-default-single-svc-ingress-74hvjigm&quot; created
  Normal  Sync       10m                  loadbalancer-controller  ForwardingRule &quot;k8s2-fr-8rwy2qu4-default-single-svc-ingress-74hvjigm&quot; created
  Normal  IPChanged  10m                  loadbalancer-controller  IP is now 34.117.137.144
  Normal  Sync       4m27s (x6 over 11m)  loadbalancer-controller  Scheduled for sync
</code></pre></div>

<p><strong>Step 5</strong> Access deployed app via Ingress by navigating to the public IP of the ingress, which we got in step 3.</p>
<p><strong>Step 6</strong> Finally execute the following command to cleanup the ingress.</p>
<div class="codehilite"><pre><span></span><code>kubectl delete -f single-svc-ingress.yaml
</code></pre></div>

<h3 id="23-simple-fanout">2.3 Simple fanout<a class="headerlink" href="#23-simple-fanout" title="Permanent link">&para;</a></h3>
<p>Let's explore more sophisticated Ingress rules. This time we going to deploy <code>Simple fanout</code>type that allows for exposing multiple services on same host, but via different paths.
This type is very handy when you running in CloudProvider and want to cut cost
on creating LoadBalancers for each of you application. Or when running on
prem. and it's required to expose multiple services via same host.</p>
<p><strong>Step 1</strong> Let's start by a simple fanout with one service. Notice that we are not using a <code>hostname</code> here as for this lab, we don't want to go through setting up DNS. If you have a DNS setup, you can try with an actual <code>hostname</code>. Just make sure to update you DNS records with the Ingress external IP.</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt; fanout-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
 name: fanout-ingress
spec:
  rules:
  - http:
      paths:
      - path: /v1
        pathType: ImplementationSpecific
        backend:
          service:
            name: web-v1
            port:
              number: 8080
EOF
</code></pre></div>

<p><strong>Step 2</strong> Create the Ingress resource</p>
<div class="codehilite"><pre><span></span><code>kubectl apply -f fanout-ingress.yaml
</code></pre></div>

<p><strong>Step 3</strong>  Verify Ingress Resource</p>
<div class="codehilite"><pre><span></span><code>kubectl get ing fanout-ingress
</code></pre></div>

<p><strong>Step 4</strong> Verify that you can navigate to http://INGRESS_PUBLIC_IP/v1 and get the following</p>
<div class="codehilite"><pre><span></span><code>Hello, world!
Version: 1.0.0
</code></pre></div>

<p><strong>Step 5</strong> Verify that ingress is returning <code>default backend - 404</code> page in a browser.</p>
<p>Open the browser with public_ip:</p>
<div class="codehilite"><pre><span></span><code>http://INGRESS_PUBLIC_IP/test
</code></pre></div>

<p><strong>Step 6</strong> On your own modify the Ingress resource to add a second path so when we navigate to  <code>http://INGRESS_PUBLIC_IP/v2</code> users will get routed to <code>web-v2</code></p>
<p><strong>Step 7</strong> Delete the demo
Finally execute the following command to cleanup the application and ingress.</p>
<div class="codehilite"><pre><span></span><code>kubectl delete -f fanout-ingress.yaml
kubectl apply -f web-service-v1.yaml
kubectl apply -f web-service-v2.yaml
</code></pre></div>

<h3 id="24-cleaning-up">2.4 Cleaning Up<a class="headerlink" href="#24-cleaning-up" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Delete the cluster</p>
<div class="codehilite"><pre><span></span><code>gcloud container clusters delete k8s-networking
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/googlecloud" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>