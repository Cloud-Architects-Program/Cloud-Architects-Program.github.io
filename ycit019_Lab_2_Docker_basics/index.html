<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>ycit019 Lab 2 Docker basics - Cloud Architecture</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Cloud Architecture</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT020 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Lab_3_Terraform_Fundamentals/" class="dropdown-item">Lab 3 Terraform Fundamentals</a>
</li>
            
<li>
    <a href="../020_Lab_4_Traffic_control/" class="dropdown-item">Lab 4 Traffic Management</a>
</li>
            
<li>
    <a href="../020_Lab_5_EFK/" class="dropdown-item">Lab 5 EFK Stack</a>
</li>
            
<li>
    <a href="../020_Lab_6_Prometheus/" class="dropdown-item">Lab 6 Monitoring with Prometheus</a>
</li>
            
<li>
    <a href="../020_Lab_6_GMP/" class="dropdown-item">Lab 6 Monitoring with GMP</a>
</li>
            
<li>
    <a href="../020_Lab_9_GitOps/" class="dropdown-item">Lab 9 GitOps with Flux</a>
</li>
            
<li>
    <a href="../020_Lab_10_cloudrun/" class="dropdown-item">Lab 10 Serverless Cloud Run</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Assignment_2_Production_GKE/" class="dropdown-item">Assignment2</a>
</li>
            
<li>
    <a href="../020_Assignment_3_Terraform_GCP_Foundation/" class="dropdown-item">Assignment3</a>
</li>
            
<li>
    <a href="../020_Assignment_4_Helm_Foundation/" class="dropdown-item">Assignmen4</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT019 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_Module_5_Lab_Docker_basics/" class="dropdown-item">Module 5 Lab - Docker Basics</a>
</li>
            
<li>
    <a href="../ycit019_Module_6_Lab_Advanced_Docker/" class="dropdown-item">Module 6 Lab - Advanced Docker</a>
</li>
            
<li>
    <a href="../ycit019_Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="dropdown-item">Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm</a>
</li>
            
<li>
    <a href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="dropdown-item">Module 8 Lab - Kuberenetes Concepts</a>
</li>
            
<li>
    <a href="../ycit019_Module_9_Kubernetes_Features/" class="dropdown-item">Module 9 Lab - Kubernetes Features</a>
</li>
            
<li>
    <a href="../ycit019_Module_10_Kubernetes_Scaling/" class="dropdown-item">Module 9 Part 2 Lab Kubernetes Autoscaling</a>
</li>
            
<li>
    <a href="../ycit019_Lab_10_Networking/" class="dropdown-item">Module 10 Lab - Kubernetes Networking</a>
</li>
            
<li>
    <a href="../ycit019_Lab_11_Storage/" class="dropdown-item">Module 11 Lab - Kubernetes Storage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_ass1/" class="dropdown-item">Module 5 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass1_sol/" class="dropdown-item">Module 5 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass2/" class="dropdown-item">Module 6 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass2_solution/" class="dropdown-item">Module 6 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass3/" class="dropdown-item">Module 8 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass3_solution/" class="dropdown-item">Module 8 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass4_2022/" class="dropdown-item">Module 9 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass4_sol/" class="dropdown-item">Module 9 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass7/" class="dropdown-item">Module 10 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass6_solution/" class="dropdown-item">Module 10 Assignment Solution</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#prepare-lab-environment" class="nav-link">Prepare Lab Environment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#1-docker-basics" class="nav-link">1 Docker basics</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#11-show-running-containers" class="nav-link">1.1 Show running containers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#12-specify-a-container-main-process" class="nav-link">1.2 Specify a container main process</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#13-specify-an-image-version" class="nav-link">1.3 Specify an image version</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#14-run-an-interactive-container" class="nav-link">1.4 Run an interactive container</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#15-run-a-container-in-a-background" class="nav-link">1.5 Run a container in a background</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#16-accessing-containers-from-the-internet" class="nav-link">1.6 Accessing Containers from the Internet</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#17-restart-a-container" class="nav-link">1.7 Restart a container</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#18-ensuring-container-uptime" class="nav-link">1.8 Ensuring Container Uptime</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#19-inspect-a-container" class="nav-link">1.9 Inspect a container</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#110-interacting-with-containers" class="nav-link">1.10 Interacting with containers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#112-copy-files-tofrom-container" class="nav-link">1.12 Copy files to/from container</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#112-remove-containers" class="nav-link">1.12 Remove containers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>Lab 2 Docker basics</p>
<p><strong>Objective:</strong></p>
<ul>
<li>Practice to run Docker containers</li>
</ul>
<h2 id="prepare-lab-environment">Prepare Lab Environment<a class="headerlink" href="#prepare-lab-environment" title="Permanent link">&para;</a></h2>
<p>This lab can be executed in you GCP Cloud Environment using Google Cloud Shell.</p>
<p>Open the Google Cloud Shell by clicking on the icon on the top right of the screen:</p>
<p><img alt="alt text" src="../images/cloud_shell.png" title="Google Cloud Shell" /></p>
<p>Once opened, you can use it to run the instructions for this lab.</p>
<h1 id="1-docker-basics">1 Docker basics<a class="headerlink" href="#1-docker-basics" title="Permanent link">&para;</a></h1>
<h2 id="11-show-running-containers">1.1 Show running containers<a class="headerlink" href="#11-show-running-containers" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Run docker ps to show running containers:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<p><strong>Step 2</strong> The output shows that there are no running containers at the moment.
Use the command docker <code>ps -a</code> to list all containers including the ones has
been stopped:</p>
<pre class="codehilite"><code>docker ps -a
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>CONTAINER ID IMAGE       COMMAND  CREATED        STATUS             PORTS  NAMES
6e6db2a24a8e hello-world &quot;/hello&quot; 15 minutes ago Exited (0) 15 min  dreamy_nobel
</code></pre>

<p>Review the collumns <code>CONTAINER ID</code>, <code>STATUS</code>, <code>COMMAND</code>, <code>PORTS</code>, <code>NAMES</code>.</p>
<p>In the previous section we started one container and the command docker <code>ps -a</code>
shows it as <code>Exited</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can name your own containers with --name when you use docker run. If
you do not provide a name, Docker will generate a random one like the one
you have.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Why Docker names are random? How docker containers named?</p>
</div>
<p><strong>Step 3</strong> Let’s run the command <code>docker images</code> to show all the images on your
local system:</p>
<pre class="codehilite"><code>docker images
</code></pre>

<p>As you see, there is only one image that was downloaded from the Docker Hub.</p>
<h2 id="12-specify-a-container-main-process">1.2 Specify a container main process<a class="headerlink" href="#12-specify-a-container-main-process" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Let’s run our own "hello world" container. For that we will use the
official <a href="https://hub.docker.com/_/ubuntu/">Ubuntu image</a>:</p>
<pre class="codehilite"><code>docker run ubuntu /bin/echo 'Hello world'
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
...
Status: Downloaded newer image for ubuntu:latest
Hello world
</code></pre>

<p>As you see, Docker downloaded the image ubuntu because it was not on the local
machine.</p>
<p><strong>Step 2</strong> Let’s run the command <code>docker images</code> again:</p>
<pre class="codehilite"><code>docker images
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>REPOSITORY          TAG                 IMAGE ID            CREATED        SIZE
ubuntu              latest              42118e3df429        11 days ago  124.8 MB
hello-world         latest              c54a2cc56cbb        4 weeks ago  1.848 kB
</code></pre>

<p><strong>Step 3</strong> If you run the same "hello world" container again, Docker will use a
local copy of the image:</p>
<pre class="codehilite"><code>docker run ubuntu /bin/echo 'Hello world'
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>Hello world
</code></pre>

<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Compare Ubuntu Docker image with ISO image or with Cloud VM image.</p>
<ul>
<li>Why the size is so different ?</li>
</ul>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>Pulling docker images from Docker Hub takes sometime. This time depends on:</p>
<ul>
<li>How large is the image?</li>
<li>How fast is the network to Internet ?</li>
</ul>
<p>However, it is still much faster than booting traditional OS with Ubuntu
on VM.</p>
<p>If image already pulled on local host it takes fraction of a second to start
a container.</p>
<p>Running application in docker containers considered as a best practice
for running CI/CD pipelines as it considerably faster than using VMs and
reduce time for deploying a test environments.</p>
</div>
<h2 id="13-specify-an-image-version">1.3 Specify an image version<a class="headerlink" href="#13-specify-an-image-version" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> As you see, Docker has downloaded the ubuntu:latest image. You can
see Ubuntu version by running the following command:</p>
<pre class="codehilite"><code>docker run ubuntu /bin/cat /etc/issue.net
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>Ubuntu 16.04 LTS
</code></pre>

<p>Let’s say you need a previous Ubuntu LTS release. In this case, you can specify
the version you need:</p>
<pre class="codehilite"><code>docker run ubuntu:14.04 /bin/cat /etc/issue.net
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>Unable to find image 'ubuntu:14.04' locally
14.04: Pulling from library/ubuntu
...
Status: Downloaded newer image for ubuntu:14.04
Ubuntu 14.04.4 LTS
</code></pre>

<p><strong>Step 2</strong> The <code>docker images</code> command should show that we have 3 Ubuntu
images downloaded locally:</p>
<pre class="codehilite"><code>docker images
</code></pre>

<p><strong>Output:</strong></p>
<pre class="codehilite"><code>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              42118e3df429        11 days ago         124.8 MB
ubuntu              14.04               0ccb13bf1954        11 days ago         188 MB
hello-world         latest              c54a2cc56cbb        4 weeks ago         1.848 kB
</code></pre>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Running CI/CD pipeline with Docker using <code>latest</code> tag
considered as a Bad Practice.</p>
<p>Instead consider using:</p>
<ul>
<li>Versioning</li>
<li><code>SHA</code> tagging.</li>
</ul>
</div>
<h2 id="14-run-an-interactive-container">1.4 Run an interactive container<a class="headerlink" href="#14-run-an-interactive-container" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Let’s use the <code>ubuntu</code> image to run an <em>interactive</em> bash session and
inspect what is running inside our docker image.</p>
<p>To achive that we going to use  <code>-i</code> and <code>-t</code> flags.</p>
<p>The  <code>-i</code> is shorthand for <code>--interactive</code>, which instructs Docker to keep
<code>stdin</code> open so that we can send commands to the sprocess.</p>
<p>The <code>-t</code> flag is short for <code>--tty</code> and allocates a <code>pseudo-TTY</code> or terminal
inside of the session.</p>
<pre class="codehilite"><code>docker run -it ubuntu /bin/bash
root@17d8bdeda98e:/#
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We get a  bash shell prompt inside of the container.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bash prompt is not availabe for all docker images.</p>
</div>
<p><strong>Step 2</strong> Let's print the system information of the latest <code>Ubuntu</code> image:</p>
<pre class="codehilite"><code>root@17d8bdeda98e:/#  uname -a
Linux 17d8bdeda98e 3.19.0-31-generic ...
</code></pre>

<p><strong>Step 3</strong> Let's verify what Ubuntu version is run by <code>latest</code> image of ubuntu:</p>
<pre class="codehilite"><code>root@17d8bdeda98e:/#  lsb_release -a
bash: lsb_release: command not found
</code></pre>

<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Why the standard Ubuntu command that checks version of OS is not working as
expeced ?</p>
</div>
<p><strong>Step 4</strong> Let's verify Ubuntu version using alternative way by checking
<code>/etc/lsb-release</code> file.</p>
<pre class="codehilite"><code>root@8cbcbd0fe8d2:/# cat /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION=&quot;Ubuntu 16.04.3 LTS&quot;
</code></pre>

<p><strong>Step 5</strong> Let's compare the number of executable binaries availabe inside of
the docker image versus Cloud VM that we running our class environment. First,
run <code>ls</code> command on  <code>/bin</code> and <code>/usr/bin</code> directories inside of the running
ubuntu container as well as <code>dpkg --list</code> command that shows total number of
installed packages:</p>
<pre class="codehilite"><code>root@8cbcbd0fe8d2:/# ls /bin | wc -l
86
root@8cbcbd0fe8d2:/# ls /usr/bin | wc -l
233
root@eb11cd0b4106:/# dpkg --list | wc -l
101
</code></pre>

<p><strong>Step 6</strong> Use the <code>exit</code> command or press <code>Ctrl-D</code> to exit the interactive
bash session back to Cloud VM.</p>
<pre class="codehilite"><code>root@eb11cd0b4106:/# exit
</code></pre>

<p><strong>Step 7</strong> Now run <code>ls</code> command on <code>/bin</code> and <code>/usr/bin</code> directories on Cloud VM
that we using as our class environment:</p>
<pre class="codehilite"><code>cca-user@userx-docker-vm:~$ ls /bin | wc -l
171
cca-user@userx-docker-vm:~$ ls /usr/bin | wc -l
660
cca-user@userx-docker-vm:~$ dpkg --list | wc -l
463
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Official Docker container has much less binaries and packages installed vs
Ubuntu Cloud Image.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>Some of the use cases running docker containers in <code>interactive mode</code> are:</p>
<ul>
<li>Troubleshooting containerized applications</li>
<li>Deploying and running containerized application on the existing
production systems without affecting it.</li>
</ul>
<p>We've also learned that an official Docker "minimal" ubuntu image, does not
include <code>lsb_release</code> command, as well as many other commands and packages
that can be found in <a href="https://www.ubuntu.com/download/server">Official Ubuntu ISO image</a>.
The docker images are ment to contain only required <em>core system</em> commands
and functions to make Images as light as possible.
That say you can still install required packages using <code>apt-get install</code>,
however this may increase size of docker image considerably.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>While Docker <code>Ubuntu</code> image we used so far or Docker <code>Centos</code> image are
very familiar to users and can be good starting point for learning docker
containers. Using them in production or development considered as a Bad
Practice.</p>
<p>This is due those images still considered as <code>heavy</code> and potentially
contain a lot more valnurabilities compare to specialized images.</p>
<p>To reduce image pull time from docker hub and follow the best secuirity
practices consider using specialized images that works well with you
underlining code (Node image for NodeJS applications and etc.).
Examples of specialized images are:</p>
<ul>
<li>Alpine Linux</li>
<li>Node</li>
<li>Atomic</li>
</ul>
<p>In fact, not so long ago all the <a href="https://github.com/docker-library/official-images/tree/master/library">official Docker Images</a>
in Docker-Hub <a href="https://www.brianchristner.io/docker-is-moving-to-alpine-linux/">has been moved</a>
to use <a href="https://www.alpinelinux.org/">Alpine Image</a>.</p>
</div>
<p><strong>Step 8</strong> Finally let’s check that when the shell process has finished, the
container stops:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<h2 id="15-run-a-container-in-a-background">1.5 Run a container in a background<a class="headerlink" href="#15-run-a-container-in-a-background" title="Permanent link">&para;</a></h2>
<p>Now we know how to connect to running container and execute commands in it.
However in most cases you just want run a container in a <em>background</em> so it can
do a specific action.</p>
<p><strong>Step 1</strong> Run a container in a background using the <code>-d</code> command line argument:</p>
<pre class="codehilite"><code>docker run -d ubuntu /bin/sh -c &quot;while true; do date; echo hello world; sleep 1; done&quot;
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Command should return the container ID.</p>
</div>
<p><strong>Step 2</strong> Let’s use the <code>docker ps</code> command to see running containers:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code> CONTAINER ID IMAGE  COMMAND                  CREATED        STATUS  PORTS NAMES
ac231579e57f ubuntu &quot;/bin/sh -c 'while tr&quot;   1 minute ago   Up 11 minute  evil_golick
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Container id is going to  be different in your case</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Instead of using full <code>container-id</code> when building commands, it is possible
simply type first few characters of container-id, to make things nice and
easy.</p>
</div>
<p><strong>Step 3</strong> Let’s use <code>container-id</code> to show the container standard output:</p>
<pre class="codehilite"><code>docker logs &lt;container-id&gt;
</code></pre>

<pre class="codehilite"><code>Thu Jan 26 00:23:45 UTC 2017
hello world
Thu Jan 26 00:23:46 UTC 2017
hello world
Thu Jan 26 00:23:47 UTC 2017
hello world
...
</code></pre>

<p>As you can see, in the <code>docker ps</code> command output, the auto generated container
name is <code>evil_golick</code> (your container can have a different name).</p>
<p><strong>Step 4</strong> Now, instead of using docker <code>contaier-id</code> use container name to
show the container standard output:</p>
<pre class="codehilite"><code>docker logs &lt;name&gt;
</code></pre>

<pre class="codehilite"><code>Thu Jan 26 00:23:51 UTC 2017
hello world
Thu Jan 26 00:23:52 UTC 2017
hello world
Thu Jan 26 00:23:53 UTC 2017
hello world
...
</code></pre>

<p><strong>Step 5</strong> Finally, let’s stop our container:</p>
<pre class="codehilite"><code>docker stop &lt;name&gt;
</code></pre>

<p><strong>Step 6</strong> Check, that there are no running containers:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p><code>docker logs</code> is a very usefull command to troubleshoot containers,
and going to be used very often both for Docker and Kubernertes
troubleshooting.</p>
</div>
<h2 id="16-accessing-containers-from-the-internet">1.6 Accessing Containers from the Internet<a class="headerlink" href="#16-accessing-containers-from-the-internet" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Let’s run a simple web application. We will use the existing image
training/webapp, which contains a Python Flask application:</p>
<pre class="codehilite"><code>docker run -d -P training/webapp python app.py
</code></pre>

<pre class="codehilite"><code>...
Status: Downloaded newer image for training/webapp:latest
6e88f42d3d853762edcbfe1fe73fdc5c48865275bc6df759b83b0939d5bd2456
</code></pre>

<p>In the command above we specified the main process (python app.py), the <code>-d</code>
command line argument, which tells Docker to run the container in the
background. The <code>-P</code> command line argument tells Docker to map any required
network ports inside our container to our host. This allows us to access the web
application in the container.</p>
<p><strong>Step 2</strong> Use the <code>docker ps</code> command to list running containers:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID IMAGE           COMMAND         CREATED       STATUS       PORTS                   NAMES
6e88f42d3d85 training/webapp &quot;python app.py&quot; 3 minutes ago Up 3 minutes 0.0.0.0:32768-&gt;5000/tcp determined_torvalds
</code></pre>

<p>The PORTS column contains the mapped ports. In our case, Docker has exposed port
5000 (the default Python Flask port) on port 32768 (can be different in your
case).</p>
<p><strong>Step 3</strong> The <code>docker port</code> command shows the exposed port. We will use the
container name (determined_torvalds in the example above, it can be different in
your case):</p>
<pre class="codehilite"><code>docker port &lt;name&gt; 5000
0.0.0.0:32768
</code></pre>

<p><strong>Step 4</strong> Let’s check that we can access the web application exposed port:</p>
<pre class="codehilite"><code>curl http://localhost:&lt;port&gt;/
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p><code>Hello world!</code></p>
</div>
<p><strong>Step 5</strong> Let’s stop our web application for now:</p>
<pre class="codehilite"><code>docker stop &lt;name&gt;
</code></pre>

<p><strong>Step 6</strong> We want to manually specify the local port to expose (-p argument).
Let’s use the standard HTTP port 80. We also want to specify the container name
(--name argument):</p>
<pre class="codehilite"><code>docker run -d -p 80:5000 --name webapp training/webapp python app.py
</code></pre>

<p><strong>Step 7</strong> Let’s check that the port 80 is exposed:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID IMAGE           COMMAND         CREATED       STATUS       PORTS                NAMES
249476631f7d training/webapp &quot;python app.py&quot; 1 minute  ago Up 1 minute  0.0.0.0:80-&gt;5000/tcp webapp
</code></pre>

<pre class="codehilite"><code>curl http://localhost/
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>`Hello world!``</p>
</div>
<p><strong>Step 8</strong> You can also observe <code>Hello world!</code> webapp from you laptop, for that you
need to use you public VM IP that can be gather from VMs list:</p>
<pre class="codehilite"><code>Your_VM_Public_IP
</code></pre>

<p>Than paste VM Public IP address in you browser.</p>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Our web-app can be accessed from Internet!</p>
</div>
<h2 id="17-restart-a-container">1.7 Restart a container<a class="headerlink" href="#17-restart-a-container" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Let’s stop the container with web application:</p>
<pre class="codehilite"><code>docker stop webapp
</code></pre>

<p>The main process inside of the container will receive SIGTERM, and after a grace
period, SIGKILL.</p>
<p><strong>Step 2</strong> You can start the container later using the <code>docker start</code> command:</p>
<pre class="codehilite"><code>docker start webapp
</code></pre>

<p><strong>Step 3</strong> Check that the web application works:</p>
<pre class="codehilite"><code>curl http://localhost/
Hello world!
</code></pre>

<p><strong>Step 4</strong> You also can restart the running container using the docker restart
command.</p>
<pre class="codehilite"><code>docker restart webapp
</code></pre>

<p><strong>Step 4</strong>  Run <code>docker ps</code> command and check  <code>STATUS</code> field:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID    IMAGE             COMMAND           CREATED           STATUS              
6e400179070f    training/webapp   &quot;python app.py&quot;   25 minutes ago    Up 3 seconds
</code></pre>

<h2 id="18-ensuring-container-uptime">1.8 Ensuring Container Uptime<a class="headerlink" href="#18-ensuring-container-uptime" title="Permanent link">&para;</a></h2>
<p>Docker considers any containers to exit with a non-zero exit code to have
crashed. By default a crashed container will remain stopped.</p>
<p><strong>Step 1</strong> Start the container that outputs a message and then exits with code 1
to simulate a crash.</p>
<pre class="codehilite"><code>docker run -d --name restart-default scrapbook/docker-restart-example
</code></pre>

<pre class="codehilite"><code>docker ps -a | grep restart-default
</code></pre>

<pre class="codehilite"><code>CONTAINER ID  IMAGE                             CREATED       STATUS               NAMES
c854289d2f39  scrapbook/docker-restart-example  5 seconds ago Exited 3 sec ago    restart-default
$ docker logs restart-default
Sun Sep 17 20:34:55 UTC 2017 Booting up...
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Container crushed and exited.</p>
</div>
<p>However, there are several ways to ensure that you container up and running even
if it’s restarts.</p>
<p><strong>Step 2</strong> The option <code>--restart=on-failure</code>: allows you to say how many times
Docker should try again:</p>
<pre class="codehilite"><code>docker run -d --name restart-3 --restart=on-failure:3 scrapbook/docker-restart-example
</code></pre>

<pre class="codehilite"><code>docker logs restart-3
</code></pre>

<pre class="codehilite"><code>Thu Apr 20 14:01:27 UTC 2017 Booting up...
Thu Apr 20 14:01:28 UTC 2017 Booting up...
Thu Apr 20 14:01:29 UTC 2017 Booting up...
Thu Apr 20 14:01:31 UTC 2017 Booting up...
</code></pre>

<p><strong>Step 3</strong> Finally, Docker can always restart a failed container. In this case,
Docker will keep trying until the container is explicitly told to stop.</p>
<pre class="codehilite"><code>docker run -d --name restart-always --restart=always scrapbook/docker-restart-example
docker logs restart-always
</code></pre>

<p><strong>Step 4</strong>  After sometime stop running docker container, as it will be keep
failing and starting again:</p>
<pre class="codehilite"><code>docker stop restart-always
</code></pre>

<h2 id="19-inspect-a-container">1.9 Inspect a container<a class="headerlink" href="#19-inspect-a-container" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> You can use the <code>docker inspect</code> command to see the configuration and
status information for the specified container:</p>
<pre class="codehilite"><code>docker inspect webapp
</code></pre>

<pre class="codehilite"><code>[
    {
        &quot;Id&quot;: &quot;249476631f7d...&quot;,
        &quot;Created&quot;: &quot;2016-08-02T23:42:56.932135327Z&quot;,
        &quot;Path&quot;: &quot;python&quot;,
        &quot;Args&quot;: [
            &quot;app.py&quot;
        ],
        &quot;State&quot;: {
            &quot;Status&quot;: &quot;running&quot;,
            &quot;Running&quot;: true,
            &quot;Paused&quot;: false,
            &quot;Restarting&quot;: false,
            &quot;OOMKilled&quot;: false,
            &quot;Dead&quot;: false,
            &quot;Pid&quot;: 16055,
            &quot;ExitCode&quot;: 0,
            &quot;Error&quot;: &quot;&quot;,
            ...
</code></pre>

<p><strong>Step 2</strong> You can specify a filter (-f command line argument) to show only
specific elements. For example:</p>
<pre class="codehilite"><code>docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' webapp
</code></pre>

<pre class="codehilite"><code>172.17.0.2
</code></pre>

<p>The command returns the IP address of the container.</p>
<h2 id="110-interacting-with-containers">1.10 Interacting with containers<a class="headerlink" href="#110-interacting-with-containers" title="Permanent link">&para;</a></h2>
<p>In some cases using <code>docker log</code> is not enough to undertand issues and you
want to login inside of running VM. Also sometimes you package you applicaiton
and in order to run it you need to login inside of container and execute and
leave it running in background. Below provded few ways to interacting with
containers that can help to achive descrined use cases.</p>
<h3 id="1101-detach-from-interactive-container">1.10.1 Detach from Interactive container<a class="headerlink" href="#1101-detach-from-interactive-container" title="Permanent link">&para;</a></h3>
<p>In Module, <code>1.4 Run an interactive container</code> we run an <code>Ubuntu</code> container with
<code>-it</code> flag and able directly login inside of the container to interact with it,
however after we exited contianer using <code>Ctrl-D</code> or <code>exit</code> command container
stopped. However you can exit from <code>Interactive mode</code> without stoping
a container. Let's demonstrate how this works:</p>
<p><strong>Step 1</strong> Start Ubunu container in interactive  mode:</p>
<pre class="codehilite"><code>docker run -it ubuntu /bin/bash
</code></pre>

<p><strong>Step 2</strong> Run <code>watch date</code> command inside running container in order to exit
<code>date</code> command every 2 seconds.</p>
<pre class="codehilite"><code>root@1d688a9f4ed4:/# watch date
</code></pre>

<p><strong>Step 3</strong> Detach from a container and leave it running using the
<code>CTRL-p</code> <code>CTRL-q</code> key sequence.</p>
<p><strong>Step 4</strong> Verify that Ubuntu container is still running:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID  IMAGE   COMMAND      CREATED        STATUS        NAMES
1d688a9f4ed4  ubuntu  &quot;/bin/bash&quot;  1 minutes ago  Up 1 minutes  admiring_lovelace
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Great you were able to detach from Docker container without stopping it,
while it is executing a process in it.
What about attaching back to container ?</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><code>CTRL-p</code> <code>CTRL-q</code>  sequence key only works if docker contaienr started
with <code>-it</code> command!</p>
</div>
<h3 id="1112-attach-to-a-container">1.11.2 Attach to a container<a class="headerlink" href="#1112-attach-to-a-container" title="Permanent link">&para;</a></h3>
<p>Now let's get back and <code>attach</code> to our running Ubuntu image. For that
docker provides <code>docker attach</code> command.</p>
<pre class="codehilite"><code>docker attach &lt;container name&gt;
</code></pre>

<pre class="codehilite"><code>Every 2.0s: date                                                                                                                    Mon Sep 18 00:08:57 2017
</code></pre>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p><code>docker attach</code> attaches your contairs terminal’s standard input, output,
and error (or any combination of the 3) to a running container. This allows
you to view its ongoing output or to control it interactively, as though
the commands were running directly in your terminal.</p>
</div>
<h3 id="1113-execute-a-process-in-a-container">1.11.3 Execute a process in a container<a class="headerlink" href="#1113-execute-a-process-in-a-container" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Let verify if webapp container is still running</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID IMAGE           COMMAND         CREATED       STATUS       PORTS                NAMES
249476631f7d training/webapp &quot;python app.py&quot; 1 minute  ago Up 1 minute  0.0.0.0:80-&gt;5000/tcp webapp
</code></pre>

<p>If not running start it with following command: <code>$ docker run -d -p 80:5000 --name webapp training/webapp python app.py</code>
other wise skip to <strong>next step</strong>.</p>
<p><strong>Step 2</strong> Use the docker exec command to execute a command in the running
container. For example:</p>
<pre class="codehilite"><code>docker exec webapp ps aux
</code></pre>

<pre class="codehilite"><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.2  0.0  52320 17384 ?        Ss   00:11   0:00 python app.py
root        26  0.0  0.0  15572  2104 ?        Rs   00:12   0:00 ps aux
</code></pre>

<p>The same command with the <code>-it</code> command line argument can be used to run an
interactive session in the container:</p>
<pre class="codehilite"><code>docker exec -it webapp bash
root@249476631f7d:/opt/webapp# ps auxw
ps auxw
</code></pre>

<pre class="codehilite"><code>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0  52320 17384 ?        Ss   00:11   0:00 python app.py
root        32  0.0  0.0  18144  3064 ?        Ss   00:14   0:00 bash
root        47  0.0  0.0  15572  2076 ?        R+   00:16   0:00 ps auxw
</code></pre>

<p><strong>Step 2</strong> Use the <code>exit</code> command or press <code>Ctrl-D</code> to exit the interactive bash
session:</p>
<pre class="codehilite"><code>root@249476631f7d:/opt/webapp# exit
</code></pre>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p><code>docker exec</code> is one of the most usefull docker commands used for
troubleshooting containers.</p>
</div>
<h2 id="112-copy-files-tofrom-container">1.12 Copy files to/from container<a class="headerlink" href="#112-copy-files-tofrom-container" title="Permanent link">&para;</a></h2>
<p>The <code>docker cp</code> command allows you to copy files from the container to the local
machine or from the local file system to the container. This command works for
a running or stopped container.</p>
<p><strong>Step 1</strong> Let’s copy the container’s app.py file to the local machine:</p>
<pre class="codehilite"><code>docker cp webapp:/opt/webapp/app.py .
</code></pre>

<p><strong>Step 2</strong> Edit the local app.py file. For example, change the line return
'Hello '+provider+'!' to return 'Hello '+provider+'!!!'. Copy the modified file
back and restart the container:</p>
<pre class="codehilite"><code>docker cp app.py webapp:/opt/webapp/

docker restart webapp
</code></pre>

<p><strong>Step 3</strong> Check that the modified web application works::</p>
<pre class="codehilite"><code>curl http://localhost/
</code></pre>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>`Hello world!!!``</p>
</div>
<h2 id="112-remove-containers">1.12 Remove containers<a class="headerlink" href="#112-remove-containers" title="Permanent link">&para;</a></h2>
<p>Now let's clean up the environment and at the same time learn how delete
containers.</p>
<p>Step 1 First list running containers:</p>
<pre class="codehilite"><code>docker ps
</code></pre>

<pre class="codehilite"><code>CONTAINER ID IMAGE           COMMAND         CREATED       STATUS       PORTS                NAMES
81c4c66baaf9 training/webapp &quot;python app.py&quot; 1 minute  ago Up 1 minute  0.0.0.0:80-&gt;5000/tcp webapp
</code></pre>

<p>Step 2 Than try to delete running container using <code>docker rm &lt;container_id&gt;</code></p>
<pre class="codehilite"><code>docker rm $container_id
</code></pre>

<pre class="codehilite"><code>Error response from daemon: You cannot remove a running container 81c4c66baaf9. Stop the container before attempting removal or force remove.
</code></pre>

<div class="admonition failure">
<p class="admonition-title">Failure</p>
<p>Docker containers needs to be first stopped or deleted using <code>--force</code> flag.</p>
</div>
<pre class="codehilite"><code>docker rm $container_id -f
</code></pre>

<p>Alternatively, you can run <code>stop</code> and <code>rm</code> in sequence:</p>
<pre class="codehilite"><code>docker stop 81c4c66baaf9
docker rm 81c4c66baaf9
</code></pre>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>We've learned a lot of docker commands which are very handy to know both
when using Docker and Kubernetes. We've also learned how to create Docker Images from DOCKERFILE.</p>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
