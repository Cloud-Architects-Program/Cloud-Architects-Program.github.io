<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Module 5 Assignment Solution - Cloud Architecture</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Cloud Architecture</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT020 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Lab_Terraform_Fundamentals" class="dropdown-item">Module 2 Terraform Fundamentals</a>
</li>
            
<li>
    <a href="../020_Lab_4_Traffic_control/" class="dropdown-item">Module 8 Traffic Management</a>
</li>
            
<li>
    <a href="../020_Lab_5_EFK/" class="dropdown-item">Module 9 EFK Stack</a>
</li>
            
<li>
    <a href="../020_Lab_6_Prometheus/" class="dropdown-item">Module 10 Monitoring with Prometheus</a>
</li>
            
<li>
    <a href="../020_Lab_6_GMP/" class="dropdown-item">Module 10 Monitoring with GMP</a>
</li>
            
<li>
    <a href="../020_Lab_9_GitOps/" class="dropdown-item">Module 11 GitOps with Flux</a>
</li>
            
<li>
    <a href="../020_Lab_10_cloudrun/" class="dropdown-item">Module 12 Serverless Cloud Run</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_Module_2_Assignment_Terraform_Foundation/" class="dropdown-item">Module 2</a>
</li>
            
<li>
    <a href="../020_Module_3_Assignment_Production_GKE/" class="dropdown-item">Module 3</a>
</li>
            
<li>
    <a href="../020_Module_4_Assignment_Production_GKE/" class="dropdown-item">Module 4</a>
</li>
            
<li>
    <a href="../020_Module_6_Assignment_Helm_Foundation/" class="dropdown-item">Module 6</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">YCIT019 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Labs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_Module_5_Lab_Docker_basics/" class="dropdown-item">Module 5 Lab - Docker Basics</a>
</li>
            
<li>
    <a href="../ycit019_Module_6_Lab_Advanced_Docker/" class="dropdown-item">Module 6 Lab - Advanced Docker</a>
</li>
            
<li>
    <a href="../ycit019_Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="dropdown-item">Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm</a>
</li>
            
<li>
    <a href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="dropdown-item">Module 8 Lab - Kuberenetes Concepts</a>
</li>
            
<li>
    <a href="../ycit019_Module_9_Kubernetes_Features/" class="dropdown-item">Module 9 Lab - Kubernetes Features</a>
</li>
            
<li>
    <a href="../ycit019_Module_10_Kubernetes_Scaling/" class="dropdown-item">Module 9 Part 2 Lab Kubernetes Autoscaling</a>
</li>
            
<li>
    <a href="../ycit019_Lab_10_Networking/" class="dropdown-item">Module 10 Lab - Kubernetes Networking</a>
</li>
            
<li>
    <a href="../ycit019_Lab_11_Storage/" class="dropdown-item">Module 11 Lab - Kubernetes Storage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Assignments</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ycit019_ass1/" class="dropdown-item">Module 5 Assignment</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Module 5 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass2/" class="dropdown-item">Module 6 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass2_solution/" class="dropdown-item">Module 6 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass3/" class="dropdown-item">Module 8 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass3_solution/" class="dropdown-item">Module 8 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass4_2022/" class="dropdown-item">Module 9 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass4_sol/" class="dropdown-item">Module 9 Assignment Solution</a>
</li>
            
<li>
    <a href="../ycit019_ass7/" class="dropdown-item">Module 10 Assignment</a>
</li>
            
<li>
    <a href="../ycit019_ass6_solution/" class="dropdown-item">Module 10 Assignment Solution</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ycit019_ass1/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../ycit019_ass2/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#1-containerize-applications" class="nav-link">1 Containerize Applications</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#prepare-lab-environment" class="nav-link">Prepare Lab Environment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#11-overview-of-the-sample-application" class="nav-link">1.1 Overview of the Sample Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#11-build-dockers-image-for-frontend-application" class="nav-link">1.1 Build Dockers image for frontend application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#12-build-docker-image-for-backend-application" class="nav-link">1.2 Build Docker image for backend application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#14-test-application-by-running-with-docker-engine" class="nav-link">1.4 Test application by running with Docker Engine.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#15-cleanup-running-applications-and-unused-networks" class="nav-link">1.5 Cleanup running applications and unused networks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="1-containerize-applications">1 Containerize Applications<a class="headerlink" href="#1-containerize-applications" title="Permanent link">&para;</a></h1>
<p><strong>Objective:</strong></p>
<ul>
<li>Review process of containerizing of applications</li>
<li>Review creation of Docker Images</li>
<li>Review build image process</li>
</ul>
<h2 id="prepare-lab-environment">Prepare Lab Environment<a class="headerlink" href="#prepare-lab-environment" title="Permanent link">&para;</a></h2>
<p>This lab can be executed in you GCP Cloud Environment using Google Cloud Shell.</p>
<p>Open the Google Cloud Shell by clicking on the icon on the top right of the screen:</p>
<p><img alt="alt text" src="../images/cloud_shell.png" title="Google Cloud Shell" /></p>
<p>Once opened, you can use it to run the instructions for this lab.</p>
<h2 id="11-overview-of-the-sample-application">1.1 Overview of the Sample Application<a class="headerlink" href="#11-overview-of-the-sample-application" title="Permanent link">&para;</a></h2>
<p>This package contains two application components which will be used
throughout the course to demonstrate features of Kubernetes:</p>
<ul>
<li>gowebapp</li>
</ul>
<p>This directory contains a simple Go-based note-taking web application. It includes a home page, registration page, login page, about page, and note management page.</p>
<p>Configuration for this application is stored in code/config/config.json. This file is used to configure the backing data store for the application, which in this course is MySQL.</p>
<p>Later in the course, we will externalize this configuration in order to take advantage of Kubernetes Secrets and ConfigMaps. This will include some minor modifications to the Go source code. Go programming experience is not required to complete the exercises.</p>
<p>For more details about the internal design and implementation of the Go web application, see code/README.md.</p>
<ul>
<li>gowebapp-mysql</li>
</ul>
<p>This directory contains the schema file used to setup the backing MySQL database for the Go web application.</p>
<h2 id="11-build-dockers-image-for-frontend-application">1.1 Build Dockers image for frontend application<a class="headerlink" href="#11-build-dockers-image-for-frontend-application" title="Permanent link">&para;</a></h2>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Two folders with go app and mysql config has been reviewed.</p>
</div>
<p><strong>Step 2</strong> Write Dockerfile for your frontend application</p>
<p>Create a file named <code>Dockerfile</code> in this directory for the frontend Go application. Use vi or any preferred text editor. The template below provides a starting point for defining the contents of this file. Replace TODO comments with the appropriate commands:</p>
<pre class="codehilite"><code>cd ~/ycit019_2022/Mod5_assignment/gowebapp
</code></pre>

<pre class="codehilite"><code>vim Dockerfile
</code></pre>

<pre class="codehilite"><code>FROM golang:1.15.11

LABEL maintainer &quot;student@mcgill.ca&quot;
LABEL gowebapp &quot;v1&quot;

EXPOSE 80

ENV GOPATH=/go

COPY /code $GOPATH/src/gowebapp/

WORKDIR $GOPATH/src/gowebapp/

RUN go get &amp;&amp; go install

ENTRYPOINT $GOPATH/bin/gowebapp
</code></pre>

<p><strong>Step 3</strong>  Build gowebapp Docker image locally</p>
<p>Build the  image locally. Make sure to include "." at the end. Make sure the
build runs to completion without errors. You should get a success message.</p>
<pre class="codehilite"><code>docker build -t &lt;user-name&gt;/gowebapp:v1 .
</code></pre>

<h2 id="12-build-docker-image-for-backend-application">1.2 Build Docker image for backend application<a class="headerlink" href="#12-build-docker-image-for-backend-application" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Locate folder with mysql config</p>
<pre class="codehilite"><code>cd ~/ycit019_2022/Mod5_assignment/gowebapp-mysql
</code></pre>

<p><strong>Step 2</strong> Write Dockerfile for your backend application</p>
<p>Create a file named <code>Dockerfile</code> in this directory for the backend MySQL database application. Use vi or any preferred text editor. The template below provides a starting point for defining the contents of this file. Replace TODO comments with the appropriate commands:</p>
<pre class="codehilite"><code>FROM mysql:8.0

LABEL maintainer &quot;student@mcgill.ca&quot;
LABEL gowebapp-sql &quot;v1&quot;

COPY gowebapp.sql /docker-entrypoint-initdb.d/
</code></pre>

<p><strong>Step 2</strong> Build gowebapp-mysql Docker image locally</p>
<pre class="codehilite"><code>docker build -t &lt;user-name&gt;/gowebapp-mysql:v1 .
</code></pre>

<p>Build the image locally. Make sure to include "." at the end. Make sure the
build runs to completion without errors. You should get a success message.
Run and test Docker images locally</p>
<h2 id="14-test-application-by-running-with-docker-engine">1.4 Test application by running with Docker Engine.<a class="headerlink" href="#14-test-application-by-running-with-docker-engine" title="Permanent link">&para;</a></h2>
<p>Before putting our app in production let's run the Docker images locally, to ensure that the frontend and backend containers run and integrate properly.</p>
<p><strong>Step 1</strong> Create Docker user-defined network</p>
<p>To facilitate cross-container communication, let's first define a user-defined
network in which to run the frontend and backend containers:</p>
<pre class="codehilite"><code>docker network create gowebapp \
-d bridge \
--subnet 172.19.0.0/16
</code></pre>

<p><strong>Step 2</strong>  Launch backend container</p>
<p>Next, let's launch a frontend and backend container using the Docker CLI.
First, we launch the database container, as it will take a bit longer to
startup, and the frontend container depends on it. Notice how we are injecting
the database password into the MySQL configuration as an environment variable:</p>
<pre class="codehilite"><code>docker run --net gowebapp --name gowebapp-mysql --hostname gowebapp-mysql \
-d -e MYSQL_ROOT_PASSWORD=rootpasswd &lt;user-name&gt;/gowebapp-mysql:v1
</code></pre>

<p>docker run --net gowebapp --name gowebapp-mysql --hostname gowebapp-mysql \
-d -e MYSQL_ROOT_PASSWORD=rootpasswd archyufa/gowebapp-mysql:v1</p>
<p><strong>Step 3</strong>  Launch frontend container</p>
<p>Now launch a frontend container, mapping the container port 80 - where the web application is exposed - to port 8080
 on the host machine:</p>
<pre class="codehilite"><code>docker run -p 8080:80 --net gowebapp -d --name gowebapp \
--hostname gowebapp &lt;user-name&gt;/gowebapp:v1
</code></pre>

<p>docker run -p 8080:80 -d --net gowebapp --name gowebapp \
--hostname gowebapp archyufa/gowebapp:v1</p>
<p><strong>Step 4</strong>  Test the application locally</p>
<p>Now that we've launched the application containers, let's try to test the web
application locally.</p>
<p>You should be able to access the application at Google Cloud <code>Web Preview</code> Console:</p>
<p><img alt="alt text" src="../images/web_preview.png" title="Web Preview" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Web Preview using port <code>8080</code> by default. If you application using other port, you can edit this as needed.</p>
</div>
<p>Once you can see the application loaded. Create an account and login.
Write something on your Notepad and save it. This will verify that the application is working and properly integrates with
the backend database container.</p>
<div class="admonition task">
<p class="admonition-title">Task</p>
<p>Take a screenshot of running application. </p>
</div>
<p><strong>Step 5</strong> Inspect the MySQL database</p>
<p>Let's connect to the backend MySQL database container and run some queries to
ensure that application persistence is working properly:</p>
<pre class="codehilite"><code>docker exec -it gowebapp-mysql  bash
</code></pre>

<p><strong>Step 6</strong> Once inside the container, connect to MySQL database:</p>
<pre class="codehilite"><code>mysql -u root -p
password:
</code></pre>

<p><strong>Step 7</strong> Once connected, run some simple SQL commands to inspect the database tables
and persistence:</p>
<pre class="codehilite"><code>#Simple SQL to navigate
SHOW DATABASES;
USE gowebapp;
SHOW TABLES;
SELECT * FROM &lt;table_name&gt;;
exit;
</code></pre>

<h2 id="15-cleanup-running-applications-and-unused-networks">1.5 Cleanup running applications and unused networks<a class="headerlink" href="#15-cleanup-running-applications-and-unused-networks" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code>docker rm -f $(docker ps -q)
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
