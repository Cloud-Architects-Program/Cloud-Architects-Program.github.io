
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>ycit019 Lab 5 Docker Compose - Cloud Architecture</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-docker-security" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cloud Architecture" class="md-header__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud Architecture
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ycit019 Lab 5 Docker Compose
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cloud Architecture" class="md-nav__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    Cloud Architecture
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          YCIT020
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="YCIT020" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          YCIT020
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Module_2_Lab_Terraform_Fundamentals" class="md-nav__link">
        Module 2 Terraform Fundamentals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Assignments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Assignments" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Assignments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Module_2_Assignment_Terraform_Foundation/" class="md-nav__link">
        Module 2 Terraforming GCP Foundation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Module_2_Assignment_Terraform_Foundation_solution/" class="md-nav__link">
        Module 2 Terraforming GCP Foundation Solution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Module_3_Assignment_Production_GKE/" class="md-nav__link">
        Module 3 Deploying Production GKE with gcloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../020_Module_4_Assignment_Production_GKE_terraform/" class="md-nav__link">
        Module 4 Deploying Production GKE with terraform
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          YCIT019
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="YCIT019" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          YCIT019
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_5_Lab_Docker_basics/" class="md-nav__link">
        Module 5 Lab - Docker Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_6_Lab_Advanced_Docker/" class="md-nav__link">
        Module 6 Lab - Advanced Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="md-nav__link">
        Module 7 Lab - Deploy Kubernetes Cluster with Kubeadm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_8_Lab_Kubernetes_Concepts/" class="md-nav__link">
        Module 8 Lab - Kuberenetes Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_9_Kubernetes_Features/" class="md-nav__link">
        Module 9 Lab - Kubernetes Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Module_10_Kubernetes_Scaling/" class="md-nav__link">
        Module 9 Part 2 Lab Kubernetes Autoscaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Lab_10_Networking/" class="md-nav__link">
        Module 10 Lab - Kubernetes Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_Lab_11_Storage/" class="md-nav__link">
        Module 11 Lab - Kubernetes Storage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Assignments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Assignments" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Assignments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass1/" class="md-nav__link">
        Module 5 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass1_sol/" class="md-nav__link">
        Module 5 Assignment Solution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass2/" class="md-nav__link">
        Module 6 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass2_solution/" class="md-nav__link">
        Module 6 Assignment Solution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass3/" class="md-nav__link">
        Module 8 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass3_solution/" class="md-nav__link">
        Module 8 Assignment Solution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass4_2022/" class="md-nav__link">
        Module 9 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass4_sol/" class="md-nav__link">
        Module 9 Assignment Solution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass7/" class="md-nav__link">
        Module 10 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ycit019_ass6_solution/" class="md-nav__link">
        Module 10 Assignment Solution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-docker-security" class="md-nav__link">
    1 Docker Security
  </a>
  
    <nav class="md-nav" aria-label="1 Docker Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-scan-images-with-trivy" class="md-nav__link">
    1.1 Scan images with Trivy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-docker-compose" class="md-nav__link">
    2 Docker Compose
  </a>
  
    <nav class="md-nav" aria-label="2 Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-deploy-guestbook-app-with-compose" class="md-nav__link">
    2.1 Deploy Guestbook app with Compose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-deploy-voting-app-using-compose" class="md-nav__link">
    2.2 Deploy Voting App using Compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p>Lab 5 Docker Compose and Docker Security</p>
<p><strong>Objective:</strong></p>
<ul>
<li>Practice to use Docker Compose, </li>
</ul>
<h2 id="1-docker-security">1 Docker Security<a class="headerlink" href="#1-docker-security" title="Permanent link">&para;</a></h2>
<h3 id="11-scan-images-with-trivy">1.1 Scan images with <a href="https://aquasecurity.github.io/trivy/v0.18.0/">Trivy</a><a class="headerlink" href="#11-scan-images-with-trivy" title="Permanent link">&para;</a></h3>
<p>Trivy (tri pronounced like trigger, vy pronounced like envy) is a simple and comprehensive vulnerability scanner for containers and other artifacts. A software vulnerability is a glitch, flaw, or weakness present in the software or in an Operating System. Trivy detects vulnerabilities of OS packages (Alpine, RHEL, CentOS, etc.) and application dependencies (Bundler, Composer, npm, yarn, etc.). Trivy is easy to use. Just install the binary and you're ready to scan. All you need to do for scanning is to specify a target such as an image name of the container.</p>
<p><strong>Step 1</strong>  Install Trivy</p>
<div class="codehilite"><pre><span></span><code>sudo apt-get install wget apt-transport-https gnupg lsb-release
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy
</code></pre></div>

<p><strong>Step 2</strong> Specify an image name (and a tag).</p>
<div class="codehilite"><pre><span></span><code>$ trivy image [YOUR_IMAGE_NAME]
</code></pre></div>

<p>For example:</p>
<div class="codehilite"><pre><span></span><code>$ trivy image python:3.4-alpine
</code></pre></div>

<div class="codehilite"><pre><span></span><code>2019-05-16T01:20:43.180+0900    INFO    Updating vulnerability database...
2019-05-16T01:20:53.029+0900    INFO    Detecting Alpine vulnerabilities...

python:3.4-alpine3.9 (alpine 3.9.2)
===================================
Total: 1 (UNKNOWN: 0, LOW: 0, MEDIUM: 1, HIGH: 0, CRITICAL: 0)

+---------+------------------+----------+-------------------+---------------+--------------------------------+
| LIBRARY | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |             TITLE              |
+---------+------------------+----------+-------------------+---------------+--------------------------------+
| openssl | CVE-2019-1543    | MEDIUM   | 1.1.1a-r1         | 1.1.1b-r1     | openssl: ChaCha20-Poly1305     |
|         |                  |          |                   |               | with long nonces               |
+---------+------------------+----------+-------------------+---------------+--------------------------------+
</code></pre></div>

<p><strong>Step 3</strong>  Explore local images in your environment. </p>
<h1 id="2-docker-compose">2 Docker Compose<a class="headerlink" href="#2-docker-compose" title="Permanent link">&para;</a></h1>
<p>In this module, will guide you through the process of building a multi-container
application using docker compose. The application code is available at GitHub: <a href="https://github.com/Cloud-Architects-Program/ycit019">https://github.com/Cloud-Architects-Program/ycit019</a></p>
<h2 id="21-deploy-guestbook-app-with-compose">2.1 Deploy Guestbook app with Compose<a class="headerlink" href="#21-deploy-guestbook-app-with-compose" title="Permanent link">&para;</a></h2>
<p>Let’s build another application. This time we going to create famous Guestbook
application.</p>
<p>Guestbook consists of three services. A redis-master node, a set of redis-slave
that can be scaled and find the redis-master via its DNS name. And a PHP frontend
that exposes itself on port 80. The resulting application allows you to leave
short messages which are stored in the redis cluster.</p>
<p><strong>Step 1</strong> Change directory to the guestbook</p>
<div class="codehilite"><pre><span></span><code>cd ~/ycit019/Module5/guestbook/
ls
</code></pre></div>

<p><strong>Step 2</strong> Let’s review the docker-guestbook.yml file</p>
<div class="codehilite"><pre><span></span><code>version: &quot;2&quot;

services:
 redis-master:
   image: gcr.io/google_containers/redis:e2e
   ports:
     - &quot;6379&quot;
 redis-slave:
   image: gcr.io/google_samples/gb-redisslave:v1
   ports:
     - &quot;6379&quot;
   environment:
     - GET_HOSTS_FROM=dns
 frontend:
   image: gcr.io/google-samples/gb-frontend:v4
   ports:
     - &quot;80:80&quot;
   environment:
     - GET_HOSTS_FROM=dns
</code></pre></div>

<p><strong>Step 3</strong> Let’s run docker-guestbook.yml with compose</p>
<div class="codehilite"><pre><span></span><code>export LD_LIBRARY_PATH=/usr/local/lib
docker-compose -f docker-guestbook.yml up -d
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Creating network &quot;examples_default&quot; with the default driver
Creating examples_redis-slave_1
Creating examples_frontend_1
Creating examples_redis-master_1
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>-d</code> -  Detached mode: Run containers in the background, print new container names.</p>
<p><code>-f</code> -  Specify an alternate compose file (default: docker-compose.yml)</p>
</div>
<p><strong>Step 4</strong> Check that all containers are running:</p>
<div class="codehilite"><pre><span></span><code>docker ps
</code></pre></div>

<div class="codehilite"><pre><span></span><code>CONTAINER ID        IMAGE                                    COMMAND
d1006d1beee5        gcr.io/google-samples/gb-frontend:v4     &quot;apache2-foreground&quot;
fb3a15fde23f        gcr.io/google_containers/redis:e2e       &quot;redis-server /etc...&quot;
326b94d4cdd7        gcr.io/google_samples/gb-redisslave:v1   &quot;/entrypoint.sh /b...&quot;
</code></pre></div>

<p><strong>Step 5</strong>  Test the application locally</p>
<p>Now that we've launched the application containers, let's try to test the web
application locally.</p>
<p>You should be able to access the application at Google Cloud <code>Web Preview</code> Console:</p>
<p><img alt="alt text" src="../images/web_preview.png" title="Web Preview" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Web Preview using port <code>8080</code> by default. If you application using other port, you can edit this as needed.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Nice you now have compose stuck up and running!</p>
</div>
<p><strong>Step 6</strong> Cleanup environment:</p>
<div class="codehilite"><pre><span></span><code>docker-compose -f docker-guestbook.yml down
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Stopping guestbook_frontend_1 ... done
Stopping guestbook_redis-master_1 ... done
Stopping guestbook_redis-slave_1 ... done
Removing guestbook_frontend_1 ... done
Removing guestbook_redis-master_1 ... done
Removing guestbook_redis-slave_1 ... done
Removing network guestbook_default
</code></pre></div>

<h2 id="22-deploy-voting-app-using-compose">2.2 Deploy Voting App using Compose<a class="headerlink" href="#22-deploy-voting-app-using-compose" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Switch to <code>Module5/example-voting-app</code> folder :</p>
<div class="codehilite"><pre><span></span><code>cd ~/ycit019/Module5/example-voting-app/
</code></pre></div>

<p><strong>Step 2</strong> The existing file docker-compose.yml defines several images:</p>
<ul>
<li>
<p>A voting-app container based on a Python image</p>
</li>
<li>
<p>A result-app container based on a Node.js image</p>
</li>
<li>
<p>A Redis container based on a redis image, to temporarily store the data.</p>
</li>
<li>
<p>A worker app based on a dotnet image</p>
</li>
<li>
<p>A Postgres container based on a postgres image</p>
</li>
</ul>
<p><strong>App Architecture:</strong>
<img alt="alt text" src="https://github.com/Cloud-Architects-Program/ycit019/blob/main/Module5/example-voting-app/architecture.png" title="architecture" /></p>
<p>Note that three of the containers are built from Dockerfiles, while the other
two are images on Docker Hub. Let's review them closely:</p>
<p><strong>Step 3</strong> Review files that going to be deployed with <code>tree</code> command.
Alternatively view the files in <a href="https://github.com/Cloud-Architects-Program/ycit019/tree/main/Module5/example-voting-app">gitrepo page here</a></p>
<div class="codehilite"><pre><span></span><code>sudo apt install tree
tree
</code></pre></div>

<p>Step 5 Let’s change the default port to expose. Edit the docker-compose.yml file and find the following lines:</p>
<div class="codehilite"><pre><span></span><code>ports:
  - &quot;5000:80&quot;
</code></pre></div>

<p>Change 5000 to 8080:</p>
<div class="codehilite"><pre><span></span><code>ports:
  - &quot;8080:80&quot;
</code></pre></div>

<p><strong>Step 4</strong> Verify Docker Compose version:</p>
<div class="codehilite"><pre><span></span><code>docker-compose version
</code></pre></div>

<p><strong>Step 5</strong> Use the docker-compose tool to launch your application:</p>
<div class="codehilite"><pre><span></span><code>docker-compose up -d
</code></pre></div>

<p><strong>Step 6</strong> Check that all containers are running, volumes created. Check
compose state and logs :</p>
<div class="codehilite"><pre><span></span><code>#Docker state
docker ps
docker volumes
#Docker compose state
docker-compose ps
docker-compose logs
</code></pre></div>

<p><strong>Step 7</strong> Now that we've launched the application containers, let's try to test the web
application locally.</p>
<p>You should be able to access the application at Google Cloud <code>Web Preview</code> Console:</p>
<p><img alt="alt text" src="../images/web_preview.png" title="Web Preview" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Web Preview using port <code>8080</code> by default. If you application using other port, you can edit this as needed.</p>
</div>
<p><strong>Step 8</strong> Cleanup up.</p>
<div class="codehilite"><pre><span></span><code>docker-compose down
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Stopping examplevotingapp_worker_1 ... done
Stopping examplevotingapp_redis_1 ... done
Stopping examplevotingapp_result_1 ... done
Stopping examplevotingapp_db_1 ... done
Stopping examplevotingapp_vote_1 ... done
Removing examplevotingapp_worker_1 ... done
Removing examplevotingapp_redis_1 ... done
Removing examplevotingapp_result_1 ... done
Removing examplevotingapp_db_1 ... done
Removing examplevotingapp_vote_1 ... done
Removing network examplevotingapp_default
</code></pre></div>

<p><strong>Step 9</strong> You <strong>Boss</strong> told you that the application has a bug. Update the
the app by editing the vote/app.py file and change the following lines near the
top of the file:</p>
<div class="codehilite"><pre><span></span><code>vim vote/app.py
</code></pre></div>

<p>Press 'i'</p>
<div class="codehilite"><pre><span></span><code>option_a = os.getenv(&#39;OPTION_A&#39;, &quot;Cats&quot;)
option_b = os.getenv(&#39;OPTION_B&#39;, &quot;Dogs&quot;)
</code></pre></div>

<p><strong>Step 10</strong> Replace “Cats” and “Dogs” with two options of your choice. For example:</p>
<div class="codehilite"><pre><span></span><code>option_a = os.getenv(&#39;OPTION_A&#39;, &quot;Java&quot;)
option_b = os.getenv(&#39;OPTION_B&#39;, &quot;Python&quot;)
</code></pre></div>

<p>Press 'wq!'</p>
<p><strong>Step 11</strong> Use docker-compose tool to launch your Update application:</p>
<div class="codehilite"><pre><span></span><code>docker-compose up -d
</code></pre></div>

<p>Check the UI</p>
<div class="admonition bingo">
<p class="admonition-title">Bingo</p>
<p>Let's see who wins the battle of Orchestrations!</p>
</div>
<p><strong>Step 8</strong> Cleanup up</p>
<div class="codehilite"><pre><span></span><code>docker-compose down
</code></pre></div>

<div class="admonition congratulations">
<p class="admonition-title">Congratulations</p>
<p>You are now docker expert!
We were able to start 2 microservices application with docker compose.
First microservice had 3 services.
Second microservice had 5 servics written in 3 different languages and able
to talk to each other.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>So far we've learned docker-compose v2.
docker-compose v3 is out of scope for this Lab. However you got the idea!</p>
<p>Read the Docker-Compose <a href="https://docs.docker.com/compose/compose-file/">documentation</a> on new syntax.</p>
<p>Also example of v3 version of <code>voting-app</code> is <a href="https://github.com/Cloud-Architects-Program/ycit019/blob/main/Module5/v3-voting-app">here</a> for you reference.</p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/googlecloud" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>