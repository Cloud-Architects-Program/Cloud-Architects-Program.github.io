
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cloud-architects-program.github.io/020_Module_2_Assignment_Terraform_Foundation/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>020 Module 2 Assignment Terraform Foundation - Cloud Architecture</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prepare-lab-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cloud Architecture" class="md-header__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud Architecture
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              020 Module 2 Assignment Terraform Foundation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cloud Architecture" class="md-nav__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    Cloud Architecture
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cloud Native Administrator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Cloud Native Administrator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 5 - Docker Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Module 5 - Docker Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../presentation5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_5_Lab_Docker_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 6 - Advanced Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Module 6 - Advanced Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_6_Lab_Advanced_Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prepare-lab-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare Lab Environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-git-and-iac" class="md-nav__link">
    <span class="md-ellipsis">
      Working with Git and IaC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with Git and IaC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-terrform-iac-code-to-source-code-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Add Terrform IaC code to Source Code repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-build-gcp-foundation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      1 Build GCP Foundation Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Build GCP Foundation Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-installing-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Installing Terraform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-configure-gcp-credentials-for-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Configure GCP credentials for Terraform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-initializing-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Initializing Terraform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.3 Initializing Terraform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-declare-terraform-providers" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.1 Declare Terraform Providers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-configure-the-terraform-provider" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.2 Configure the Terraform Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-initialize-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.3 Initialize Terraform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-terraform-variables" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 Terraform Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 Terraform Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-declare-input-variables" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 Declare Input Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-using-variables" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 Using Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-working-with-variables-files" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.3 Working with Variables files.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-validate-configuration-and-code-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.4 Validate configuration and code syntax
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-create-gcp-project-using-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      1.5 Create GCP project using Terraform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.5 Create GCP project using Terraform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-configure-google_project-resource" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.1 Configure google_project resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-making-project-resource-immutable" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.2 Making Project resource Immutable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-create-a-project-using-terraform-random-provider" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.3 Create a Project using Terraform Random Provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-create-a-project_id-name-using-local-values" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.3 Create a Project_ID name using Local Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-configure-terraform-output-for-gcp-project" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.4 Configure Terraform Output for GCP Project
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-recreate-gcp-project-without-default-vpc" class="md-nav__link">
    <span class="md-ellipsis">
      1.5.5 Recreate GCP Project without Default VPC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-create-gcp-storage-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      1.6 Create GCP Storage bucket
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.6 Create GCP Storage bucket">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161-create-gcp-storage-bucket-in-new-gcp-project" class="md-nav__link">
    <span class="md-ellipsis">
      1.6.1 Create GCP Storage bucket in New GCP Project
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#162-configure-versioning-on-gcp-storage-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      1.6.2 Configure versioning on GCP Storage bucket.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-build-gcp-services-layer" class="md-nav__link">
    <span class="md-ellipsis">
      2 Build GCP Services Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Build GCP Services Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-initialize-terraform-for-gcp-services-layer" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Initialize Terraform for GCP Services Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 Initialize Terraform for GCP Services Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-define-and-configure-terraform-provider" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.1 Define and configure terraform provider
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-configure-terraform-state-backend" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.2 Configure Terraform State backend
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-enable-required-gcp-services-api" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Enable required GCP Services API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-set-variables-to-define-standard-for-naming-convention" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Set variables to define standard for Naming Convention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-create-a-custom-mode-network-vpc-with-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Create a custom mode network (VPC) with terraform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-commit-terraform-configurations-to-repository-and-share-it-with-instructorteacher" class="md-nav__link">
    <span class="md-ellipsis">
      5 Commit Terraform configurations to repository and share it with Instructor/Teacher
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>020 Module 2 Assignment Terraform Foundation</h1>

<p><strong>Objective:</strong></p>
<ul>
<li>Learn Terraform Commands</li>
<li>Learn GCP Terraform Provider</li>
<li>Learn Terraform variables</li>
<li>Store TF State in GCS buckets</li>
<li>Learn how to create GCP resources with Terraform </li>
</ul>
<h2 id="prepare-lab-environment">Prepare Lab Environment<a class="headerlink" href="#prepare-lab-environment" title="Permanent link">&para;</a></h2>
<p>This lab can be executed in you GCP Cloud Environment using Google Cloud Shell.</p>
<p>Open the Google Cloud Shell by clicking on the icon on the top right of the screen:</p>
<p><img alt="alt text" src="../images/cloud_shell.png" title="Google Cloud Shell" /></p>
<p>Once opened, you can use it to run the instructions for this lab.</p>
<h2 id="working-with-git-and-iac">Working with Git and IaC<a class="headerlink" href="#working-with-git-and-iac" title="Permanent link">&para;</a></h2>
<p>Git-based workflows, merge requests and peer reviews create a level of documented transparency that is great for security teams and audits. They ensure every change is documented as well as the metadata surrounding the change, answering the why, who,
when and what questions.</p>
<p>In this set of exercises you will continue using <code>notepad</code> Google Source Repository that already contains you application code, <code>dockerfiles</code> and kubernetes manifests, that we've used in <code>ycit019</code></p>
<h3 id="add-terrform-iac-code-to-source-code-repository">Add Terrform IaC code to Source Code repository<a class="headerlink" href="#add-terrform-iac-code-to-source-code-repository" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Go into your personal Google Cloud Source Repository:</p>
<div class="codehilite"><pre><span></span><code>export student_name=&lt;write_your_name_here_and_remove_brakets&gt;
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Replace $student_id with your ID</p>
</div>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad
</code></pre></div>

<div class="codehilite"><pre><span></span><code>git pull                              # Pull latest code from you repo
</code></pre></div>

<p><strong>Step 2</strong> Create 2 folders: <code>foundation-infrastructure</code> and <code>notepad-infrastructure</code>  that will contain terraform infrastructure for you GCP foundation and infrastructure that will be used Notepad application such as GKE clusters and CloudSQL database.</p>
<div class="codehilite"><pre><span></span><code>mkdir ycit020_module2
cd ycit020_module2
mkdir foundation-infrastructure
mkdir notepad-infrastructure
</code></pre></div>

<p><strong>Step 3</strong> Create a <code>README.md</code> file describing <code>foundation-infrastructure</code> folder purpose:  </p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; foundation-infrastructure/README.md

# Creation of GCP Foundation Layer

This terraform automation, is focused on creating GCP Foundation: GCP folders (if any) and GCP projects, GCS bucket to store terraform state and required IAM Configuration.

EOF
</code></pre></div>

<p><strong>Step 4</strong> Create a <code>README.md</code> file describing <code>notepad-infrastructure</code> folder purpose:  </p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; notepad-infrastructure/README.md
# Creation of GCP Services Layer

This terraform automation, is focused on creating gcp services such as GKE, VPC, CloudSQL and etc. inside of projects created by `foundation-infrastructure` terraform automation.

EOF
</code></pre></div>

<p><strong>Step 5</strong> Create a .gitignore file in your working directory:</p>
<div class="codehilite"><pre><span></span><code>cat&lt;&lt;EOF&gt;&gt; .gitignore
.terraform.*
.terraform
terraform.tfstate*
EOF
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ignore files are used to tell <code>git</code> not to track files. You should also always include any files with credentials in a <code>gitignore</code> file.</p>
</div>
<p>List created folder structure along with <code>gitignore</code>:</p>
<div class="codehilite"><pre><span></span><code>ls -ltra
</code></pre></div>

<p><strong>Step 6</strong> Commit <code>deploy</code> folder using the following Git commands:</p>
<div class="codehilite"><pre><span></span><code>git status 
git add .
git commit -m &quot;Terraform Folder structure for module 2&quot;
</code></pre></div>

<p><strong>Step 6</strong> Once you've committed code to the local repository, add its contents to Cloud Source Repositories using the git push command:</p>
<div class="codehilite"><pre><span></span><code>git push origin master
</code></pre></div>

<h2 id="1-build-gcp-foundation-layer">1 Build GCP Foundation Layer<a class="headerlink" href="#1-build-gcp-foundation-layer" title="Permanent link">&para;</a></h2>
<p>In this assignment we going to build GCP Foundation layer. As we learned in the class this includes Org Structure creation with Folders and Projects, creation IAM Roles and assigning them to users and groups in organization. This Layer usually build be DevOps or Infra team that.</p>
<p>Since we don't have organization registered for each student, we going to skip creation of folders and IAM groups. We going to start from creation of a Project, deleting <code>default</code> VPC and configuring inside that project a <code>gcs</code> bucket that will be used in the next terraform layer to store a Terraform state.</p>
<p><strong>Part 1:</strong> Create Terraform Configurations file to create's  GCP Foundation Layer:</p>
<p>Layer 1 From existing  (we going to call it seeding) project that you currently use to store code in Google Cloud Source Repository:</p>
<ul>
<li>Create structure: provider.tf, variable.tf, variables.tfvars, main.tf, output.tf</li>
<li>Create a new <code>notepad-dev</code> Project<ul>
<li>Delete Default VPC</li>
</ul>
</li>
<li>Create a bucket in this project to store terraform state</li>
</ul>
<p><img alt="alt text" src="../images/foundation.png" title="Terraform Foundation Layer" /></p>
<p><strong>Part 2:</strong> Create Terraform Configurations file that create's  GCP Services Layer:</p>
<p>Layer 2 From <code>notepad-dev</code> GCP Project:</p>
<ul>
<li>Enable Google Project Service APIs</li>
<li>Create VPC (google_compute_network) and Subnet (google_compute_subnetwork)</li>
</ul>
<p><img alt="alt text" src="../images/gcp_service_layer.png" title="Terraform Service Layer" /></p>
<h3 id="11-installing-terraform">1.1 Installing Terraform<a class="headerlink" href="#11-installing-terraform" title="Permanent link">&para;</a></h3>
<p>GCP Cloud Shell comes with many common tools pre-installed including <code>terraform</code></p>
<p>Verify and validate the version of Terraform that is installed:</p>
<div class="codehilite"><pre><span></span><code>terraform --version
</code></pre></div>

<p>If you want to use specific version of terraform or want to install terraform in you local machine use following <a href="https://www.terraform.io/downloads.html">link</a> to download binary.</p>
<h3 id="12-configure-gcp-credentials-for-terraform">1.2 Configure GCP credentials for Terraform<a class="headerlink" href="#12-configure-gcp-credentials-for-terraform" title="Permanent link">&para;</a></h3>
<p>If you would like to use terraform on GCP you have 2 options:</p>
<p>1). Using you <code>user credentials</code>, great option for testing terraform from you laptop and for learning purposes.</p>
<p>2). Using <a href="https://cloud.google.com/docs/authentication/getting-started#command-line">service account</a>, great option if you going to use terraform with CI/CD system and fully automate Terraform deployment.</p>
<p>In this assignment we going to use Option 1 - using user credentials.</p>
<p><strong>Step 1:</strong> In order to make requests against the GCP API, you need to authenticate to prove that it's you making the request. 
The preferred method of provisioning resources with Terraform on your workstation is to use the Google Cloud SDK (Option 1) </p>
<div class="codehilite"><pre><span></span><code>gcloud auth application-default login
</code></pre></div>

<h3 id="13-initializing-terraform">1.3 Initializing Terraform<a class="headerlink" href="#13-initializing-terraform" title="Permanent link">&para;</a></h3>
<p>Terraform relies on <code>providers</code> to interact with remote systems. Every resource type is implemented by a provider; without
<code>providers</code>, Terraform can't manage any kind of infrastructure; in order for terraform to install and use a provider it must be
declared.</p>
<p>In this exercise you will declare and configure the Terraform provider(s) that will be used for the rest of the assignment.</p>
<h4 id="131-declare-terraform-providers">1.3.1 Declare Terraform Providers<a class="headerlink" href="#131-declare-terraform-providers" title="Permanent link">&para;</a></h4>
<p>The <code>required_providers</code> block defines the providers terraform will use to provision resources and their source.</p>
<ul>
<li>
<p><code>version</code>: The version argument is optional and is used to tell terraform to pick a particular version from the availale
versions</p>
</li>
<li>
<p><code>source</code>: The source is the provider registry e.g. hashicorp/gcp is the short for registry.terraform.io/hashicorp/gcp</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad/ycit020_module2/foundation-infrastructure/
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; provider.tf
terraform {
  required_providers {
    google = {
      source  = &quot;hashicorp/google&quot;
      version = &quot;~&gt; 4.37.0&quot;
    }
  }
}
EOF
</code></pre></div>

<h4 id="132-configure-the-terraform-provider">1.3.2 Configure the Terraform Provider<a class="headerlink" href="#132-configure-the-terraform-provider" title="Permanent link">&para;</a></h4>
<p>Providers often require configuration (like endpoint URLs or cloud regions) before they can be used. These configurations are defined by a <code>provider</code> block. Multiple provider configuration blocks can be declared for the same by adding the <code>alias</code>
argument</p>
<p>Set you current <code>PROJECT_ID</code> value here:</p>
<div class="codehilite"><pre><span></span><code>export PROJECT_ID=&lt;YOUR_PROJECT_ID&gt;
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; main.tf
provider &quot;google&quot; {
  alias   = &quot;gcp-provider&quot;
  project = &quot;$PROJECT_ID&quot;
  region  = &quot;us-central1&quot;
}
EOF
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We configured <code>provider</code>, so that it can provision resource in specified gcp project in <code>us-central1</code> region.</p>
</div>
<h4 id="133-initialize-terraform">1.3.3 Initialize Terraform<a class="headerlink" href="#133-initialize-terraform" title="Permanent link">&para;</a></h4>
<p>Now that you have declared and configured the GCP provider for terraform, initialize terraform:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad/ycit020_module2/foundation-infrastructure/
terraform init
</code></pre></div>

<p>Explore your directory. What has changed?</p>
<div class="codehilite"><pre><span></span><code>ls -ltra
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see that new directory <code>.terraform</code> and <code>.terraform.lock.hcl</code> file.</p>
</div>
<p><strong>Extra Research! Not Mandatory</strong></p>
<p>Investigate available providers in the <a href="https://registry.terraform.io/">Terraform Provider Registry</a></p>
<p>Select another provider from the list, add it to your required providers, and to your main.tf</p>
<p>Run terraform init to load your new provider!</p>
<h3 id="14-terraform-variables">1.4 Terraform Variables<a class="headerlink" href="#14-terraform-variables" title="Permanent link">&para;</a></h3>
<p>Input variables are used to increase your Terraform configuration's flexibility by defining values that can be assigned to customize the configuration. They provide a consistent interface to change how a given configuration behaves. Input variables blocks have a defined format:</p>
<p>Input variables blocks have a defined format:</p>
<div class="codehilite"><pre><span></span><code>variable &quot;variable_name&quot; {
  type = &quot;The variable type eg. string , list , number&quot;
  description = &quot;A description to understand what the variable will be used for&quot;
  default = &quot;A default value can be provided, terraform will use this if no other value is provided at terraform apply&quot;
}
</code></pre></div>

<p>Terraform CLI defines the following optional arguments for variable declarations:</p>
<ul>
<li>default - A default value which then makes the variable optional.</li>
<li>type - This argument specifies what value types are accepted for the variable.</li>
<li>description - This specifies the input variable's documentation.</li>
<li>validation - A block to define validation rules, usually in addition to type constraints.</li>
<li>sensitive - Limits Terraform UI output when the variable is used in configuration.</li>
</ul>
<p>In our above example for <code>main.tf</code> we can actually declare <code>project</code> and <code>region</code> as variables, so let's do it.</p>
<h4 id="141-declare-input-variables">1.4.1 Declare Input Variables<a class="headerlink" href="#141-declare-input-variables" title="Permanent link">&para;</a></h4>
<p>Variables are declared in a <code>variables.tf</code> file inside your terraform working directory.</p>
<p>The label after the variable keyword is a name for the variable, which must be unique among all variables in the same module.  You can choose variable name based on you preference, or in some cases based on agreed in company naming convention. In our case we declaring variables names: <code>gcp_region</code> and <code>gcp_project_id</code></p>
<p>We are going to declare a type as a  <code>string</code> variable for <code>gcp_project_id</code> and <code>gcp_region</code>.</p>
<p>It is always good idea to specify a clear <code>description</code> for the variable for documentation purpose as well as code reusability and readability.</p>
<p>Finally, let's configured <code>default</code> argument. In our case we going to use "us-central1" as a <code>default</code> for <code>gcp_region</code> and we going to keep <code>default</code> value empty for <code>gcp_project_id</code>.</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; variables.tf
variable &quot;gcp_region&quot; {
  type        = string
  description = &quot;The GCP Region&quot;
  default     = &quot;us-central1&quot;
}

variable &quot;gcp_project_id&quot; {
  type        = string
  description = &quot;The GCP Seeding project ID&quot;
  default     = &quot;&quot;
}
EOF
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Explore other <a href="https://www.terraform.io/docs/language/values/variables.html#type-constraints">type</a> of variables such as <code>number</code>, <code>bool</code> and type constructors such as: list(<TYPE>), set(<TYPE>), map(<TYPE>)</p>
</div>
<h4 id="142-using-variables">1.4.2 Using Variables<a class="headerlink" href="#142-using-variables" title="Permanent link">&para;</a></h4>
<p>Now that you have created your input variables, let's re-create <code>main.tf</code> that currently has the terraform configuration for GCP Provider.</p>
<div class="codehilite"><pre><span></span><code>rm main.tf
cat &lt;&lt; EOF&gt;&gt; main.tf
provider &quot;google&quot; {
  alias   = &quot;gcp-provider&quot;
  project = var.gcp_project_id
  region  = var.gcp_region
}
EOF
</code></pre></div>

<p>Validate your terraform configuration:</p>
<div class="codehilite"><pre><span></span><code>terraform validate
</code></pre></div>

<h4 id="143-working-with-variables-files">1.4.3 Working with Variables files.<a class="headerlink" href="#143-working-with-variables-files" title="Permanent link">&para;</a></h4>
<p>Create a <code>terraform.tfvars</code> file to hold the values for your variables:</p>
<div class="codehilite"><pre><span></span><code>export gcp_project_id=&lt;YOUR_PROJECT_ID&gt;
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; terraform.tfvars
gcp_project_id = &quot;$PROJECT_ID&quot;
gcp_region = &quot;us-central1&quot;
EOF
</code></pre></div>

<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>using different <code>env-name.tfvars</code> files you can create different set of terraform configuration for the same code. (e.g. code for dev, staging, prod)</p>
</div>
<h4 id="144-validate-configuration-and-code-syntax">1.4.4 Validate configuration and code syntax<a class="headerlink" href="#144-validate-configuration-and-code-syntax" title="Permanent link">&para;</a></h4>
<p>Let's Validate configuration and code syntax that we've added so far.</p>
<p>There are several tools that can analyze your Terraform code without running it, including:</p>
<p>Terraform has build in command that you can use to check your Terraform syntax and types (a bit like a compiler):</p>
<div class="codehilite"><pre><span></span><code>terraform validate
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Seems the code is legit so far</p>
</div>
<p>Does your terraform files easy to read and follow? Terraform has a built-in function to <code>lint</code> your configuration manifests for readability and best practice spacing:</p>
<p>Compare before lint:</p>
<div class="codehilite"><pre><span></span><code>cat terraform.tfvars
</code></pre></div>

<p>Perform lint:</p>
<div class="codehilite"><pre><span></span><code>terraform fmt --recursive
</code></pre></div>

<p>Check file after linting:</p>
<div class="codehilite"><pre><span></span><code>cat terraform.tfvars
</code></pre></div>

<p>The <code>--recursive</code> flag asks the <code>fmt</code> command to traverse all of your terraform directories and format the .tf files it finds. It
will report the files it changed as part of the return information of the command</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Use the git diff command to see what was changed.</p>
</div>
<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see that <code>terraform.tfvars</code> file had some spacing that been fixed for better code readability.</p>
</div>
<div class="admonition extra">
<p class="admonition-title">Extra</p>
<p>Another cool tool that you can use along you terraform development is <a href="https://github.com/terraform-linters/tflint/blob/master/README.md">tflint</a> - framework and each feature is provided by plugins, the key features are as follows:</p>
<ul>
<li>Find possible errors (like illegal instance types) for Major Cloud providers (AWS/Azure/GCP).</li>
<li>Warn about deprecated syntax, unused declarations.</li>
<li>Enforce best practices, naming conventions.</li>
</ul>
</div>
<p>Finally let's run <code>terraform plan</code>:</p>
<div class="codehilite"><pre><span></span><code>terraform plan
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>No changes. Your infrastructure matches the configuration.
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We don't have any errors, however we don't have any resources created so far. Let's create a GCP project resource to start with!</p>
</div>
<h3 id="15-create-gcp-project-using-terraform">1.5 Create GCP project using Terraform<a class="headerlink" href="#15-create-gcp-project-using-terraform" title="Permanent link">&para;</a></h3>
<h4 id="151-configure-google_project-resource">1.5.1 Configure <code>google_project</code> resource<a class="headerlink" href="#151-configure-google_project-resource" title="Permanent link">&para;</a></h4>
<p><code>Resources</code> describe the infrastructure objects you want terraform to create. A resource block can be used to create any object such as virtual private cloud, security groups, DNS records etc.</p>
<p>Let's create our first Terraform resource: GCP project.</p>
<p>In order to accomplish this we going to use <code>google_project</code> resource, documented <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project">here</a></p>
<p>In order to create a new Project we need to define following arguments:
  * name - (Required) The display name of the project.
  * project_id - (Required) The project ID. Changing this forces a new project to be created.
  * billing_account - The alphanumeric ID of the billing account this project belongs to.</p>
<p><strong>Step 1</strong>  Let's define <code>google_project</code> resource in <code>project.tf</code> file, we will replace actual values for <code>name</code> and <code>billing_account</code> with variables:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; project.tf
resource &quot;google_project&quot; &quot;project&quot; {
  name                = var.project_name
  billing_account     = var.billing_account
  project_id          = var.project_id
}
EOF
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are creating as part of the GCP organization,  you have to add the variable <code>org_id</code>in the project.tf file.</p>
</div>
<p><strong>Step 2</strong> Let's declare actual values for <code>name</code>, <code>project_id</code> and <code>billing_account</code> as variables in <code>variables.tf</code>:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; variables.tf
variable &quot;billing_account&quot; {
  description = &quot;The billing account ID for this project&quot;
}

variable &quot;project_name&quot; {
  description = &quot;The human readable project name (min 4 letters)&quot;
}

variable &quot;project_id&quot; {
  description = &quot;The GCP project ID&quot;
}
EOF
</code></pre></div>

<p><strong>Step 3</strong>  Update <code>terraform.tfvars</code> variables files, with actual values for  <code>name</code>, <code>project_id</code> and <code>billing_account</code>:</p>
<p>As a best practices we going to follow specific naming convention when we going to create <code>PROJECT_ID</code> and <code>PROJECT_NAME</code>, in order to define your new GCP project:</p>
<div class="codehilite"><pre><span></span><code>export ORG=$student_name
export PRODUCT=notepad
export ENV=dev
export PROJECT_PREFIX=1
</code></pre></div>

<div class="codehilite"><pre><span></span><code>export PROJECT_NAME=$ORG-$PRODUCT-$ENV
export PROJECT_ID=$ORG-$PRODUCT-$ENV-$PROJECT_PREFIX  # Project ID has to be unique
</code></pre></div>

<p>Verify that project name looks good:</p>
<div class="codehilite"><pre><span></span><code>echo $PROJECT_NAME
echo $PROJECT_ID
</code></pre></div>

<p>In order to get Education <code>Billing account number</code> run following command:</p>
<div class="codehilite"><pre><span></span><code>ACCOUNT_ID=$(gcloud beta billing accounts list | grep -B2 True  | head -1 | grep ACCOUNT_ID  |awk &#39;{ print $2}&#39;) 
</code></pre></div>

<p>Verify that number is good:</p>
<div class="codehilite"><pre><span></span><code>echo $ACCOUNT_ID
</code></pre></div>

<p>This might force installation of <code>gcloud beta</code> commands and may take up to 10 mins. It may also ask for some APIs to be enabled.</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; terraform.tfvars
billing_account = &quot;$ACCOUNT_ID&quot;
project_name    = &quot;$PROJECT_NAME&quot;
project_id      = &quot;$PROJECT_ID&quot;
EOF
</code></pre></div>

<p>Verify if <code>billing_account</code>, <code>project_name</code>, <code>project_id</code> are correct values:</p>
<div class="codehilite"><pre><span></span><code>cat terraform.tfvars
</code></pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Verify if <code>billing_account</code>, <code>project_name</code>, <code>project_id</code> are correct values, if not set the values manually.</p>
</div>
<p><strong>Step 4</strong> Run <code>terraform plan</code> command:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p><code>Plan: 1 to add, 0 to change, 0 to destroy.</code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Take notice of plan command and see how some values that you declared in <code>*.tvfars</code> are visible and some values will <code>known after apply</code></p>
</div>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify <code>GCP Project</code> has been created:</p>
<div class="codehilite"><pre><span></span><code>gcloud projects list | grep notepad
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>PROJECT_ID: $student-name-notepad-dev-1
NAME: $student-name-notepad-dev
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We've created our first resource <code>gcp_project</code> with terraform</p>
</div>
<h4 id="152-making-project-resource-immutable">1.5.2 Making Project resource Immutable<a class="headerlink" href="#152-making-project-resource-immutable" title="Permanent link">&para;</a></h4>
<p>Read more about Immutable Infrastructure <a href="https://www.hashicorp.com/resources/what-is-mutable-vs-immutable-infrastructure">in this article</a></p>
<p>Very often when you developing IaC, you need to destroy and recreate your resorces, e.g. for troubleshooting or creating a new resources using same config.
Let's <code>destroy</code> our project and try to recreate it again.</p>
<div class="codehilite"><pre><span></span><code>terraform destroy -var-file terraform.tfvars
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>│ Error: error creating project archy-notepad-dev-1 (archy-notepad-dev): googleapi: Error 409: Requested entity already exists, alreadyExists. If you received a 403 error, make sure you have the `roles/resourcemanager.projectCreator` permission
│
│   with google_project.project,
│   on project.tf line 1, in resource &quot;google_project&quot; &quot;project&quot;:
│    1: resource &quot;google_project&quot; &quot;project&quot; {
</code></pre></div>

<div class="admonition failed">
<p class="admonition-title">Failed</p>
<p>What happened? Did you project been able to create? If not why ?</p>
</div>
<p>If we want to make our infrastructure to be <a href="https://www.hashicorp.com/resources/what-is-mutable-vs-immutable-infrastructure">Immutable</a> and fully automated, we need to make sure that we can destroy our service and recreate it any time the same way.
In our case we can't do that because  <code>Project ID</code> always has to be unique.
To tackle this problem we need to randomize our <code>Project ID</code>  creation within the terraform.</p>
<h4 id="153-create-a-project-using-terraform-random-provider">1.5.3 Create a Project using Terraform Random Provider<a class="headerlink" href="#153-create-a-project-using-terraform-random-provider" title="Permanent link">&para;</a></h4>
<p>In order to create a GCP Project with Random name, we can use Terraform's <a href="https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/integer">random_integer resource</a> with following arguments:</p>
<ul>
<li>max (Number) The maximum inclusive value of the range - 100</li>
<li>min (Number) The minimum inclusive value of the range - 999</li>
</ul>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; random.tf
resource &quot;random_integer&quot; &quot;id&quot; {
  min = 100
  max = 999
}
EOF
</code></pre></div>

<p><code>random_integer</code> resource doesn't belongs to Google Provider, it requires <a href="https://registry.terraform.io/providers/hashicorp/random/latest">Hashicorp Random Provider</a> to be initialized. Since it's native hashicorp provider we can skip the step of defining and configuring that provider, as it will be automatically initialized. </p>
<div class="codehilite"><pre><span></span><code>terraform init
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<ul>
<li>Installing hashicorp/random v3.1.0...</li>
<li>Installed hashicorp/random v3.1.0 (signed by HashiCorp)</li>
</ul>
</div>
<h4 id="153-create-a-project_id-name-using-local-values">1.5.3 Create a Project_ID name using Local Values<a class="headerlink" href="#153-create-a-project_id-name-using-local-values" title="Permanent link">&para;</a></h4>
<p><code>Local</code> Values allow you to assign a name to an expression, so the expression can be used multiple times, without repeating it.</p>
<p>We going to define value of <code>project_id</code> as local. And it will be a combination of <code>project_name</code> <code>-</code> <code>random_number</code>.</p>
<p>Let's add local value for <code>project_id</code> and replace value <code>var.project_id</code> with <code>local.project_id</code>.</p>
<div class="codehilite"><pre><span></span><code>edit project.tf
</code></pre></div>

<p>Remove previous code and paste new code snippet of <code>project.tf</code> as following and save:</p>
<div class="codehilite"><pre><span></span><code>locals {
  project_id     = &quot;${var.project_name}-${random_integer.id.result}&quot;
}

resource &quot;google_project&quot; &quot;project&quot; {
  name                = var.project_name
  billing_account     = var.billing_account
  project_id          = local.project_id
}
</code></pre></div>

<p>We can now remove <code>project_id</code> value from <code>terraform.tfvars</code>, as we going to randomly generate it using <code>locals</code> expression with <code>random_integer</code></p>
<div class="codehilite"><pre><span></span><code>edit terraform.tfvars
</code></pre></div>

<p>Remove <code>project_id</code> line and save.</p>
<p>We can now also remove <code>project_id</code> variable from <code>variables.tf</code>:</p>
<div class="codehilite"><pre><span></span><code>rm variables.tf
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; variables.tf
variable &quot;gcp_region&quot; {
  type        = string
  description = &quot;The GCP Region&quot;
  default     = &quot;us-central1&quot;
}

variable &quot;gcp_project_id&quot; {
  type        = string
  description = &quot;The GCP Seeding project ID&quot;
  default     = &quot;&quot;
}
variable &quot;billing_account&quot; {
  description = &quot;The billing account ID for this project&quot;
}

variable &quot;project_name&quot; {
  description = &quot;The human readable project name (min 4 letters)&quot;
}
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>  # random_integer.id will be created
  + resource &quot;random_integer&quot; &quot;id&quot; {
      + id     = (known after apply)
      + max    = 999
      + min    = 100
      + result = (known after apply)
    }
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify <code>GCP Project</code> has been created:</p>
<div class="codehilite"><pre><span></span><code>gcloud projects list | grep notepad
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>PROJECT_ID: $student-name-notepad-dev-XXX
NAME: $student-name-notepad-dev
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Project has been created with <code>Random</code> project_id. This will help to make our infrastructure creation immutable, as every time project will be created with new project_id.</p>
</div>
<h4 id="154-configure-terraform-output-for-gcp-project">1.5.4 Configure Terraform Output for GCP Project<a class="headerlink" href="#154-configure-terraform-output-for-gcp-project" title="Permanent link">&para;</a></h4>
<p><code>Outputs</code> provide return values of a Terraform state at any given time. So you can get for example values of what GCP resources like project, VMs, GKE cluster been created and their parametres.</p>
<p><code>Outputs</code> can be used used to export structured data about resources. This data can be used to configure other parts of your infrastructure, or as a data source for another Terraform workspace. Outputs are also necessary to share data from a child module to your root module.</p>
<p>Outputs follow a similar structure to variables:</p>
<div class="codehilite"><pre><span></span><code>output &quot;output_name&quot; {
  description = &quot;A description to understand what information is provided by the output&quot;
  value = &quot;An expression and/or resource_name.attribute&quot;
  sensitive = &quot;Optional argument, marking an output sensitive will supress the value from plan/apply phases&quot;
}
</code></pre></div>

<p>Let's declare GCP Project <code>output</code> values for <code>project_id</code> and <code>project_number</code>.</p>
<p>You can find available <code>output</code> in each respective <code>resource</code> documents, under `<a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#attributes-reference">Attributes Reference</a>.</p>
<p>For example for GCP project available outputs are:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; outputs.tf
output &quot;id&quot; {
  value = google_project.project.project_id
  description = &quot;GCP project ID&quot;
}

output &quot;number&quot; {
  value = google_project.project.number
  description = &quot;GCP project number&quot;
  sensitive = true
}

EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p>We can see that we have new changes to output:</p>
<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Changes to Outputs:
  + id     = &quot;ayrat-notepad-dev-631&quot;
  + number = (sensitive value)
</code></pre></div>

<p>Let's apply this changes:</p>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Apply complete! Resources: 0 added, 0 changed, 0 destroyed.
</code></pre></div>

<p>Let's now run <code>terraform output</code> command:</p>
<div class="codehilite"><pre><span></span><code>terraform output
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see value of project <code>id</code>, however we don't see project number as it's been marked as sensitive.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>Outputs</code> can be useful when you want to provide results of terraform resource creation to CI/CD or next automation tool like <code>helm</code> to deploy application.</p>
</div>
<h4 id="155-recreate-gcp-project-without-default-vpc">1.5.5 Recreate GCP Project without Default VPC<a class="headerlink" href="#155-recreate-gcp-project-without-default-vpc" title="Permanent link">&para;</a></h4>
<p>One of the requirements for our solution is to create GCP project with <code>custom</code> VPC. However, when terraform creates GCP Project it creates <code>DEFAULT</code> vpc by default.</p>
<div class="codehilite"><pre><span></span><code>NEW_PROJECT_ID=$(gcloud projects list --sort-by=projectId | grep notepad | grep PROJECT_ID |awk &#39;{ print $2}&#39;)
</code></pre></div>

<div class="codehilite"><pre><span></span><code>echo $NEW_PROJECT_ID
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gcloud compute networks list --project `$NEW_PROJECT_ID`
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME     SUBNET_MODE  BGP_ROUTING_MODE  IPV4_RANGE  GATEWAY_IPV4
default  AUTO         REGIONAL
</code></pre></div>

<p>In order to remove automatically created <code>default</code> VPC, specify special attribute during <code>google_project</code> resource creation. Check documentation <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project">here</a> and find this argument.</p>
<p>Vpc get's deleted during project creation only, so let's delete again our project and recreate it without VPC following Task N1 instructions.</p>
<div class="codehilite"><pre><span></span><code>terraform destroy -var-file terraform.tfvars
</code></pre></div>

<p><strong>Task N1:</strong> Find Attribute to remove <code>default</code> VPC during  <code>google_project</code> resource creation. Define in it <code>project.tf</code> and set it's value in <code>variables.tf</code> so that VPC will not be created by default.</p>
<div class="codehilite"><pre><span></span><code>edit project.tf
TODO
</code></pre></div>

<div class="codehilite"><pre><span></span><code>edit variables.tf
TODO
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>That way your VPC will not be created during project creation based on the plan.</p>
</div>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>How long project is now getting created. This is due to after project creation, <code>default</code> vpc is being removed as an extra step.</p>
</div>
<p>Verify that <code>default</code> VPC has been deleted:</p>
<div class="codehilite"><pre><span></span><code>NEW_PROJECT_ID=$(gcloud projects list --sort-by=projectId | grep notepad | grep PROJECT_ID |awk &#39;{ print $2}&#39;)
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gcloud compute networks list --project $NEW_PROJECT_ID
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Listed 0 items.
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should <code>0</code> VPC networks. That means GCP project has been created without any VPC.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We now able to create a GCP project without <code>Default</code> VPC.</p>
</div>
<h3 id="16-create-gcp-storage-bucket">1.6 Create GCP Storage bucket<a class="headerlink" href="#16-create-gcp-storage-bucket" title="Permanent link">&para;</a></h3>
<h4 id="161-create-gcp-storage-bucket-in-new-gcp-project">1.6.1 Create GCP Storage bucket in New GCP Project<a class="headerlink" href="#161-create-gcp-storage-bucket-in-new-gcp-project" title="Permanent link">&para;</a></h4>
<p>Using reference doc for <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket">google_storage_bucket
</a>, let's create <code>google_storage_bucket</code> resource that will create MULTI_REGIONAL GCS bucket in newly created project. We going to give bucket <code>name</code>: <code>$ORG-notepad-dev-tfstate</code>, and we going to use this bucket to store Terraform state for GCP Service Layer.</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt;  bucket.tf
resource &quot;google_storage_bucket&quot; &quot;state&quot; {
  name          = var.bucket_name
  project       = local.project_id
  storage_class = var.storage_class
  location      = var.gcp_region
  force_destroy = &quot;true&quot;
}
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; variables.tf
variable &quot;bucket_name&quot; {
  description = &quot;The name of the bucket.&quot;
}

variable &quot;storage_class&quot; {
  default = &quot;REGIONAL&quot;
}
EOF
</code></pre></div>

<p>Set variable that will be used to build name for a bucket:</p>
<div class="codehilite"><pre><span></span><code>export student_name=&lt;write_your_name_here_and_remove_brakets&gt;
</code></pre></div>

<div class="codehilite"><pre><span></span><code>export ORG=$student_name
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; terraform.tfvars
bucket_name   = &quot;$ORG-notepad-dev-tfstate&quot;
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; outputs.tf
output &quot;bucket_name&quot; {
  value = google_storage_bucket.state.name
}
EOF
</code></pre></div>

<p>Let's review the plan:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p>And create google_storage_bucket resource:</p>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify created bucket in GCP UI:</p>
<div class="codehilite"><pre><span></span><code>Storage -&gt; Cloud Storage
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gsutil ls -L -b gs://$ORG-notepad-dev-tfstate
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>GCS bucket for terraform state has been created</p>
</div>
<h4 id="162-configure-versioning-on-gcp-storage-bucket">1.6.2 Configure <code>versioning</code> on GCP Storage bucket.<a class="headerlink" href="#162-configure-versioning-on-gcp-storage-bucket" title="Permanent link">&para;</a></h4>
<p>Check if versioning enabled on the created bucket:</p>
<div class="codehilite"><pre><span></span><code>gsutil versioning get gs://$ORG-notepad-dev-tfstate
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Versioning: Suspended</p>
</div>
<p>It is highly recommended that if you going to use GCS bucket as <a href="https://www.terraform.io/docs/language/settings/backends/gcs.html">Terraform storage backend</a> you should enable Object Versioning on the GCS bucket to allow for state recovery in the case of accidental deletions and human error.</p>
<p><strong>Task N2:</strong> Using reference doc for <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket">google_storage_bucket
</a> find and configure argument that enables gcs bucket versioning feature.</p>
<p>Edit <code>bucket.tf</code> with correct argument.</p>
<div class="codehilite"><pre><span></span><code>edit bucket.tf
TODO
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Plan: 0 to add, 1 to change, 0 to destroy.
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Configuration for Versioning looks correct</p>
</div>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify versioning is ON:</p>
<div class="codehilite"><pre><span></span><code>gsutil versioning get gs://$ORG-notepad-dev-tfstate
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Versioning Enabled
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We've finished building the Foundation Layer. So far we able to accomplish following:</p>
<ul>
<li>Create structure: provider.tf, variable.tf, variables.tfvars, main.tf, output.tf</li>
<li>Create a new <code>notepad-dev</code> Project</li>
<li>Delete Default VPC</li>
<li>Create a bucket in this project to store terraform state</li>
</ul>
</div>
<h2 id="2-build-gcp-services-layer">2 Build GCP Services Layer<a class="headerlink" href="#2-build-gcp-services-layer" title="Permanent link">&para;</a></h2>
<p>Once we finished building a GCP Foundation layer which is essentially our project, we can start building  GCP Services Layer inside that project.</p>
<p>This second layer will configure following items:</p>
<ul>
<li>Enable Google Project Service APIs</li>
<li>Create VPC (google_compute_network) and Subnet (google_compute_subnetwork)</li>
</ul>
<p><img alt="alt text" src="../images/gcp_service_layer.png" title="Terraform Service Layer" /></p>
<h3 id="21-initialize-terraform-for-gcp-services-layer">2.1  Initialize Terraform for GCP Services Layer<a class="headerlink" href="#21-initialize-terraform-for-gcp-services-layer" title="Permanent link">&para;</a></h3>
<h4 id="211-define-and-configure-terraform-provider">2.1.1 Define and configure terraform provider<a class="headerlink" href="#211-define-and-configure-terraform-provider" title="Permanent link">&para;</a></h4>
<p><strong>Step 1:</strong> Take note of newly created GCP Project_ID and BUCKET_ID:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad/ycit020_module2/foundation-infrastructure
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform output | grep &#39;id&#39; |awk &#39;{ print $3}&#39;
terraform output | grep &#39;bucket_name&#39; |awk &#39;{ print $3}&#39;
</code></pre></div>

<p>Set it as variable:</p>
<div class="codehilite"><pre><span></span><code>export PROJECT_ID=$(terraform output | grep &#39;id&#39; |awk &#39;{ print $3}&#39;)
export BUCKET_ID=$(terraform output | grep &#39;bucket_name&#39; |awk &#39;{ print $3}&#39;)
echo $PROJECT_ID
echo $BUCKET_ID
</code></pre></div>

<p><strong>Step 2:</strong> Declare the Terraform Provider for GCP Services Layer:</p>
<p>We now going to switch to <code>notepad-infrastructure</code> where we going to create a new GCP service Layer terraform configuration:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad/ycit020_module2/notepad-infrastructure
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; provider.tf
terraform {
  required_providers { 
    google = {
      source  = &quot;hashicorp/google&quot;
      version = &quot;~&gt; 4.37.0&quot;
    }
  }
}
EOF
</code></pre></div>

<p><strong>Step 4:</strong> Configure the Terraform Provider</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; main.tf
provider &quot;google&quot; {
  project = var.gcp_project_id
  region  = var.gcp_region
}
EOF
</code></pre></div>

<p><strong>Step 5:</strong> Define variables:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; variables.tf
variable &quot;gcp_region&quot; {
  type        = string
  description = &quot;The GCP Region&quot;
  default     = &quot;us-central1&quot;
}

variable &quot;gcp_project_id&quot; {
  type        = string
  description = &quot;The newly created GCP project ID&quot;
}
EOF
</code></pre></div>

<p><strong>Step 5:</strong> Set variables in <code>terraform.tfvars</code></p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; terraform.tfvars
gcp_project_id = $PROJECT_ID
EOF
</code></pre></div>

<p><strong>Step 4:</strong> Now that you have declared and configured the GCP provider for terraform, initialize terraform:</p>
<div class="codehilite"><pre><span></span><code>terraform init
</code></pre></div>

<h4 id="212-configure-terraform-state-backend">2.1.2 Configure Terraform State backend<a class="headerlink" href="#212-configure-terraform-state-backend" title="Permanent link">&para;</a></h4>
<p>Terraform records information about what infrastructure it created in a Terraform state file. This information, or state, is stored by
default in a <code>local</code> file named terraform.tfstate. This allows Terraform to compare what's in your configurations with what's in
the state file, and determine what changes need to be applied.</p>
<p><strong>Local vs Remote backend:</strong>
<code>Local</code> state files are the default for terraform. <code>Remote</code> state allows for collaboration between members of your team, for example multiple users or systems can deploy terraform configuration to the same environment as state is stored remotely and can be pulled <code>localy</code> during the execution. This however may create issues if 2 users running terraform <code>plan</code> and <code>apply</code> at the same time, however some remote backends including gcs provide <code>locking</code> feature that we covered and enabled in previous section <code>Configure versioning on GCP Storage bucket.</code></p>
<p>In addition to that, <code>Remote</code> state is more secure storage of sensitive values that might be contained in variables or outputs.</p>
<p>See documents for <a href="https://www.terraform.io/docs/language/settings/backends/remote.html">remote</a> backend for reference:</p>
<p><strong>Step 1</strong> Configure remote backend using gcs bucket:</p>
<p>Let's configure a backend for your state, using the <code>gcs</code> bucket you previously created in Foundation Layer.</p>
<p>Backends are configured with a nested backend block within the top-level terraform block While a backend can be declared
anywhere, it is recommended to use a <code>backend.tf</code>.</p>
<p>Since we running on GCP we going to use <a href="https://www.terraform.io/docs/language/settings/backends/gcs.html">GCS remote backend</a>.
It stores the state as an object in a configurable prefix in a pre-existing bucket on Google Cloud Storage (GCS). This backend also supports state locking. The bucket must exist prior to configuring the backend.</p>
<p>We going to use following arguments:</p>
<ul>
<li>bucket - (Required) The name of the GCS bucket. This name must be globally unique. For more information, see Bucket Naming Guidelines.</li>
<li>prefix - (Optional) GCS prefix inside the bucket. Named states for workspaces are stored in an object called <prefix>/<name>.tfstate.</li>
</ul>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; backend.tf
terraform {
  backend &quot;gcs&quot; {
    bucket = $BUCKET_ID
    prefix = &quot;state&quot;
  }
}
EOF
</code></pre></div>

<p><strong>Step 2</strong> 
When you change, configure or unconfigure a backend, terraform must be re-initialized:</p>
<div class="codehilite"><pre><span></span><code>terraform init
</code></pre></div>

<p>Verify if <code>folder</code> state has been created in our bucket:</p>
<div class="codehilite"><pre><span></span><code>gsutil ls gs://$ORG-notepad-dev-tfstate/state
</code></pre></div>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p><code>state</code> Folder has been created in gcs bucket and terrafrom has been initialized with  <code>remote</code> backend</p>
</div>
<h3 id="22-enable-required-gcp-services-api">2.2 Enable required GCP Services API<a class="headerlink" href="#22-enable-required-gcp-services-api" title="Permanent link">&para;</a></h3>
<p>Before we continue with creating GCP services like VPC, routers, Cloud Nat and GKE it is required to enable underlining GCP API services.
When we creating a new project most of the services API's are disabled, and requires explicitly to be enabled.
<code>google_project_service</code> <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_service">resource</a> allows management of a single API service for an existing Google Cloud Platform project.</p>
<p>Let's enable <code>compute engine API</code> service with terraform:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; services.tf
resource &quot;google_project_service&quot; &quot;compute&quot; {
  service = &quot;compute.googleapis.com&quot;
  disable_on_destroy = false
}
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify Compute Engine API service has been enabled:</p>
<div class="codehilite"><pre><span></span><code> gcloud services list | grep Compute
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Compute Engine API is enabled as it is listed.</p>
</div>
<h3 id="22-set-variables-to-define-standard-for-naming-convention">2.2 Set variables to define standard for Naming Convention<a class="headerlink" href="#22-set-variables-to-define-standard-for-naming-convention" title="Permanent link">&para;</a></h3>
<p>As per terraform best practices, when you creating terraform resources, you need to follow naming convention, that is clear for you organization.</p>
<ul>
<li>Configuration objects should be named using underscores to delimit multiple words.</li>
<li>Object's name should be named using dashes</li>
</ul>
<p>This practice ensures consistency with the naming convention for resource types, data source types, and other predefined values and helps prevent accidental deletion or outages:</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code># Good
resource &quot;google_compute_instance&quot; &quot;web_server&quot; {
  name = “web-server-$org-$app-$env”
  # ...
}

# Bad
resource “google_compute_instance” “web-server” {
  name =  “web-server”
  # …
</code></pre></div>

<p>Create variables to define standard for Naming Convention:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; variables.tf
variable &quot;org&quot; {
  type = string
}
variable &quot;product&quot; {
  type = string
}
variable &quot;environment&quot; {
  type = string
}
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>export ORG=$student_name
</code></pre></div>

<div class="codehilite"><pre><span></span><code>export PRODUCT=notepad
export ENV=dev
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; terraform.tfvars
org            = &quot;$ORG&quot;
product        = &quot;$PRODUCT&quot;
environment    = &quot;$ENV&quot;
EOF
</code></pre></div>

<p>Review if created files are correct.</p>
<h3 id="23-create-a-custom-mode-network-vpc-with-terraform">2.3 Create a <code>custom mode</code> network (VPC) with terraform<a class="headerlink" href="#23-create-a-custom-mode-network-vpc-with-terraform" title="Permanent link">&para;</a></h3>
<p>Using <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_network">google_compute_network</a> resource create a VPC network with terraform.</p>
<p><strong>Task N3:</strong> Create <code>vpc.tf</code> file and define <code>custom mode</code> network (VPC) with following requirements:
  * Description: <code>VPC that will be used by the GKE private cluster on the related project</code>
  * <code>name</code> - vpc name with following pattern: "vpc-$ORG-$PRODUCT-$ENV"
  * Subnet mode: <code>custom</code>
  * Bgp routing mode: <code>regional</code>
  * MTUs: <code>default</code></p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>To create "vpc-$ORG-$PRODUCT-$ENV" name, use <a href="https://www.terraform.io/docs/language/functions/format.html">format function</a>, and use <code>%s</code> to convert variables to string values.</p>
</div>
<p>Define variables in <code>variables.tf</code> and <code>terraform.tfvars</code> if required.</p>
<p>Define <code>Output</code> for:</p>
<ul>
<li>Generated VPC name: <code>google_compute_network.vpc_network.name</code></li>
<li>self_link - The URI of the created resource.</li>
</ul>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; vpc.tf
TODO
EOF
</code></pre></div>

<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; outputs.tf
TODO
EOF
</code></pre></div>

<p>Review TF Plan:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>  + create

Terraform will perform the following actions:
  # google_compute_network.vpc_network will be created
  + resource &quot;google_compute_network&quot; &quot;vpc_network&quot; {
      + auto_create_subnetworks         = false
      + delete_default_routes_on_create = false
      + description                     = &quot;VPC that will be used by the GKE private cluster on the related project&quot;
      + gateway_ipv4                    = (known after apply)
      + id                              = (known after apply)
      + mtu                             = (known after apply)
      + name                            = &quot;vpc-ayrat-notepad-dev&quot;
      + project                         = (known after apply)
      + routing_mode                    = &quot;REGIONAL&quot;
      + self_link                       = (known after apply)
</code></pre></div>

<p>Create VPC:</p>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Verify that <code>custom-mode</code> VPC has been created:</p>
<div class="codehilite"><pre><span></span><code>gcloud compute networks list 
gcloud compute networks describe $(gcloud compute networks list | grep NAME |awk &#39;{ print $2 }&#39;)
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>autoCreateSubnetworks: false
description: VPC that will be used by the GKE private cluster on the related project
kind: compute#network
name: vpc-student_name-notepad-dev
routingConfig:
  routingMode: REGIONAL
selfLink: https://www.googleapis.com/compute/v1/projects/XXX
x_gcloud_bgp_routing_mode: REGIONAL
x_gcloud_subnet_mode: CUSTOM
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>VPC Network has been created, without auto subnets.</p>
</div>
<h2 id="5-commit-terraform-configurations-to-repository-and-share-it-with-instructorteacher">5 Commit Terraform configurations to repository and share it with Instructor/Teacher<a class="headerlink" href="#5-commit-terraform-configurations-to-repository-and-share-it-with-instructorteacher" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Commit <code>ycit020_module2</code> folder using the following Git commands:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$student_name-notepad
</code></pre></div>

<div class="codehilite"><pre><span></span><code>git add .
git commit -m &quot;TF manifests for Module 2 Assignment&quot;
</code></pre></div>

<p><strong>Step 2</strong> Push commit to the Cloud Source Repositories:</p>
<div class="codehilite"><pre><span></span><code>git push origin master
</code></pre></div>

<p><strong>Step 3</strong> This step will grant view access for Instructor to check you assignments</p>
<p>In your Cloud Terminal:</p>
<div class="codehilite"><pre><span></span><code>gcloud projects add-iam-policy-binding $PROJECT_ID --member=&#39;user:ayrat.khayretdinov@gmail.com&#39; --role=roles/viewer
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gcloud projects add-iam-policy-binding $PROJECT_ID --member=&#39;user:valavan@gmail.com&#39; --role=roles/viewer
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gcloud projects add-iam-policy-binding $PROJECT_ID --member=&#39;user:mfsilv@gmail.com&#39; --role=roles/viewer
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Your instructor will be able to review you code and grade it.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/googlecloud" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>