
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cloud-architects-program.github.io/020_Module_6_Assignment_Helm_Foundation_solution/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Assignment 6 Learning Helm - Cloud Architecture</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#assignment-6-learning-helm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cloud Architecture" class="md-header__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cloud Architecture
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Assignment 6 Learning Helm
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cloud Architecture" class="md-nav__button md-logo" aria-label="Cloud Architecture" data-md-component="logo">
      
  <img src="../images/k8s.svg" alt="logo">

    </a>
    Cloud Architecture
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Cloud-Architects-Program/assignment" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cloud Native Administrator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Cloud Native Administrator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 5 - Docker Fundamentals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Module 5 - Docker Fundamentals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../presentation5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_5_Lab_Docker_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_5_dockerbas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_5_docker_basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 6 - Advanced Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Module 6 - Advanced Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_6_Lab_Advanced_Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_6_docker_adv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 7 - Introduction to Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Module 7 - Introduction to Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_7_Lab_Deploy_Kubernetes_kubeadm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_7_introK8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Module 8 - Kuberenetes Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Module 8 - Kuberenetes Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../readingmat_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Module_8_Lab_Kubernetes_Concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assignment8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quiz_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quizzes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_mat_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary_8_k8s_concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisite" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisite
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#locate-assignment-6" class="md-nav__link">
    <span class="md-ellipsis">
      Locate Assignment 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserve-static-ip-addresses" class="md-nav__link">
    <span class="md-ellipsis">
      Reserve Static IP addresses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commit-to-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Commit to Repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-install-and-configure-helm-client" class="md-nav__link">
    <span class="md-ellipsis">
      1 Install and Configure Helm Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Install and Configure Helm Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-install-helm-3" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Install Helm 3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-deploy-gke-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Deploy GKE cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-configure-helm" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 Configure Helm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-basic-helm-chart-installation" class="md-nav__link">
    <span class="md-ellipsis">
      2 Basic Helm Chart Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Basic Helm Chart Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-searching-chart" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Searching Chart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-adding-a-chart-repository" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Adding a Chart Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-helm-chart-installation" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Helm Chart Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-advanced-helm-chart-installation" class="md-nav__link">
    <span class="md-ellipsis">
      3 Advanced Helm Chart Installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 Advanced Helm Chart Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-deploy-nginx-ingress-chart-with-custom-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Deploy NGINX Ingress Chart with Custom Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-download-and-inspect-chart-locally" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 Download and inspect Chart locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-helm-template" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 Helm Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-dry-runs" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 Dry-Runs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-deploy-drupal-using-nginx-ingress-controller" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 Deploy Drupal using Nginx Ingress Controller
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-optional-using-set-values-and-upgrading-charts" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 (Optional) Using --set values and Upgrading Charts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-optional-listing-releases-history-rollbacks" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 (Optional) Listing Releases, History, Rollbacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38-optional-upgrade-release-with-helm-diff-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 (Optional) Upgrade Release with Helm Diff Plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-add-results-to-repository" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 Add results to repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-notepad-helm-charts" class="md-nav__link">
    <span class="md-ellipsis">
      4 Creating NotePad Helm Charts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 Creating NotePad Helm Charts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-design-gowebapp-mysql-chart" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Design gowebapp-mysql chart
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 Design gowebapp-mysql chart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-create-gowebapp-mysql-chart" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.1 Create gowebapp-mysql chart
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-add-results-to-repository" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.2 Add results to repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-design-gowebapp-chart" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Design gowebapp chart.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Design gowebapp chart.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-create-gowebapp-chart" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 Create gowebapp chart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-template-the-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 Template the Deployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-template-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 Template the Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-disable-the-service-account" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 Disable the Service account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425-template-the-ingress-resource" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.5 Template the Ingress Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#426-templatize-the-configmap-resource" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.6 Templatize the ConfigMap Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#427-deploy-gowebapp" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.7 Deploy gowebapp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#428-add-results-to-repository" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.8 Add results to repository
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-submit-assignement" class="md-nav__link">
    <span class="md-ellipsis">
      5 Submit assignement
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="assignment-6-learning-helm">Assignment 6 Learning Helm<a class="headerlink" href="#assignment-6-learning-helm" title="Permanent link">&para;</a></h1>
<p><strong>Objective:</strong></p>
<ul>
<li>Installing and Configuring the Helm Client</li>
<li>Deploy Kubernetes apps with Helm Charts</li>
<li>Learn Helm Commands</li>
<li>Learn Helm Repository</li>
<li>Create Helm chart</li>
<li>Learn Helm Plugins</li>
<li>Learn Helm File</li>
</ul>
<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">&para;</a></h2>
<p>Enable the needed services in the project</p>
<div class="codehilite"><pre><span></span><code>export PROJECT_ID=&lt;YOUR_PROJECT_ID&gt;
gcloud config set project $PROJECT_ID
gcloud services enable compute.googleapis.com cloudresourcemanager.googleapis.com container.googleapis.com servicenetworking.googleapis.com
</code></pre></div>

<h3 id="locate-assignment-6">Locate Assignment 6<a class="headerlink" href="#locate-assignment-6" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong>  Clone <code>ycit020_2022</code> repo with Kubernetes manifests, which going to use for our work:</p>
<div class="codehilite"><pre><span></span><code>cd ~/ycit020_2022
# Alternatively: cd ~ &amp; git clone https://github.com/Cloud-Architects-Program/ycit020_2022.git
git pull
cd ~/ycit020_2022/assignment6_helm/
ls
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>You can see Kubernetes manifests and terraform configs</p>
</div>
<p><strong>Step 2</strong> Go into your personal Google Cloud Source Repository:</p>
<div class="codehilite"><pre><span></span><code>MY_REPO=your_student_id-notepad
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Replace $student_id with your ID</p>
</div>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO
</code></pre></div>

<p>Pull latest changes:</p>
<div class="codehilite"><pre><span></span><code>git pull                              # Pull latest code from you repo
</code></pre></div>

<p><strong>Step 3 (Optional)</strong> If your terraform config from previous assignment is not working you can copy working config from <code>assignment6_helm</code> folder
to your <code>notepad-infrastructure</code> folder.</p>
<p><strong>Step 4</strong> Create exercise 1 folder for supporting applications</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO
mkdir -p exercises/exercise1

cat &lt;&lt;EOF&gt; exercises/exercise1/README.md
# Setting up the infraestructure with Terraform
EOF
</code></pre></div>

<p><strong>Step 5</strong> Copy Assignment 4 <code>deploy</code> folder to your repo:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/
cp -r ~/ycit020_2022/assignment6_helm/deploy deploy
ls deploy
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>You should see <code>k8s-manifest</code> folder</p>
</div>
<h3 id="reserve-static-ip-addresses">Reserve Static IP addresses<a class="headerlink" href="#reserve-static-ip-addresses" title="Permanent link">&para;</a></h3>
<p>In the next few assignments we might deploy many applications and so we will require expose them using Ingress.</p>
<p>When you create an Ingress object, you get a stable external IP address that clients can use to access your Services and in turn, your running containers. The IP address is stable in the sense that it lasts for the lifetime of the Ingress object. If you delete your Ingress and create a new Ingress from the same manifest file, you are not guaranteed to get the same external IP address.</p>
<p>For this application, we would like to have a permanent IP address that can persist even if the Ingress resource is recreated.</p>
<p>For that you must reserve a <code>Regional</code> static <code>External</code> IP address and provide it teacher, so we can setup <code>A Record</code> on the DNS for your behalf.</p>
<p>Reference: </p>
<ol>
<li><a href="https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address">Reserving a static external IP address</a></li>
<li>Terraform resource <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_address">google_compute_address</a></li>
</ol>
<p><strong>Step 1:</strong> Create folder for static ip terraform configuration:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/
mkdir ip-infrastructure
</code></pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The reason we creating a new folder for static_ip creation is because we don't want to destroy or delete this IP throughout our training.</p>
</div>
<p><strong>Step 1:</strong> Create Terraform configuration:</p>
<p>Declare Provider:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/ip-infrastructure
cat &lt;&lt; EOF&gt;&gt; provider.tf
terraform {
  required_providers {
    google = {
      source  = &quot;hashicorp/google&quot;
      version = &quot;~&gt; 3.70.0&quot;
    }
  }
}
EOF
</code></pre></div>

<p>Configure global address resource:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; static_ip.tf
provider &quot;google&quot; {
  project = var.gcp_project_id
}

resource &quot;google_compute_address&quot; &quot;regional_external_ip&quot; {
  provider      = google
  name          = &quot;static-ingres-ip&quot;
  address_type  = &quot;EXTERNAL&quot;
  region        = &quot;us-central1&quot;
}
EOF
</code></pre></div>

<p>Configure variables:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; variables.tf
variable &quot;gcp_project_id&quot; {
  type        = string
  description = &quot;The GCP Seeding project ID&quot;
  default     = &quot;&quot;
}
EOF
</code></pre></div>

<p><strong>Task:</strong> Create a <code>.tfvars</code> file with your project_id:</p>
<div class="codehilite"><pre><span></span><code>gcp_project_id = &quot;$PROJECT_ID&quot;
</code></pre></div>

<p>Configure outputs:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF &gt;&gt; outputs.tf
output &quot;addresses&quot; {
  description = &quot;Global IPv4 address for proxy load balancing to the nearest Ingress controller&quot;
  value       = google_compute_address.regional_external_ip.address
}

output &quot;name&quot; {
  description = &quot;Static IP Name&quot;
  value       = google_compute_address.regional_external_ip.name
}
EOF
</code></pre></div>

<p><strong>Step 2:</strong> Apply Terraform configuration:</p>
<p>Initialize:</p>
<div class="codehilite"><pre><span></span><code>terraform init
</code></pre></div>

<p>Plan and Deploy Infrastructure:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<div class="admonition result you should see">
<p class="admonition-title">Result</p>
<p><strong>Plan: 1 to add, 0 to change, 0 to destroy.</strong><br />
<br />
Changes to Outputs:<br />
&emsp;   + addresses = (known after apply)<br />
&emsp;   + name      = "static-ingres-ip"</p>
</div>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<p>Set variable:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/ip-infrastructure
export STATIC_IP_ADDRESS=$(terraform output -raw addresses )
export STATIC_IP_NAME=$(terraform output -raw name )
</code></pre></div>

<p>Create readme:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt;EOF&gt; README.md

Generated Static IP for Ingress:

    * Name - $STATIC_IP_NAME # Used Ingress Manifest
    * Address - $STATIC_IP_ADDRESS # Used to Configure DNS A Record
EOF

cp README.md ~/$MY_REPO/exercises/exercise1
</code></pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Add information about your static_ip_address the tab "Assignment 6" in column C under your name in this spreadsheet:
<a href="https://docs.google.com/spreadsheets/d/1YR72Kk5Eo3KLpf1PigZ4CBC16SRrFoV0gnvkbpc0Xlg/edit#gid=1165180425">2022 YCIT020 Student Project Info</a></p>
</div>
<h3 id="commit-to-repository">Commit to Repository<a class="headerlink" href="#commit-to-repository" title="Permanent link">&para;</a></h3>
<p><strong>Step 1</strong> Commit <code>ip-infrastructure</code> and <code>helm</code> folders using the following Git commands:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO
git status
git add .
git commit -m &quot;adding documentation for ycit020 assignment 6&quot;
</code></pre></div>

<p><strong>Step 2</strong> Once you've committed code to the local repository, add its contents to Cloud Source Repositories using the git push command:</p>
<div class="codehilite"><pre><span></span><code>git push origin master
</code></pre></div>

<h2 id="1-install-and-configure-helm-client">1 Install and Configure Helm Client<a class="headerlink" href="#1-install-and-configure-helm-client" title="Permanent link">&para;</a></h2>
<h3 id="11-install-helm-3">1.1 Install Helm 3<a class="headerlink" href="#11-install-helm-3" title="Permanent link">&para;</a></h3>
<p>GCP Cloud Shell comes with many common tools pre-installed including <code>helm</code>.</p>
<p><strong>Step 1:</strong> Verify and validate the version of <code>Helm</code> that is installed:</p>
<div class="codehilite"><pre><span></span><code>helm version
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>version.BuildInfo{Version:&quot;v3.9.3&quot;, GitCommit:&quot;414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.13&quot;}
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Helm 3 is installed</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until November 2020, two different major versions of Helm were actively maintained. The current stable major version of Helm is version 3. </p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Helm follows a versioning convention known as <a href="https://semver.org/">Semantic Versioning</a> (SemVer). In Semantic Versioning, the version number conveys meaning about what you can expect in the release. Because Helm follows this specification, users can expect certain things out of releases simply by carefully reading the version number. At its core, a semantic version has three numerical components and an optional stability marker (for alphas, betas, and release candidates). Here are some examples:</p>
<ul>
<li>v1.0.0</li>
<li>v3.3.2</li>
</ul>
<p>SemVer represents format of  <code>X.Y.Z</code>, where <code>X</code> is a major version, <code>Y</code> is a minor version and <code>Z</code> is a patch release:</p>
<ul>
<li>
<p>The major release number tends to be incremented infrequently. It indicates that major changes have been made to Helm, and that some of those changes may break compatibility with previous versions. The difference between Helm 2 and Helm 3 is substantial, and there is work necessary to migrate between the versions.</p>
</li>
<li>
<p>The minor release number indicates feature additions. The difference between 3.2.0 and 3.3.0 might be that a few small new features were added. However, there are no breaking changes between versions. (With one caveat: a security fix might necessitate a breaking change, but we announce boldly when that is the case.)</p>
</li>
<li>
<p>The patch release number indicates that only backward compatible bug fixes have been made between this release and the last one. It is always recommended to stay at the latest patch release.</p>
</li>
</ul>
</div>
<p><strong>(OPTIONAL) Step 2:</strong> If you want to use specific version of <code>helm</code> or want to install <code>helm</code> in you local machine (On macOS and Linux,) use following <a href="https://helm.sh/docs/intro/install/#from-script">link</a> to install Helm. </p>
<p>The usual sequence of commands for installing this way is as follows:</p>
<div class="codehilite"><pre><span></span><code>$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
$ chmod +x get_helm.sh
$ ./get_helm.sh
</code></pre></div>

<p>The preceding commands fetch the latest version of the <code>get_helm.sh</code> script, and then uses that to find and install the latest version of Helm 3.</p>
<p>Alternatively, you can download latest binary of your choice <a href="https://github.com/helm/helm/releases">here</a>.</p>
<h3 id="13-deploy-gke-cluster">1.3 Deploy GKE cluster<a class="headerlink" href="#13-deploy-gke-cluster" title="Permanent link">&para;</a></h3>
<p>We going to reuse Terraform configuration to deploy our GKE Cluster. And we assume that <code>terraform.tfvars</code> has been properly configured already with required values.</p>
<p><strong>Step 1:</strong> Locate Terraform Configuration directory.</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/notepad-infrastructure
</code></pre></div>

<p><strong>Step 2:</strong> Modify your backend</p>
<p>In case you are not using the output of the previous assignment, create a bucket to host your terraform state</p>
<div class="codehilite"><pre><span></span><code>gsutil mb gs://&lt;STUDENT_NAME&gt;-notepad-dev-tfstate
</code></pre></div>

<p><strong>Task:</strong> Modify the <code>backend.tf</code> file to point to your newly created bucket</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>Your backend.tf file should look similar to:</p>
<div class="codehilite"><pre><span></span><code>    terraform {
        backend &quot;gcs&quot; {
        bucket = &quot;&lt;STUDENT_NAME&gt;-notepad-dev-tfstate&quot;
        prefix = &quot;state&quot;
    }
}
</code></pre></div>

</div>
<p><strong>Step 3:</strong> Initialize Terraform Providers</p>
<div class="codehilite"><pre><span></span><code>terraform init
</code></pre></div>

<p><strong>Step 4:</strong>  Increase GKE Node Pool VM size</p>
<p>Modify the <code>terraform.tfvars</code></p>
<div class="codehilite"><pre><span></span><code>edit terraform.tfvars
</code></pre></div>

<p>Update <code>gke_pool_machine_type</code> from <code>e2-small</code> to <code>e2-highcpu-4</code>, to support larger workloads.
Also make sure to update the <code>gcp_project_id</code> and <code>org</code> if you are starting from the posted solution.</p>
<p><strong>Step 5:</strong> Review TF Plan:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p><strong>Step 6:</strong> Create GKE Cluster and Node Pool:</p>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>GKE Clusters has been created</p>
</div>
<h3 id="14-configure-helm">1.4 Configure Helm<a class="headerlink" href="#14-configure-helm" title="Permanent link">&para;</a></h3>
<p>Helm interacts directly with the Kubernetes API server. For that reason, Helm needs to be able to connect to a Kubernetes cluster. Helm attempts to do this automatically by reading the same configuration files used by <code>kubectl</code>.</p>
<p>Helm will try to find this information by reading the environment variable <code>$KUBECONFIG</code>.</p>
<p><strong>Step 1</strong> Authenticate to the cluster.</p>
<div class="codehilite"><pre><span></span><code>export STUDENT_NAME=&lt;STUDENT_NAME&gt;
gcloud container clusters get-credentials gke-$STUDENT_NAME-notepad-dev --region us-central1 
</code></pre></div>

<p><strong>Step 2</strong> Test that <code>kubectl</code> client connected to GKE cluster:</p>
<div class="codehilite"><pre><span></span><code>kubectl get pods
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>No resources found in default namespace.
</code></pre></div>

<p><strong>Step 3</strong> Test that helm client connected to GKE cluster:</p>
<div class="codehilite"><pre><span></span><code>helm list
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME    NAMESPACE       REVISION        UPDATED STATUS  CHART   APP VERSION
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>As expected there are no Charts has been Installed on our cluster yet</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>Helm 3 has been installed and configured to work with our cluster. Let's deploy some charts!</p>
</div>
<h2 id="2-basic-helm-chart-installation">2 Basic Helm Chart Installation<a class="headerlink" href="#2-basic-helm-chart-installation" title="Permanent link">&para;</a></h2>
<h3 id="21-searching-chart">2.1 Searching Chart<a class="headerlink" href="#21-searching-chart" title="Permanent link">&para;</a></h3>
<p>A Helm chart is a packaged application that can be installed into your Kubernetes cluster. During chart development, you will often just work with a chart that is stored on your local system and later pushed to GitHub.</p>
<p>But when it comes to sharing charts, Helm describes a standard format for indexing and sharing information about Helm <code>charts</code>. A Helm chart <code>repository</code> is simply a set of files, reachable over the network, that conforms to the Helm specification for indexing packages.</p>
<p>There are huge number of chart repositories on the internet. The easiest way to find the popular repositories is to use your web browser to navigate to the <a href="https://artifacthub.io/">Artifact Hub</a>. There you will find thousands of Helm charts, each hosted on an appropriate repository.</p>
<div class="admonition deprecation">
<p class="admonition-title">Deprecation</p>
<p>In the past all charts were located and maintained by Helm Kubernetes Community Git repositories,
known as https://github.com/kubernetes/charts, and had 2 types:</p>
<ul>
<li><a href="https://github.com/kubernetes/charts/tree/master/incubator">Stable</a></li>
<li><a href="https://github.com/kubernetes/charts/tree/master/incubator">Incubator</a></li>
</ul>
<p>All the charts were rendered in Web UI via <a href="https://hub.helm.sh">Helm Hub</a> page.</p>
<p>While the central Git Repository to maintain charts was great idea, with fast growing Helm popularity, it become hard to impossible to manage and maintain it by small group of maintainers, as they had to aprove hundreds of PR per day and frustrating for chart contributors as they had to wait several weeks their PR to be reviewed and approved.</p>
<p>As a result GitHub project for Helm <code>stable</code> and <code>incubator</code> charts as well as [Helm Hub] has been deprecated and archived.
All the charts are now maintained by independent contributors in their subsequent repo's. (e.g vault, is under hashicorp/vault-helm repo)
and the central place to find all active and official Charts can be foind in <a href="https://artifacthub.io/">Artifact Hub</a>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Helm 2 came with a Helm repository installed by default. The <code>stable</code> chart repository was at one time the official source of production-ready Helm charts.
As we discussed above  <code>stable</code> chart repository has been now deprecated.</p>
<p>In Helm 3, there is no <code>default</code> repository. Users are encouraged to use the Artifact Hub to find what they are looking for and then add their preferred repositories.</p>
</div>
<p><strong>Step 0:</strong> Setup exercise folder</p>
<div class="codehilite"><pre><span></span><code>mkdir -p ~/$MY_REPO/exercises/exercise2
cd ~/$MY_REPO/exercises/exercise2

cat &lt;&lt;EOF&gt; exercises/exercise1/README.md
# Helm search and Install exercise
EOF
</code></pre></div>

<p><strong>Step 1:</strong> Helm provides native way to search charts from CLI in <a href="https://artifacthub.io/">artifacthub.io</a></p>
<p>Search for drupal chart:</p>
<div class="codehilite"><pre><span></span><code>helm search hub drupal
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>https://artifacthub.io/packages/helm/bitnami/drupal 10.2.30         9.2.3       One of the most versatile open source content m...
https://artifacthub.io/packages/helm/cetic/drupal   0.1.0           1.16.0      Drupal is a free and open-source web content ma..
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Search is a good way to find existing Helm packages</p>
</div>
<p><strong>Step 2:</strong> Use the link to navigate to Artifact Hub Drupal chart:</p>
<div class="codehilite"><pre><span></span><code>https://artifacthub.io/packages/helm/bitnami/drupal
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Drupal is OSS content management systems that can be installed on k8s.</p>
</div>
<p><strong>Result:</strong> The Artifact Page opened with information about the chart, it's parameters and how to use the chart.</p>
<p><strong>Step 3:</strong> Review Github source Code of the chart:</p>
<div class="codehilite"><pre><span></span><code>https://github.com/bitnami/charts/tree/master/bitnami/drupal
</code></pre></div>

<p><strong>Result:</strong> Github page with Drupal Helm Chart itself, where you can browse the <code>templates</code>, <code>values.yaml</code>, <code>Chart.yaml</code> to
understand how this chart is actually working and if you have any issues with the chart this would be the right location to open the issue
or send a PR with new feature if you decide to contribute.</p>
<h3 id="22-adding-a-chart-repository">2.2 Adding a Chart Repository<a class="headerlink" href="#22-adding-a-chart-repository" title="Permanent link">&para;</a></h3>
<p>Once you found a chart, it's logical to install it. However first step you need to do is to add a Chart Repository.</p>
<p><strong>Step 1:</strong> Adding a Helm chart is done with the <code>helm repo add</code> command:</p>
<div class="codehilite"><pre><span></span><code>helm repo add bitnami https://charts.bitnami.com/bitnami
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a href="https://bitnami.com/">Bitnami</a> is company well known to package application for Any Platforms and Cloud environments. With popularity of Helm, Bitnami developers were among the core contributors who designed the Helm repository system. They have contributed to the establishment of Helm’s best practices for chart development and have written many of the most widely used charts. Bitnami is now part of VMware, provides IT organizations with an enterprise offering that is secure, compliant, continuously maintained and customizable to your organizational policies.</p>
</div>
<p><strong>Step 2:</strong> Now, we can verify that the Bitnami repository exists by running a <code>helm repo list</code> command:</p>
<div class="codehilite"><pre><span></span><code>helm repo list
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME    URL                               
bitnami https://charts.bitnami.com/bitnami
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>This command shows us all of the repositories installed for Helm. Right now, we see only the Bitnami repository that we just added.</p>
</div>
<h3 id="23-helm-chart-installation">2.3 Helm Chart Installation<a class="headerlink" href="#23-helm-chart-installation" title="Permanent link">&para;</a></h3>
<p><strong>Step 1:</strong> At very minimum, installing a chart in Helm requires just 2 pieces of information: the <code>name</code> of the installation and the <code>chart</code> you want to install:</p>
<div class="codehilite"><pre><span></span><code>helm install mywebsite bitnami/drupal
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME: mywebsite
LAST DEPLOYED: Sun Aug  8 08:25:29 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
*******************************************************************
*** PLEASE BE PATIENT: Drupal may take a few minutes to install ***
*******************************************************************

1. Get the Drupal URL:

  NOTE: It may take a few minutes for the LoadBalancer IP to be available.
        Watch the status with: &#39;kubectl get svc --namespace default -w mywebsite-drupal&#39;

  export SERVICE_IP=$(kubectl get svc --namespace default mywebsite-drupal --template &quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;)
  echo &quot;Drupal URL: http://$SERVICE_IP/&quot;

2. Get your Drupal login credentials by running:

  echo Username: user
  echo Password: $(kubectl get secret --namespace default mywebsite-drupal -o jsonpath=&quot;{.data.drupal-password}&quot; | base64 --decode)
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>When using Helm, you will see that output for each installation. A good chart would provide helpful <code>notes</code> on how to connect to the deployed solution.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can get <code>notes</code> information any time after helm installation using <code>helm get notes mywebsite</code> command.</p>
</div>
<p><strong>Step 2:</strong> Follow your Drupal Helm Chart <code>notes</code> Instruction to access Website</p>
<div class="codehilite"><pre><span></span><code>1. Get the Drupal URL:

  NOTE: It may take a few minutes for the LoadBalancer IP to be available.
        Watch the status with: &#39;kubectl get svc --namespace test -w mywebsite-drupal&#39;

  export SERVICE_IP=$(kubectl get svc --namespace test mywebsite-drupal --template &quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;)
  echo &quot;Drupal URL: http://$SERVICE_IP/&quot;
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We can access <code>My blog</code> website and login with provider user and password.
You can start your own blog now, that runs on Kubernetes</p>
</div>
<p><strong>Step 3:</strong> List deployed Kubernetes resources:</p>
<div class="codehilite"><pre><span></span><code>kubectl get all 
kubectl get pvc
</code></pre></div>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>Our Drupal website consist of MariaDB <code>statefulset</code>, Drupal <code>deployment</code>, 2 <code>pvc</code>s and 
<code>services</code>. <code>Mywebsite</code> Drupal service is type <code>LoadBalancer</code> and that's how we able to access it.</p>
</div>
<p><strong>Step 4:</strong> List installed chart:</p>
<div class="codehilite"><pre><span></span><code>helm list
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
mywebsite       default         1               2021-08-08 08:25:29.625862 -0400 EDT    deployed        drupal-10.2.30          9.2.3
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like other commands, helm list is <code>namespace</code> aware. By default, Helm uses the <code>namespace</code> your Kubernetes configuration file sets as the default. Usually this is the namespace named <code>default</code>.</p>
</div>
<p><strong>Step 5:</strong> Deploy same chart in namespace <code>test</code>: </p>
<div class="codehilite"><pre><span></span><code>kubectl create ns test
helm install --namespace test mywebsite bitnami/drupal --create-namespace
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>By adding <code>--create-namespace</code>, indicates to Helm that we acknowledge that there may not be a namespace with that name already, and we just want one to be created.</p>
</div>
<p>List deployed chart in namespace <code>test</code>: </p>
<div class="codehilite"><pre><span></span><code>helm list --namespace test
</code></pre></div>

<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>In Helm 2, instance names were cluster-wide. You could only have an instance named <code>mywebsite</code> once per cluster. </p>
<p>In Helm 3, naming has been changed. Now instance names are scoped to Kubernetes namespaces. We could install 2 instances named <code>mywebsite</code> as long as they each lived in a different namespace.</p>
</div>
<p><strong>Step 5:</strong> Submit the output into the assignments folder</p>
<p>Commit the results to the repository:</p>
<div class="codehilite"><pre><span></span><code># make sure you are in exercise2 folder
kubectl describe pods &gt; k8s_pods_$STUDENT_NAME_default.txt
kubectl describe pods -n test &gt; k8s_pods_$STUDENT_NAME_test.txt
kubectl get all -A &gt; k8s_resources_$STUDENT_NAME.txt

git add .
git commit -m &quot;helm search and install exercise&quot;
git push 
</code></pre></div>

<p><strong>Step 6:</strong> Cleanup Helm Drupal deployments using <code>helm uninstall</code> command:</p>
<p>Uninstall the charts</p>
<div class="codehilite"><pre><span></span><code>helm uninstall mywebsite
helm uninstall mywebsite -n test 
</code></pre></div>

<p>Remove the test namespace</p>
<div class="codehilite"><pre><span></span><code>kubectl delete ns test
</code></pre></div>

<h2 id="3-advanced-helm-chart-installation">3 Advanced Helm Chart Installation<a class="headerlink" href="#3-advanced-helm-chart-installation" title="Permanent link">&para;</a></h2>
<h3 id="31-deploy-nginx-ingress-chart-with-custom-configuration">3.1 Deploy NGINX Ingress Chart with Custom Configuration<a class="headerlink" href="#31-deploy-nginx-ingress-chart-with-custom-configuration" title="Permanent link">&para;</a></h3>
<p>Let's deploy another Helm application on our Kubernetes cluster: <a href="https://kubernetes.github.io/ingress-nginx/">Ingress Nginx</a> - is an Ingress controller for Kubernetes using NGINX as a
reverse proxy and load balancer.</p>
<p>In the previous classes we used Google implementation of Ingress - <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/ingress">GKE Ingress for HTTP(S) Load Balancing</a>.
While this solutions provides managed Ingress experience and advanced features like Cloud Armor, DDoS protection and Identity aware proxy.</p>
<p>Ingress Nginx Controller is popular solution and has a lot of features and integrations. If you want to deploy Kubernetes Application on different cloud providers or
On-prem the same way, Nginx Ingress Controller becomes a default option.</p>
<p>Our task is to configure Ingress Nginx using <code>type:LoadBalancer</code> with Regional Static IP configured in the section <a href="#reserve-static-ip-addresses">### Reserve Static IP addresses</a>.
Additionally we want to <strong>enable metrics</strong> service that will fetch Prometheus monitoring metrics from ingress and <strong>disable admissionWebhooks</strong> configuration.</p>
<p><strong>Step 0:</strong> Setup exercise folder</p>
<div class="codehilite"><pre><span></span><code>mkdir -p ~/$MY_REPO/exercises/exercise3
cd ~/$MY_REPO/exercises/exercise3

cat &lt;&lt;EOF&gt; exercises/exercise3/README.md
# Advanced Helm Chart Installation
EOF
</code></pre></div>

<p><strong>Step 1:</strong> Let's search <code>ingress-nginx</code> in <a href="https://artifacthub.io/">artifacthub.io</a></p>
<div class="codehilite"><pre><span></span><code>helm search hub ingress-nginx
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>URL                                                     CHART VERSION   APP VERSION     DESCRIPTION                                       
https://artifacthub.io/packages/helm/ingress-ng...      4.3.0           1.4.0           Ingress controller for Kubernetes using NGINX a...
https://artifacthub.io/packages/helm/ingress-ng...      4.1.0           1.2.0           Ingress controller for Kubernetes using NGINX a...
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We going to select the first <code>ingress-nginx</code> chart that is maintained by Kubernetes Community</p>
</div>
<p><strong>Step 2:</strong> Review Hub Page details about this chart and locate information how to add repository:</p>
<div class="codehilite"><pre><span></span><code>https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx
</code></pre></div>

<p><strong>Result:</strong> The Artifact Page opened with information about the chart, it's parameters, and how to use the chart itself</p>
<p><strong>Step 3:</strong> Add <code>ingress-nginx</code>  Repo:</p>
<div class="codehilite"><pre><span></span><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update  
</code></pre></div>

<p><strong>Step 4:</strong> Oftentimes, searching is a useful way to find not only what <code>charts</code> can be installed, but what <code>versions</code> are available:</p>
<div class="codehilite"><pre><span></span><code>helm search repo ingress-nginx --versions | head
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME                            CHART VERSION   APP VERSION     DESCRIPTION                                       
ingress-nginx/ingress-nginx     4.3.0           1.4.0           Ingress controller for Kubernetes using NGINX a...
ingress-nginx/ingress-nginx     4.2.5           1.3.1           Ingress controller for Kubernetes using NGINX a...
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, Helm tries to install the latest <code>stable</code> release of a chart, but you can override this behavior and install a specific version of a chart. Thus it is often useful to see not just the summary info for a chart, but exactly which versions exist for a chart. Every new version of the chart can be bring fixes and new changes, so for production use it's better to go with tested version and pin installation version.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>We going with latest listed official version of the chart <code>4.3.0</code> of <code>ingress-nginx</code> Chart.</p>
</div>
<h3 id="32-download-and-inspect-chart-locally">3.2 Download and inspect Chart locally<a class="headerlink" href="#32-download-and-inspect-chart-locally" title="Permanent link">&para;</a></h3>
<p><strong>Step 1:</strong> Pull <code>ingress-nginx</code> Helm Chart of specific version to Local filesystem:</p>
<div class="codehilite"><pre><span></span><code># ensure you are in exercise3 folder
helm pull ingress-nginx/ingress-nginx --version 4.3.0
tar -xvzf  ingress-nginx-4.3.0.tgz
</code></pre></div>

<p><strong>Step 2:</strong>  See the tree structure of the chart</p>
<div class="codehilite"><pre><span></span><code>sudo apt-get install tree
tree -L 2 ingress-nginx
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>ingress-nginx
├── CHANGELOG.md
├── Chart.yaml
├── ci
│   ├── controller-custom-ingressclass-flags.yaml
│   ├── daemonset-customconfig-values.yaml
│   ├── daemonset-customnodeport-values.yaml
│   ├── daemonset-extra-modules.yaml
│   ├── daemonset-headers-values.yaml
│   ├── daemonset-internal-lb-values.yaml
│   ├── daemonset-nodeport-values.yaml
│   ├── daemonset-podannotations-values.yaml
│   ├── daemonset-tcp-udp-configMapNamespace-values.yaml
│   ├── daemonset-tcp-udp-portNamePrefix-values.yaml
│   ├── daemonset-tcp-udp-values.yaml
│   ├── daemonset-tcp-values.yaml
│   ├── deamonset-default-values.yaml
│   ├── deamonset-metrics-values.yaml
│   ├── deamonset-psp-values.yaml
│   ├── deamonset-webhook-and-psp-values.yaml
│   ├── deamonset-webhook-values.yaml
│   ├── deployment-autoscaling-behavior-values.yaml
│   ├── deployment-autoscaling-values.yaml
│   ├── deployment-customconfig-values.yaml
│   ├── deployment-customnodeport-values.yaml
│   ├── deployment-default-values.yaml
│   ├── deployment-extra-modules.yaml
│   ├── deployment-headers-values.yaml
│   ├── deployment-internal-lb-values.yaml
│   ├── deployment-metrics-values.yaml
│   ├── deployment-nodeport-values.yaml
│   ├── deployment-podannotations-values.yaml
│   ├── deployment-psp-values.yaml
│   ├── deployment-tcp-udp-configMapNamespace-values.yaml
│   ├── deployment-tcp-udp-portNamePrefix-values.yaml
│   ├── deployment-tcp-udp-values.yaml
│   ├── deployment-tcp-values.yaml
│   ├── deployment-webhook-and-psp-values.yaml
│   ├── deployment-webhook-extraEnvs-values.yaml
│   ├── deployment-webhook-resources-values.yaml
│   └── deployment-webhook-values.yaml
├── OWNERS
├── README.md
├── README.md.gotmpl
├── templates
│   ├── admission-webhooks
│   ├── clusterrolebinding.yaml
│   ├── clusterrole.yaml
│   ├── controller-configmap-addheaders.yaml
│   ├── controller-configmap-proxyheaders.yaml
│   ├── controller-configmap-tcp.yaml
│   ├── controller-configmap-udp.yaml
│   ├── controller-configmap.yaml
│   ├── controller-daemonset.yaml
│   ├── controller-deployment.yaml
│   ├── controller-hpa.yaml
│   ├── controller-ingressclass.yaml
│   ├── controller-keda.yaml
│   ├── controller-poddisruptionbudget.yaml
│   ├── controller-prometheusrules.yaml
│   ├── controller-psp.yaml
│   ├── controller-rolebinding.yaml
│   ├── controller-role.yaml
│   ├── controller-serviceaccount.yaml
│   ├── controller-service-internal.yaml
│   ├── controller-service-metrics.yaml
│   ├── controller-servicemonitor.yaml
│   ├── controller-service-webhook.yaml
│   ├── controller-service.yaml
│   ├── controller-wehbooks-networkpolicy.yaml
│   ├── default-backend-deployment.yaml
│   ├── default-backend-hpa.yaml
│   ├── default-backend-poddisruptionbudget.yaml
│   ├── default-backend-psp.yaml
│   ├── default-backend-rolebinding.yaml
│   ├── default-backend-role.yaml
│   ├── default-backend-serviceaccount.yaml
│   ├── default-backend-service.yaml
│   ├── dh-param-secret.yaml
│   ├── _helpers.tpl
│   ├── NOTES.txt
│   └── _params.tpl
└── values.yaml
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Typical structure of the helm chart, where:</p>
<ul>
<li>The <code>Chart.yaml</code> file contains metadata and some functionality controls for the chart</li>
<li><code>templates</code> folder contains all <code>yaml</code> manifests in <a href="https://pkg.go.dev/text/template">Go templates</a> and used to generate Kubernetes manifests</li>
<li><code>values.yaml</code> contains <code>default</code> values applied during the rendering.</li>
<li>The <code>NOTES.txt</code> file is a special template. When a chart is installed, the NOTES.txt template is rendered and displayed rather than being installed into a cluster.</li>
</ul>
</div>
<h3 id="33-helm-template">3.3 Helm Template<a class="headerlink" href="#33-helm-template" title="Permanent link">&para;</a></h3>
<p>As a reminder our goal it customize Nginx deployment to configure Ingress Nginx using <code>type:LoadBalancer</code> with Regional Static IP configured in the section <a href="#reserve-static-ip-addresses">### Reserve Static IP addresses</a>.
Additionally we want to <strong>enable metrics</strong> service that will fetch Prometheus monitoring metrics from ingress and <strong>disable admissionWebhooks</strong> configuration.</p>
<p><strong>Step 1:</strong> Review <code>values.yaml</code></p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3/ingress-nginx
edit values.yaml
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>It is pretty confusing at this point to understand what this chart is going to deploy,
it would of been great to render to YAML format first.</p>
</div>
<p><strong>Step 2:</strong> Execute <code>helm template</code> command and store output in <code>render1.yaml</code></p>
<div class="codehilite"><pre><span></span><code>helm template ingress-nginx/ingress-nginx --version 4.3.0  &gt; render1.yaml
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During helm template, Helm never contacts a remote Kubernetes server, hence the chart only has access to default Kubernetes kinds.
The template command always acts like an installation.</p>
</div>
<p>Review rendered values:</p>
<div class="codehilite"><pre><span></span><code>edit render1.yaml
</code></pre></div>

<div class="codehilite"><pre><span></span><code>grep &quot;Source&quot; render1.yaml
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p><code>helm template</code> designed to isolate the template rendering process of Helm from the installation. 
The template command performs following phases of Helm Lifecycle:</p>
<ul>
<li>loads the chart</li>
<li>determines the values</li>
<li>renders the templates</li>
<li>formats to YAML</li>
</ul>
</div>
<p><strong>Step 3:</strong> Let's first create a configuration that will disable <code>admissionWebhooks</code>.</p>
<p>Review looking in <code>values.yaml</code> for admissionWebhooks configuration: </p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3/ingress-nginx
grep -A7 admissionWebhooks values.yaml
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>  admissionWebhooks:
    annotations: {}
    # ignore-check.kube-linter.io/no-read-only-rootfs: &quot;This deployment needs write access to root filesystem&quot;.

    ## Additional annotations to the admission webhooks.
    ## These annotations will be added to the ValidatingWebhookConfiguration and
    ## the Jobs Spec of the admission webhooks.
    enabled: true
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Note that admissionWebhooks is enabled by default ( <code>enabled: true</code> )</p>
</div>
<p>Let's create <code>custom_values.yaml</code> file with  admissionWebhooks disabled</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; custom_values.yaml
controller:
  admissionWebhooks:
    enabled: false
EOF
</code></pre></div>

<p>Execute <code>helm template</code> and store output in new file <code>render2.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>helm template ingress-nginx/ingress-nginx --version 4.3.0 --values custom_values.yaml   &gt; render2.yaml
</code></pre></div>

<p>Now comparing this 2 render files you can see the what change in configuration has resulted in the rendered file:</p>
<div class="codehilite"><pre><span></span><code>diff render1.yaml render2.yaml
</code></pre></div>

<p>This is the YAML files that will be generated after this change:</p>
<div class="codehilite"><pre><span></span><code>grep &quot;Source&quot; render2.yaml
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code># Source: ingress-nginx/templates/controller-serviceaccount.yaml
# Source: ingress-nginx/templates/controller-configmap.yaml
# Source: ingress-nginx/templates/clusterrole.yaml
# Source: ingress-nginx/templates/clusterrolebinding.yaml
# Source: ingress-nginx/templates/controller-role.yaml
# Source: ingress-nginx/templates/controller-rolebinding.yaml
# Source: ingress-nginx/templates/controller-service.yaml
# Source: ingress-nginx/templates/controller-deployment.yaml
# Source: ingress-nginx/templates/controller-ingressclass.yaml
</code></pre></div>

<p><strong>Step 4:</strong> Now, let's add a custom Configuration to <code>controller-service.yaml</code> to use Static <code>loadBalancerIP</code>, 
we've configured in step <a href="#reserve-static-ip-addresses">### Reserve Static IP addresses</a>. First we need to locate 
the correct service parameters:</p>
<div class="codehilite"><pre><span></span><code>grep -A20 &quot;service:&quot; values.yaml 
</code></pre></div>

<div class="admonition output">
<p class="admonition-title">Output</p>
<p>Shows that we have 4 different services in values file</p>
</div>
<p>Let's narrow our search:</p>
<div class="codehilite"><pre><span></span><code>grep -A20 &quot;service:&quot; values.yaml | grep  &quot;List of IP address&quot;
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>    ## List of IP addresses at which the controller services are available
      ## List of IP addresses at which the stats-exporter service is available
    ## List of IP addresses at which the default backend service is available
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>  service:
    enabled: true

    annotations: {}
    labels: {}
    # clusterIP: &quot;&quot;

    ## List of IP addresses at which the controller services are available
    ## Ref: https://kubernetes.io/docs/user-guide/services/#external-ips
    ##
    externalIPs: []

    # loadBalancerIP: &quot;&quot;
    loadBalancerSourceRanges: []
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>It seems controller is first <code>service:</code> in <code>values.yaml</code> and currently is  it has <code>loadBalancerIP</code> section commented</p>
</div>
<p><strong>Step 4:</strong> Let's add <code>loadBalancerIP</code> IP configuration to <code>custom_values.yaml</code></p>
<p>Set variable:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/ip-infrastructure
export STATIC_IP_ADDRESS=$(terraform output -raw addresses )
echo $STATIC_IP_ADDRESS
</code></pre></div>

<p>Add custom values:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3/ingress-nginx
cat &lt;&lt; EOF&gt;&gt; custom_values.yaml
  service:
    loadBalancerIP: $STATIC_IP_ADDRESS
EOF
</code></pre></div>

<p>Our final <code>custom_values.yaml</code> should look as following:</p>
<div class="codehilite"><pre><span></span><code>cat custom_values.yaml
controller:
  admissionWebhooks:
    enabled: false
  service:
    loadBalancerIP: 3?.X.X.X
</code></pre></div>

<p>Execute <code>helm template</code> and store output in new file <code>render3.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>helm template ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0  &gt; render3.yaml
</code></pre></div>

<p>Show the difference in rendered file:</p>
<div class="codehilite"><pre><span></span><code>diff render2.yaml render3.yaml
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>&gt;   loadBalancerIP: 3?.X.X.X
</code></pre></div>

<p>Ensure that this change is in fact belongs to <code>controller-service.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>grep -C16  &quot;loadBalancerIP:&quot; render3.yaml
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We configured correct service that will Ingress Controller service with <code>type: Loadbalancer</code> and 
static IP with previously generated with terraform.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p><code>helm template</code> is great tool to render you charts to YAML.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use Helm as packaging you charts only. And then use  <code>helm template</code> to generate actual YAMLs and apply them with <code>kubectl apply</code></p>
</div>
<h3 id="34-dry-runs">3.4 Dry-Runs<a class="headerlink" href="#34-dry-runs" title="Permanent link">&para;</a></h3>
<p>Before applying configuration to Kubernetes Cluster it is good idea to Dry-Run it for Errors. This is especially important if you doing Upgrades.</p>
<p>The dry-run feature provides Helm users a way to debug the output of a chart before it is sent on to Kubernetes. With all of the templates rendered, 
you can inspect exactly what would have been submitted to your cluster. And with the release data, you can verify that the release would have been created as you expected.</p>
<p>Here is some of the <code>dry-run</code> working principals:</p>
<ul>
<li><code>--dry-run</code> mixes non-YAML information with the rendered templates. This means the data has to be cleaned up before being sent to tools like kubectl.</li>
<li>A <code>--dry-run</code> on upgrade can produce different YAML output than a --dry-run on install, and this can be confusing.</li>
<li>It contacts the Kubernetes API server for validation, which means Helm has to have Kubernetes credentials even if it is just used to --dry-run a release.</li>
<li>It also inserts information into the template engine that is cluster-specific. Because of this, the output of some rendering processes may be cluster-specific.</li>
</ul>
<p>Difference between <code>dry-run</code> and <code>template</code> is that the <code>dry-run</code> contacts Kubernetes API. It is good idea to use <code>dry-run</code> prior deployment and upgrade as it creates mutated output, while <code>template</code>
doesn't contacts API and can to pure rendering.</p>
<p><strong>Step 1:</strong> Execute our deployment with <code>dry-run</code> command:</p>
<div class="codehilite"><pre><span></span><code>helm install ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --dry-run
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME: ingress-nginx
LAST DEPLOYED: Mon Oct 24 17:37:50 2022
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
HOOKS:
MANIFEST:
---
# Source: ingress-nginx/templates/controller-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    helm.sh/chart: 
</code></pre></div>

<p>At the top of the output, it will print some information about the release in our case it tells what phase of the release it is in (pending-install),
and the revision number. Next, after the informational block, all of the rendered templates are dumped to standard output. Finally, at the bottom of the dry-run output,
Helm prints the user-oriented release notes:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>--dry-run</code> dumps the output validates, but doesn't deploy actual chart.</p>
</div>
<p><strong>Step 2:</strong> Finally let's deploy Nginx Ingress Charts with our parameters in <code>ingress-nginx</code> namespace</p>
<div class="codehilite"><pre><span></span><code>kubectl create ns ingress-nginx
helm install ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx
</code></pre></div>

<p><strong>Step 3:</strong> Verify Helm Deployment:</p>
<div class="codehilite"><pre><span></span><code>helm list --namespace ingress-nginx
</code></pre></div>

<p>Follow Installation note and verify Ingress-Controller Service:</p>
<div class="codehilite"><pre><span></span><code>kubectl --namespace ingress-nginx get services -o wide ingress-nginx-controller
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME                       TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)                      AGE
ingress-nginx-controller   LoadBalancer   172.10.0.213   35.192.101.76   80:30930/TCP,443:30360/TCP   3m9s
</code></pre></div>

<h3 id="35-deploy-drupal-using-nginx-ingress-controller">3.5 Deploy Drupal using Nginx Ingress Controller<a class="headerlink" href="#35-deploy-drupal-using-nginx-ingress-controller" title="Permanent link">&para;</a></h3>
<p>Let's test our newly configured <code>ingress-nginx-controller</code> and expose <code>drupal</code> application using ingress instead of <code>LoadBalancer</code>. </p>
<p>Check if STATIC_IP_ADDRESS variable is set:</p>
<div class="codehilite"><pre><span></span><code>echo $STATIC_IP_ADDRESS
</code></pre></div>

<p>If not, set it with you Static IP address value.
Then proceed to create a YAML file for Drupal's ingress controller:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3
kubectl delete pvc data-mywebsite-mariadb-0
cat &lt;&lt; EOF&gt;&gt; drupal_ing_values.yaml
ingress:
  annotations: {kubernetes.io/ingress.class: &quot;nginx&quot;}
  enabled: true
  hostname: $STATIC_IP_ADDRESS.nip.io
  path: /
  pathType: ImplementationSpecific
EOF
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Take note of the domain you use here as you'll need this later for the assignment submission</p>
</div>
<div class="codehilite"><pre><span></span><code>helm install  mywebsite bitnami/drupal --values drupal_ing_values.yaml 
</code></pre></div>

<div class="codehilite"><pre><span></span><code>1. Get the Drupal URL:

  You should be able to access your new Drupal installation through

  http://3?.X.X.X.nip.io/
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Drupal site is now accessible via Ingress. Our Nginx Ingress Controller has been setup correctly!</p>
</div>
<p>Uninstall Drupal:</p>
<div class="codehilite"><pre><span></span><code>helm uninstall mywebsite
kubectl delete pvc data-mywebsite-mariadb-0
</code></pre></div>

<h3 id="36-optional-using-set-values-and-upgrading-charts">3.6 (Optional)  Using  <code>--set</code> values and Upgrading Charts<a class="headerlink" href="#36-optional-using-set-values-and-upgrading-charts" title="Permanent link">&para;</a></h3>
<p>In addition to <code>--value</code> option, there is a second flag that can be used to add individual parameters to an <code>install</code> or <code>upgrade</code>. 
The <code>--set</code> flag takes one or more values directly. They do not need to be stored in a YAML file.</p>
<p><strong>Step 1:</strong> Let's update our <code>ingress-nginx</code> release with new parameter <code>--set controller.image.pullPolicy=Always</code>, but first we want to render template with and without parameter to see what the change will be applied:</p>
<p>Generate a version without <code>--set</code> :</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3/ingress-nginx
helm template ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx  &gt; render4.yaml
</code></pre></div>

<p>Generate a version with <code>--set</code>:</p>
<div class="codehilite"><pre><span></span><code>helm template ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx --set controller.image.pullPolicy=Always &gt; render5.yaml
</code></pre></div>

<p>Compare both:</p>
<div class="codehilite"><pre><span></span><code>diff render4.yaml render5.yaml
</code></pre></div>

<p>Output:</p>
<div class="codehilite"><pre><span></span><code>&lt;           imagePullPolicy: IfNotPresent
---
&gt;           imagePullPolicy: Always
</code></pre></div>

<p><strong>Step 2:</strong> Let's apply update to our <code>ingress-nginx</code> release. For that we going to use <code>helm upgrade</code> command:</p>
<div class="codehilite"><pre><span></span><code>helm upgrade ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx --set controller.image.pullPolicy=Always 
</code></pre></div>

<p>Verify that upgrade was successful:</p>
<div class="codehilite"><pre><span></span><code>helm list --namespace ingress-nginx
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
ingress-nginx   ingress-nginx   2               2022-10-24 18:03:33.541452261 -0400 EDT deployed        ingress-nginx-4.3.0     1.4.0  
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>We can see that Revision change to <code>2</code></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When we talk about upgrading in Helm, we talk about upgrading an installation, not a chart. An installation is a particular instance of a chart in your cluster. 
When you run <code>helm install</code>, it creates the installation. To modify that installation, use <code>helm upgrade</code>.
This is an important distinction to make in the present context because upgrading an installation can consist of two different kinds of changes:</p>
<div class="codehilite"><pre><span></span><code>* You can upgrade the version of the chart
* You can upgrade the configuration of the installation
</code></pre></div>

<p>In this case we upgrading the configuration of the installation.</p>
</div>
<div class="admonition extra">
<p class="admonition-title">Extra</p>
<p>If you interested upgrade chart version of ingress-nginx to the next available release or <code>3.34.0</code>, give it a try.</p>
</div>
<h3 id="37-optional-listing-releases-history-rollbacks">3.7 (Optional)  Listing Releases, History, Rollbacks<a class="headerlink" href="#37-optional-listing-releases-history-rollbacks" title="Permanent link">&para;</a></h3>
<p><strong>Step 1:</strong> Let's see if we can upgrade our release with wrong value <code>pullPolicy=NoSuchPolicy</code> that doesn't exist on Kubernetes.
We will first run in <code>dry-run</code> mode</p>
<div class="codehilite"><pre><span></span><code>helm upgrade ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx --set controller.image.pullPolicy=NoSuchPolicy --dry-run
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Release "ingress-nginx" has been upgraded. Happy Helming!</p>
</div>
<p>Let's now apply same config without <code>--dry-run</code> mode:</p>
<div class="codehilite"><pre><span></span><code>helm upgrade ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx --set controller.image.pullPolicy=NoSuchPolicy
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>Error: UPGRADE FAILED: cannot patch &quot;ingress-nginx-controller&quot; with kind Deployment: Deployment.apps &quot;ingress-nginx-controller&quot; is invalid: spec.template.spec.containers[0].imagePullPolicy: Unsupported value: &quot;NoSuchPolicy&quot;: supported values: &quot;Always&quot;, &quot;IfNotPresent&quot;, &quot;Never&quot;
</code></pre></div>

<div class="admonition failed">
<p class="admonition-title">Failed</p>
<p>As the error message indicates, a pull policy cannot be set to NoSuchPolicy. This error came from the Kubernetes API server, which means Helm submitted the manifest, 
and Kubernetes rejected it. So our release should be in a failed state.</p>
</div>
<p>Verify with <code>helm list</code> to confirm <code>failed</code> state:</p>
<div class="codehilite"><pre><span></span><code>helm list --namespace ingress-nginx
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS  CHART                APP VERSION
ingress-nginx   ingress-nginx   3               2022-10-24 18:07:29.108706605 -0400 EDT failed  ingress-nginx-4.3.0  1.4.0
</code></pre></div>

<p><strong>Step 2:</strong> List all releases with <code>helm history</code>:</p>
<div class="codehilite"><pre><span></span><code>helm history ingress-nginx -n ingress-nginx
</code></pre></div>

<div class="codehilite"><pre><span></span><code>REVISION        UPDATED                         STATUS          CHART                   APP VERSION     DESCRIPTION                                                                                                                                                                                                                                                                                  
1               Mon Oct 24 17:39:36 2022        superseded      ingress-nginx-4.3.0     1.4.0           Install complete                                                                                                                                                                                                                                                                             
2               Mon Oct 24 18:03:33 2022        deployed        ingress-nginx-4.3.0     1.4.0           Upgrade complete                                                                                                                                                                                                                                                                             
3               Mon Oct 24 18:07:29 2022        failed          ingress-nginx-4.3.0     1.4.0           Upgrade &quot;ingress-nginx&quot; failed: cannot patch &quot;ingress-nginx-controller&quot; with kind Deployment: Deployment.apps &quot;ingress-nginx-controller&quot; is invalid: spec.template.spec.containers[0].imagePullPolicy: Unsupported value: &quot;NoSuchPolicy&quot;: supported values: &quot;Always&quot;, &quot;IfNotPresent&quot;, &quot;Never&quot;
</code></pre></div>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>During the life cycle of a release, it can pass through several different statuses. Here they are, approximately in the order you would likely see them:</p>
<ul>
<li>
<p><code>pending-install</code> Before sending the manifests to Kubernetes, Helm claims the installation by creating a release (marked version 1) whose status is set to pending-install.</p>
</li>
<li>
<p><code>deployed</code> As soon as Kubernetes accepts the manifest from Helm, Helm updates the release record, marking it as deployed.</p>
</li>
<li>
<p><code>pending-upgrade</code> When a Helm upgrade is begun, a new release is created for an installation (e.g., v2), and its status is set to pending-upgrade.</p>
</li>
<li>
<p><code>superseded</code> When an upgrade is run, the last deployed release is updated, marked as superseded, and the newly upgraded release is changed from pending-upgrade to deployed.</p>
</li>
<li>
<p><code>pending-rollback</code> If a rollback is created, a new release (e.g., v3) is created, and its status is set to pending-rollback until Kubernetes accepts the release manifest. Then it is marked deployed and the last release is marked superseded.</p>
</li>
<li>
<p><code>uninstalling</code> When a helm uninstall is executed, the most recent release is read and then its status is changed to uninstalling.</p>
</li>
<li>
<p><code>uninstalled</code> If history is preserved during deletion, then when the helm uninstall is complete, the last release’s status is changed to uninstalled.</p>
</li>
<li>
<p><code>failed</code> Finally, if during any operation, Kubernetes rejects a manifest submitted by Helm, Helm will mark that release failed.</p>
</li>
</ul>
</div>
<p><strong>Step 3:</strong> Rollback release with <code>helm rollback</code>.</p>
<p>From the error, we know that the release failed because we supplied an invalid image pull policy. So of course we could correct this by simply running another helm upgrade. 
But imagine a case where the cause of error was not readily available. Rather than leave the application in a failed state while diagnosing the problem, it would be nice to 
simply revert back to the release that worked before.</p>
<div class="codehilite"><pre><span></span><code>helm rollback ingress-nginx 2 -n ingress-nginx
helm history ingress-nginx -n ingress-nginx
helm list
</code></pre></div>

<div class="codehilite"><pre><span></span><code>4               Tue Aug 10 11:16:24 2021        deployed        ingress-nginx-3.35.0    0.48.1          Rollback to 2  
---
ingress-nginx   ingress-nginx   4               2021-08-10 11:16:24.424371 -0400 EDT    deployed        ingress-nginx-3.35.0    0.48.1  
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Rollback was a success! Happy Helming!
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>This command tells Helm to fetch the ingress-nginx version 2 release, and resubmit that manifest to Kubernetes. 
A rollback does not restore to a previous snapshot of the cluster. Helm does not track enough information to do that. What it does is resubmit the previous configuration, 
and Kubernetes attempts to reset the resources to match.</p>
</div>
<h3 id="38-optional-upgrade-release-with-helm-diff-plugin">3.8 (Optional) Upgrade Release with Helm <code>Diff</code> Plugin<a class="headerlink" href="#38-optional-upgrade-release-with-helm-diff-plugin" title="Permanent link">&para;</a></h3>
<p>While Helm provides a lot of functionality out of the box. Community contributes a lot of great functionality via helm plugins.</p>
<p>Plugins allow you to add extra functionality to Helm and integrate seamlessly with the CLI, making them a popular choice for users with unique workflow requirements. 
There are a number of third-party plugins available online for common use cases, such as secrets management. In addition, plugins are incredibly easy to build on your own for unique, one-off tasks.</p>
<p>Helm plugins are external tools that are accessible directly from the Helm CLI. They allow you to add custom subcommands to Helm without making any modifications to Helm’s Go source code.</p>
<p>Many third-party plugins are made open source and publicly available on GitHub. Many of these plugins use the “helm-plugin” tag/topic to make them easy to find. Refer to the documentation for <a href="https://github.com/topics/helm-plugin">Helm plugins on GitHub</a></p>
<p>Let's Upgrade our running Ingress Nginx chart with metrics service that will enable Prometheus to scrape metrics from our Nginx.</p>
<p><strong>Step 1:</strong> Update <code>custom_values.yaml</code> with following information:</p>
<div class="codehilite"><pre><span></span><code>cat &lt;&lt; EOF&gt;&gt; custom_values.yaml
  metrics:
    enabled: true
EOF
</code></pre></div>

<p><strong>Step 2:</strong> So far we've used <code>helm template</code> to render and compare manifests. However most of the time you might not be able to do it during upgrades.
However you want to have a clear understanding what will be upgraded if you change something.</p>
<p>That's where <a href="https://github.com/databus23/helm-diff">Helm Diff Plugin</a> can be handy. 
Helm Diff plugin giving your a preview of what a helm upgrade would change. It basically generates a diff between the latest deployed version of a release and a <code>helm upgrade --dry-run</code></p>
<p>Install Helm Diff Plugin:</p>
<div class="codehilite"><pre><span></span><code>helm plugin install https://github.com/databus23/helm-diff
</code></pre></div>

<div class="codehilite"><pre><span></span><code>helm diff upgrade ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>-           imagePullPolicy: Always
+           imagePullPolicy: IfNotPresent
+               protocol: TCP
+             - name: metrics
+               containerPort: 1025
+ # Source: ingress-nginx/templates/controller-service-metrics.yaml
+ apiVersion: v1
+ kind: Service
...
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>Amazing! This looks like <code>terraform plan</code> but for helm :) </p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Another discovery from above printout is that since we forgot to add <code>--set imagePullPolicy</code> command, our value will be reverted with upgrade.
This is really important to understand as you configuration maybe lost if you use <code>--set</code></p>
</div>
<p><strong>Step 3:</strong> Let's upgrade our <code>ingress-nginx</code> release:</p>
<div class="codehilite"><pre><span></span><code>helm  upgrade ingress-nginx ingress-nginx/ingress-nginx --values custom_values.yaml --version 4.3.0 --namespace ingress-nginx
 helm list -n ingress-nginx
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Our <code>ingress-nginx</code> is ready to run. Going forward we going to always deploy this chart.</p>
</div>
<div class="admonition summary">
<p class="admonition-title">Summary</p>
<p>So far we've learned:</p>
<ul>
<li>
<p>How to customize helm chart deployment using <code>--set</code> and <code>--values</code> using values.yaml</p>
</li>
<li>
<p>Using <code>values.yaml</code> preferable mehtod in order to achieve reproducible deployments</p>
</li>
<li>
<p>How to upgrade and rollback releases</p>
</li>
<li>
<p>Helm template and dry-run</p>
</li>
<li>
<p>Helm Diff Plugin</p>
</li>
</ul>
</div>
<h3 id="39-add-results-to-repository">3.9 Add results to repository<a class="headerlink" href="#39-add-results-to-repository" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise3
git add &#39;render*.yaml&#39;

git commit -m &quot;exercise 3 - advanced search and install&quot;
git push
</code></pre></div>

<h2 id="4-creating-notepad-helm-charts">4 Creating NotePad Helm Charts<a class="headerlink" href="#4-creating-notepad-helm-charts" title="Permanent link">&para;</a></h2>
<p>So far with learned how to deploy existing charts from the Artifact Hub.</p>
<p>However sometimes you or your company needs to build software that require's to be distributed and shared externally,
as well as have lifecycle and release management. Helm Charts becomes are valuable option for that, specifically if you application is based
of containers!</p>
<p>Imagine that our solution is Go-based NotePad has first customer that wants to deploy it on their system and they requested delivery via Helm Charts that available on GCP based Helm Repository. To achieve such task we going to create 2 Charts:</p>
<div class="codehilite"><pre><span></span><code>* `gowebapp-mysql` chart
* `gowebapp` chart
</code></pre></div>

<p>And store them in <a href="https://cloud.google.com/artifact-registry/docs/helm/manage-charts">Google Artifact Registry</a> that provides Helm 3 OCI Repository.</p>
<h3 id="41-design-gowebapp-mysql-chart">4.1 Design <code>gowebapp-mysql</code> chart<a class="headerlink" href="#41-design-gowebapp-mysql-chart" title="Permanent link">&para;</a></h3>
<h4 id="411-create-gowebapp-mysql-chart">4.1.1  Create <code>gowebapp-mysql</code> chart<a class="headerlink" href="#411-create-gowebapp-mysql-chart" title="Permanent link">&para;</a></h4>
<p>As scary as it sounds creating a new basic helm chart is 5 minute thing! We going to learn 2 quick methods to create helm charts, that will help you to save time and get started with helm quickly.</p>
<p>Helm includes the <code>helm create</code> command to make it easy for you to create a chart of your own, and it’s a great way to get started.</p>
<p>The create command creates a chart for you, with all the required chart structure and files. These files are documented to help you understand what is needed, and the templates it provides 
showcase multiple Kubernetes manifests working together to deploy an application. In addition, you can install and test this chart right out of the box.</p>
<p><strong>Step 0</strong> Create the exercise folder for the <code>NotePad</code> Helm Chart</p>
<div class="codehilite"><pre><span></span><code>mkdir -p ~/$MY_REPO/exercises/exercise4
cd ~/$MY_REPO/exercises/exercise4

cat &lt;&lt;EOF&gt; helm/README.md
# Helm Chart, HelmFiles and values to deploy \`NotePad\` application.
EOF
</code></pre></div>

<p><strong>Step 1:</strong> Create a new chart:</p>
<p>Create the chart:</p>
<div class="codehilite"><pre><span></span><code>helm create gowebapp-mysql
</code></pre></div>

<p>Inspect the new structure:</p>
<div class="codehilite"><pre><span></span><code>cd gowebapp-mysql
tree
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>├── Chart.yaml
├── charts
├── templates
│   ├── NOTES.txt
│   ├── _helpers.tpl
│   ├── deployment.yaml
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── service.yaml
│   ├── serviceaccount.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>This command creates a new Nginx chart, with a name of your choice, following best practices for a chart layout. Since Kubernetes clusters can have different methods to expose an application, this chart makes the way Nginx is exposed to network traffic configurable so it can be exposed in a wide variety of clusters. The chart has following structure:</p>
<ul>
<li>The <code>Chart.yaml</code> file contains metadata and some functionality controls for the chart</li>
<li>The <code>charts</code> folder currently empty may container charts dependency of the top level chart. For example we could of make our <code>gowebapp-mysql</code> as dependency chart for <code>gowebapp</code></li>
<li><code>templates</code> folder contains all <code>yaml</code> manifests in <a href="https://pkg.go.dev/text/template">Go templates</a> and used to generate Kubernetes manifests</li>
<li><code>values.yaml</code> contains <code>default</code> values applied during the rendering.</li>
<li>The <code>NOTES.txt</code> file is a special template. When a chart is installed, the NOTES.txt template is rendered and displayed rather than being installed into a cluster.</li>
<li><code>_helpers.tpl</code> - helper templates for your other templates (e.g creating same labers across all charts). Files with <code>_</code> are not rendered to Kubernetes object definitions, but are available everywhere within other chart templates for use.</li>
</ul>
</div>
<p>Here we going to show a quick way to create a Helm chart without adding any templating.</p>
<p><strong>Step 2:</strong> Delete <code>templates</code> folder and create empty one:</p>
<div class="codehilite"><pre><span></span><code>rm -rf templates
mkdir templates
cd templates
</code></pre></div>

<p><strong>Step 3:</strong> Copy existing <code>gowebapp-mysql</code> manifests to <code>templates</code> folder:</p>
<div class="codehilite"><pre><span></span><code>cp ~/$MY_REPO/deploy/k8s-manifests/gowebapp-mysql-{pvc,service,deployment}.yaml .
cp ~/$MY_REPO/deploy/k8s-manifests/secret-mysql.yaml .              
</code></pre></div>

<p><strong>Step 4:</strong> Lint Helm Chart:</p>
<p>When developing charts, especially when working with YAML templates, it can be easy to make a mistake or miss something. 
To help you catch errors, bugs, style issues, and other suspicious elements, the Helm client includes a linter. 
This linter can be used during chart development and as part of any testing processes.</p>
<p>To use the linter, use the <code>lint</code> command on a chart as a directory or a packaged archive:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise4
helm lint gowebapp-mysql
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>==&gt; Linting gowebapp-mysql
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
</code></pre></div>

<p><strong>Step 5:</strong>  Install Helm Chart locally:</p>
<p>Create <code>dev</code> namespace:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise4/gowebapp-mysql
kubectl create ns dev
kubectl config set-context --current --namespace=dev
</code></pre></div>

<p>Render the manifest locally and compare to original manifests:</p>
<div class="codehilite"><pre><span></span><code>helm template gowebapp-mysql . &gt; render.yaml
</code></pre></div>

<p>Inspect the <code>render.yaml</code> file that was generated.
Install the chart:</p>
<div class="codehilite"><pre><span></span><code>helm install gowebapp-mysql .
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME: gowebapp-mysql
LAST DEPLOYED: Mon Oct 24 18:45:17 2022
NAMESPACE: dev
STATUS: deployed
REVISION: 1
TEST SUITE: None
</code></pre></div>

<div class="codehilite"><pre><span></span><code>helm list
kubectl get all
kubectl get pvc
</code></pre></div>

<div class="admonition success">
<p class="admonition-title">Success</p>
<p>We've deployed our own helm chart locally. While we haven't used templating of the chart at all, we have a helm chart that can be installed and upgraded using helm release features.</p>
</div>
<h3 id="412-add-results-to-repository">4.1.2 Add results to repository<a class="headerlink" href="#412-add-results-to-repository" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise4
git add .

git commit -m &quot;exercise 4 - simple helm files&quot;
git push
</code></pre></div>

<h3 id="42-design-gowebapp-chart">4.2  Design <code>gowebapp</code> chart.<a class="headerlink" href="#42-design-gowebapp-chart" title="Permanent link">&para;</a></h3>
<h4 id="421-create-gowebapp-chart">4.2.1  Create <code>gowebapp</code> chart<a class="headerlink" href="#421-create-gowebapp-chart" title="Permanent link">&para;</a></h4>
<p>We going to use another method to deploy our second chart <code>gowebapp</code>. In this case we going to use <code>nginx</code> template provided by the tool. </p>
<p><strong>Task N2:</strong> Create <code>gowebapp</code> Helm chart:</p>
<div class="codehilite"><pre><span></span><code>* Configure `Deployment` template in `values.yaml`
* Configure `Service` template in `values.yaml`
* Disable `Service account` template in `values.yaml`
* Configure `Ingress` template in `values.yaml`:
    * ingress.class: &quot;nginx&quot;
    * path: &quot;/&quot;
    * pathType: &quot;ImplementationSpecific&quot;
    * host: $STATIC_IP_ADDRESS.nip.io
* Templatize the ConfigMap Resource
* Ensure the chart is deployable
* Ensure `gowebapp` in browser
</code></pre></div>

<div class="codehilite"><pre><span></span><code>mkdir -p ~/$MY_REPO/exercises/exercise5
cd ~/$MY_REPO/exercises/exercise5

cat &lt;&lt;EOF&gt; helm/README.md
# N2 exercise for Helm Chart, HelmFiles and values to deploy \`NotePad\` application.
EOF
</code></pre></div>

<p><strong>Step 1</strong> Create a new chart:</p>
<p>Create the new chart and inspect it</p>
<div class="codehilite"><pre><span></span><code>helm create gowebapp
cd gowebapp
tree
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>├── Chart.yaml
├── charts
├── templates
│   ├── NOTES.txt
│   ├── _helpers.tpl
│   ├── deployment.yaml
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── service.yaml
│   ├── serviceaccount.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml
</code></pre></div>

<div class="codehilite"><pre><span></span><code>edit values.yaml
</code></pre></div>

<h4 id="422-template-the-deployment">4.2.2 Template the Deployment<a class="headerlink" href="#422-template-the-deployment" title="Permanent link">&para;</a></h4>
<p>Ensure you are working with the correct chart in <code>exercise5</code> folder.</p>
<p>Execute the following tasks:</p>
<p><strong>Task 1</strong> Update the replicaCount value to 2 in the <code>values.yaml</code> file:</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On the file <code>values.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>replicaCount: 2
</code></pre></div>

</div>
<p><strong>Task 2</strong> Update the repository and tag section to point to your <code>gowebapp</code> docker image in the <code>values.yaml</code> file:</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On the file <code>values.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>image:
    repository: gcr.io/${PROJECT_ID}/gowebapp
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: &quot;v3&quot;
</code></pre></div>

</div>
<p><strong>Task 3</strong> Update the resources section in the <code>values.yaml</code> file to include the resource <code>requests</code> and <code>limits</code> the gowebapp application needs:</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On the file <code>values.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>resources:
  requests:
    cpu: &quot;20m&quot;
    memory: &quot;10M&quot;
  limits: 
    cpu: &quot;500m&quot;
    memory: &quot;2G&quot;
</code></pre></div>

</div>
<p><strong>Task 4</strong> Add the livness and readiness probes to the deployment.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you need additional help see the reference <code>gowebapp-deployment.yaml</code>:
  <code>cat ~/$MY_REPO/deploy/k8s-manifests/gowebapp-deployment.yaml</code></p>
</div>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>There are multiple ways of doing this, ideally you should create an 
entry in your <code>values.yaml</code> file:</p>
<div class="codehilite"><pre><span></span><code>liveness:
    path: /register
    port: 80
readiness:
    path: /register
    port: 80
</code></pre></div>

<p>Then reference it on your <code>deployment.yaml</code> file:</p>
<div class="codehilite"><pre><span></span><code>livenessProbe:
    httpGet:
      path: {{ .Values.liveness.path }} # was /
      port: {{ .Values.liveness.port }} # was http
  readinessProbe:
    httpGet:
      path: {{ .Values.readiness.path }} # was /
      port: {{ .Values.readiness.port }} # was http
</code></pre></div>

</div>
<p><strong>Task 5</strong> Notice that the <code>deployment.yaml</code> file does not have an environment variable section for <code>secrets</code>, so let's add one. For this chart we will assume that this section is optional based on whether or not a secrets section exist in the Values.yaml file.</p>
<p><strong>Task 5-a</strong> Include env delcarion in the deployment template:</p>
<div class="codehilite"><pre><span></span><code>edit gowebapp/templates/deployment.yaml
</code></pre></div>

<p>And add following code snippet in the appropriate location:</p>
<div class="codehilite"><pre><span></span><code>{{- if .Values.secrets }}
          - env:
            - name: {{.Values.secrets.name}}
              valueFrom:
                secretKeyRef:
                  name: {{.Values.secrets.secretReference.name}}
                  key: {{.Values.secrets.secretReference.key}}
{{- end}}
</code></pre></div>

<p><strong>Task 5-b</strong> Include a section in the <code>values.yaml</code> file:</p>
<p>Add following snippet:</p>
<div class="codehilite"><pre><span></span><code>secrets:
  enabled: true
  name: DB_PASSWORD
  secretReference:
    name: mysql
    key: password
</code></pre></div>

<p><strong>Task 6</strong> For this lab, we will include the <code>volumes</code> and <code>volumeMounts</code> sections without templating, so just copy the required sections to the appropriate location in the <code>deployment.yaml</code> template.</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>There are multiple ways of doing this, volume and volumeMounts seldom
change, it's ok to put directly in the <code>deployment.yaml</code> but it's also perfectly valid to add it to the <code>values.yaml</code>. </p>
<p>For this example the task suggests the change directly on <code>deployment.yaml</code>, under <code>container</code> entry inside containers tag add the following:</p>
<div class="codehilite"><pre><span></span><code>volumeMounts:
  - name: config-volume
    mountPath: /go/src/gowebapp/config
</code></pre></div>

<p>Under the <code>spec</code> tag enter the following: </p>
<div class="codehilite"><pre><span></span><code>volumes: 
- name: config-volume
    configMap:
    name: gowebapp
    items:
    - key: webapp-config-json
        path: config.json
</code></pre></div>

</div>
<p><strong>Task 7</strong>  Render the Chart locally and compare Deployment to original <code>gowebapp-deployment.yaml</code> manifests:</p>
<div class="codehilite"><pre><span></span><code>helm template gowebapp-mysql . &gt; render.yaml
</code></pre></div>

<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you need additional help see the reference <code>gowebapp-deployment.yaml</code>:
  <code>cat ~/$MY_REPO/deploy/k8s-manifests/gowebapp-deployment.yaml</code></p>
</div>
<h4 id="423-template-the-service">4.2.3 Template the Service<a class="headerlink" href="#423-template-the-service" title="Permanent link">&para;</a></h4>
<p>Ensure you are working with <code>exercise5</code> chart.</p>
<p><strong>Step 1:</strong> The <code>service.yaml</code> template doesn't have an <code>annotation</code> section, so modify the template to add an <code>annotation</code> section, that looks following:</p>
<div class="codehilite"><pre><span></span><code>edit gowebapp/templates/service.yaml
</code></pre></div>

<div class="codehilite"><pre><span></span><code>      {{- with .Values.annotations }}
      annotations:
        {{- toYaml . | nindent 4 }}
      {{- end }}
</code></pre></div>

<p><strong>Task:</strong> Next, modify the <code>values.yaml</code> file to allow chart users to add annotations for the service. Make sure to use the right section in the <code>values.yaml</code> file, based on how you modified your <code>/templates/service.yaml</code> file.</p>
<p>Reference documentation: </p>
<div class="codehilite"><pre><span></span><code>* https://helm.sh/docs/chart_template_guide/control_structures/#modifying-scope-using-with
</code></pre></div>

<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On <code>values.yaml</code> file:</p>
<div class="codehilite"><pre><span></span><code>annotations:
    - run: gowebapp 
    - app: gowebapp # more commonly used label
</code></pre></div>

</div>
<p><strong>Step 2:</strong> Under the <code>service:</code> section in the <code>values.yaml</code> file, update the service <code>port:</code> to 9000.</p>
<p><strong>Step 3</strong> In the <code>values.yaml</code> file, update the service type to <code>NodePort</code></p>
<p><strong>Step 4</strong>  Render the Chart locally and compare Service to original <code>gowebapp-service.yaml</code> manifests:</p>
<div class="codehilite"><pre><span></span><code>helm template gowebapp-mysql . &gt; render.yaml
</code></pre></div>

<h4 id="424-disable-the-service-account">4.2.4 Disable the Service account<a class="headerlink" href="#424-disable-the-service-account" title="Permanent link">&para;</a></h4>
<p>Ensure you are working with <code>exercise5</code> chart.</p>
<p><strong>Task 1</strong> Update the <code>values.yaml</code> file to <code>disable</code> the service account creation for the <code>gowebapp</code> deployment.</p>
<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On <code>values.yaml</code> file:</p>
<div class="codehilite"><pre><span></span><code>serviceAccount:
    # Specifies whether a service account should be created
    create: false # was true
</code></pre></div>

</div>
<h4 id="425-template-the-ingress-resource">4.2.5 Template the Ingress Resource<a class="headerlink" href="#425-template-the-ingress-resource" title="Permanent link">&para;</a></h4>
<p>Ensure you are working with <code>exercise5</code> chart.</p>
<p><strong>Task 1</strong> <code>enable</code> the ingress the <code>values.yaml</code> file and configure it according requirements: :</p>
<div class="codehilite"><pre><span></span><code>* Expose `gowebapp` using `Ingress` resource:
    * ingress.class: &quot;nginx&quot;
    * path: &quot;/&quot;
    * pathType: &quot;ImplementationSpecific&quot;
    * host: $STATIC_IP_ADDRESS.nip.io
</code></pre></div>

<div class="admonition solution">
<p class="admonition-title">Solution</p>
<p>On <code>values.yaml</code> file:</p>
<div class="codehilite"><pre><span></span><code>ingress:
    enabled: true # was false
    className: &quot;nginx&quot; # was &quot;&quot;
    annotations:
        - kubernetes.io/ingress.class: nginx
    hosts:
        - host: $STATIC_IP_ADDRESS.nip.io
        paths:
            - path: /
            pathType: ImplementationSpecific
</code></pre></div>

</div>
<p><strong>Step 2</strong>  Render the Chart locally and verify if any issues:</p>
<div class="codehilite"><pre><span></span><code>helm template gowebapp-mysql . &gt; render.yaml
</code></pre></div>

<h4 id="426-templatize-the-configmap-resource">4.2.6 Templatize the ConfigMap Resource<a class="headerlink" href="#426-templatize-the-configmap-resource" title="Permanent link">&para;</a></h4>
<p>Ensure you are working with <code>exercise5</code> chart.</p>
<p><strong>Step 1</strong>  Create and templatize <code>configmap</code> resource for our <code>gowebapp</code> that provides connection to Mysql:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise5/gowebapp/templates/
cat &lt;&lt;EOF&gt;&gt; configmap.yaml
kind: ConfigMap 
apiVersion: v1 
metadata:
  name: {{ .Values.configMap.name }}
data:
  webapp-config-json: |-
{{ .Files.Get &quot;config.json&quot; | indent 4 }}
EOF
</code></pre></div>

<p>Store the <code>config.json</code> inside the chart repository:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise5/gowebapp
cat &lt;&lt;EOF&gt;&gt; config.json
{
    &quot;Database&quot;: {
        &quot;Type&quot;: &quot;MySQL&quot;,
        &quot;Bolt&quot;: {
            &quot;Path&quot;: &quot;gowebapp.db&quot;
        },
        &quot;MongoDB&quot;: {
            &quot;URL&quot;: &quot;127.0.0.1&quot;,
            &quot;Database&quot;: &quot;gowebapp&quot;
        },
        &quot;MySQL&quot;: {
            &quot;Username&quot;: &quot;root&quot;,
            &quot;Password&quot;: &quot;rootpasswd&quot;,
            &quot;Name&quot;: &quot;gowebapp&quot;,
            &quot;Hostname&quot;: &quot;gowebapp-mysql&quot;,
            &quot;Port&quot;: 3306,
            &quot;Parameter&quot;: &quot;?parseTime=true&quot;
        }
    },
    &quot;Email&quot;: {
        &quot;Username&quot;: &quot;&quot;,
        &quot;Password&quot;: &quot;&quot;,
        &quot;Hostname&quot;: &quot;&quot;,
        &quot;Port&quot;: 25,
        &quot;From&quot;: &quot;&quot;
    },
    &quot;Recaptcha&quot;: {
        &quot;Enabled&quot;: false,
        &quot;Secret&quot;: &quot;&quot;,
        &quot;SiteKey&quot;: &quot;&quot;
    },
    &quot;Server&quot;: {
        &quot;Hostname&quot;: &quot;&quot;,
        &quot;UseHTTP&quot;: true,
        &quot;UseHTTPS&quot;: false,
        &quot;HTTPPort&quot;: 80,
        &quot;HTTPSPort&quot;: 443,
        &quot;CertFile&quot;: &quot;tls/server.crt&quot;,
        &quot;KeyFile&quot;: &quot;tls/server.key&quot;
    },
    &quot;Session&quot;: {
        &quot;SecretKey&quot;: &quot;@r4B?EThaSEh_drudR7P_hub=s#s2Pah&quot;,
        &quot;Name&quot;: &quot;gosess&quot;,
        &quot;Options&quot;: {
            &quot;Path&quot;: &quot;/&quot;,
            &quot;Domain&quot;: &quot;&quot;,
            &quot;MaxAge&quot;: 28800,
            &quot;Secure&quot;: false,
            &quot;HttpOnly&quot;: true
        }
    },
    &quot;Template&quot;: {
        &quot;Root&quot;: &quot;base&quot;,
        &quot;Children&quot;: [
            &quot;partial/menu&quot;,
            &quot;partial/footer&quot;
        ]
    },
    &quot;View&quot;: {
        &quot;BaseURI&quot;: &quot;/&quot;,
        &quot;Extension&quot;: &quot;tmpl&quot;,
        &quot;Folder&quot;: &quot;template&quot;,
        &quot;Name&quot;: &quot;blank&quot;,
        &quot;Caching&quot;: true
    }
}
EOF
</code></pre></div>

<p>Note: you may need to update the secret value.</p>
<p>And finally add following snippet inside <code>values.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code>edit gowebapp/values.yaml
</code></pre></div>

<div class="codehilite"><pre><span></span><code>configMap:
  name: gowebapp
</code></pre></div>

<p><strong>Step 2</strong>  Render the Chart locally and verify if any issues:</p>
<div class="codehilite"><pre><span></span><code>helm template gowebapp-mysql . &gt; render.yaml
</code></pre></div>

<h4 id="427-deploy-gowebapp">4.2.7 Deploy <code>gowebapp</code><a class="headerlink" href="#427-deploy-gowebapp" title="Permanent link">&para;</a></h4>
<p>Before deployment make sure test chart with <code>dry-run</code>, <code>template</code> and <code>lint</code> the chart</p>
<p>Lint: </p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise5
helm lint gowebapp
</code></pre></div>

<p>Install:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise5/gowebapp
helm install gowebapp .
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>NAME: gowebapp
LAST DEPLOYED: Tue Oct 24 19:05:44 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
</code></pre></div>

<div class="codehilite"><pre><span></span><code>helm ls
kubectl get all
kubectl get pvc
kubectl get ing
</code></pre></div>

<p>Access <code>gowebapp</code> with Ingress</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>You've now became a chart developer! And learned, how to create basic helm charts with 2 methods.
You can farther customize the chart as needed and add more templates as you go.
The next step would be to look contribute back to Helm community, use charts in Artificatory, find issue or add missing feature,
help grow help project!</p>
</div>
<h4 id="428-add-results-to-repository">4.2.8 Add results to repository<a class="headerlink" href="#428-add-results-to-repository" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/exercises/exercise5
git add .

git commit -m &quot;exercise 5 - helm files&quot;
git push
</code></pre></div>

<h2 id="5-submit-assignement">5 Submit assignement<a class="headerlink" href="#5-submit-assignement" title="Permanent link">&para;</a></h2>
<p><strong>Step 1</strong> Ensure you pushed the changes to the repository</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO
git status 
git log -n 5 
</code></pre></div>

<p>If any files are missing be sure to add it prior to submission.</p>
<p><strong>Step 2</strong> Push commit to the Cloud Source Repositories:</p>
<div class="codehilite"><pre><span></span><code>git push origin master
</code></pre></div>

<p><strong>Step 3</strong> Uninstall chart <code>gowebapp</code> and <code>gowebapp-mysql</code> chart</p>
<div class="codehilite"><pre><span></span><code>helm install gowebapp
helm uninstall gowebapp-mysql
</code></pre></div>

<p><strong>Step 4</strong> Resize GKE Cluster to <code>0</code> nodes, to avoid charges:</p>
<div class="codehilite"><pre><span></span><code>cd ~/$MY_REPO/notepad-infrastructure
</code></pre></div>

<div class="codehilite"><pre><span></span><code>edit terraform.tfvars
</code></pre></div>

<p>And set <code>gke_pool_node_count</code>   = "0"</p>
<p><strong>Step 5:</strong> Review TF Plan:</p>
<div class="codehilite"><pre><span></span><code>terraform plan -var-file terraform.tfvars
</code></pre></div>

<p><strong>Step 6:</strong> Shutdown all Nodes in GKE Cluster Node Pool:</p>
<div class="codehilite"><pre><span></span><code>terraform apply -var-file terraform.tfvars
</code></pre></div>

<div class="admonition result">
<p class="admonition-title">Result</p>
<p>GKE Clusters has been scale down to 0 nodes.</p>
</div>
<p>That is it, make sure to share your repository with your instructor.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/googlecloud" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>